




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 580 Textbook">
    <meta name="author" content="Nathan H. Bean">
    <title>2D and 1D Arrays :: K-State CIS 580 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis580/10-tile-maps/03-2d-and-1d-arrays/index.html" rel="canonical" type="text/html" title="2D and 1D Arrays :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/10-tile-maps/03-2d-and-1d-arrays/index.xml" rel="alternate" type="application/rss+xml" title="2D and 1D Arrays :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/10-tile-maps/03-2d-and-1d-arrays/index.print.html" rel="alternate" type="text/html" title="2D and 1D Arrays :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/10-tile-maps/03-2d-and-1d-arrays/embed.html" rel="alternate" type="text/html" title="2D and 1D Arrays :: K-State CIS 580 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/nucleus.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/perfect-scrollbar.min.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme-auto.css?1692031300" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/variant.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/print.css?1692031300" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/ie.css?1692031300" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/url.js?1692031300"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/variant.js?1692031300"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis580/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis580/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis580/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/custom.css?1692031300" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis580/10-tile-maps/03-2d-and-1d-arrays/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="2d-and-1d-arrays">2D and 1D Arrays</h1>

<p>Let&rsquo;s talk briefly about how a 2d array is actually stored <em>in memory</em>.  We like to think of it as looking something like this visualization:</p>
<p>
<a href="#image-94858b2e8ad9c3e75adf7e8e7d1c6b16" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.5.png" alt="2D array visualization" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-94858b2e8ad9c3e75adf7e8e7d1c6b16">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.5.png" alt="2D array visualization" class="lightbox-image" loading="lazy">
</a></p>
<p>But in reality, it is stored <em>linearly</em>, like this:</p>
<p>
<a href="#image-c6659adb8be805116178b1ad5025d8c8" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.6.png" alt="2D array in memory" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c6659adb8be805116178b1ad5025d8c8">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.6.png" alt="2D array in memory" class="lightbox-image" loading="lazy">
</a></p>
<p>To access a particular element in the array, the 2d coordinates must be transformed into a 1d index.  Note that each row follows the proceeding rows, so the starting index of each row would be the width of the row, <em>plus</em> the x-coordinate, i.e. the index of 
<span class="math align-center">$ (3,1) $</span> would be 
<span class="math align-center">$ 1 * width + 3 $</span>:</p>
<p>
<a href="#image-ac553a2e6dbf80b81e19c786ce832319" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.7.png" alt="Accessing (3,1)" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ac553a2e6dbf80b81e19c786ce832319">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.7.png" alt="Accessing (3,1)" class="lightbox-image" loading="lazy">
</a></p>
<p>This can be generalized into the equation:</p>

<span class="math align-center">$$ 
i = y * width + x
 $$</span>
<p>And the reverse operation, converting an index into 2d coordinates, would be:</p>
<p>
<span class="math align-center">$$ 
x = i \\\% width
 $$</span>

<span class="math align-center">$$ 
y = i / width
 $$</span></p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Note that we are using <em>integer division</em> and <em>modulus</em> in these equations, as the
<span class="math align-center">$ y $</span> value is the number of full rows (i.e.
<span class="math align-center">$ width $</span>), and the
<span class="math align-center">$ y $</span> is the distance into the partial row (i.e. the remainder).</p>
</div>
</div>
<p>Thus, all we need to treat a 1d array as a 2d array (in addition to the data) is the width of the array.  The height is only needed to calculate the array size (and thus the upper bound), which would be:</p>

<span class="math align-center">$$ 
size = width * height
 $$</span>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/arrays/multidimensional-arrays" target="_blank">C# Multidimensional Array</a>
 simply builds on this concept, wrapping the array data in an object (note that for each dimension, you will have a corresponding size for that dimension, i.e. width, height, and depth for a 3d array).</p>
<h3 id="efficiency-and-2d-arrays">Efficiency and 2d Arrays</h3>
<p>Now, a note on efficiency - iterating through a C# multi-dimensional array is slower than the corresponding 1d array, as the interpreter optimizes 1d array operations (see <a href="https://mdfarragher.medium.com/high-performance-arrays-in-c-2d55c04d37b5" target="_blank">What is Faster In C#: An int[] or an int[,]</a>
 for a technical discussion of why).  With that in mind, for a game we&rsquo;ll always want to use a 1d array to represent 2d data.</p>
<p>A second note on efficiency.  The order in which you iterate over the array <em>also</em> has an impact on efficiency.  Consider an arbitrary 2d array <code>arr</code> implemented as a 1d array with <code>width</code> and <code>height</code>.</p>
<p>What would be the difference between loop 1:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> sum = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; width; x++)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; height; y++)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    sum += arr[y * width + x]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And loop 2:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> sum = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; height; y++)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; width; x++)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    sum += arr[y * width + x]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>You probably would think they are effectively the same, and <em>logically</em> they are - they both will compute the sum of all the elements in the array.  But loop 2 will potentially run much faster.  The reason comes down to a hardware detail - how RAM and the L2 and L1 caches interact.</p>
<p>When you load a variable into a hardware register to do a calculation, it is loaded from RAM.  But as it is loaded, the memory containing it, and some of the memory around it is also loaded into the L2 and L1 caches.  If the next value in memory you try to access is cached, then it can be loaded from the cache instead of RAM.  This makes the operation much faster, as the L2 and L1 caches are located quite close to the CPU, and RAM is a good distance away (possibly many inches!).</p>
<p>Consider the order in which loop 1 accesses the array.  It first accesses the first element in the first row.  Then the first element in the second row, and then the first element in the third row, then the second element in the first row, and so on&hellip; You can see this in the figure below:</p>
<p>
<a href="#image-a0811dca8647358a202f1be118b6d14e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.8.png" alt="Loop 1 access order" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a0811dca8647358a202f1be118b6d14e">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.8.png" alt="Loop 1 access order" class="lightbox-image" loading="lazy">
</a></p>
<p>Now, consider the same process for Loop 2:</p>
<p>
<a href="#image-484cf1935b6a20124e2acbece3c0a39a" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.9.png" alt="Loop 2 access order" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-484cf1935b6a20124e2acbece3c0a39a">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/10.2.9.png" alt="Loop 2 access order" class="lightbox-image" loading="lazy">
</a></p>
<p>Notice how all the memory access happens linearly? This makes the most efficient use of the cached data, and will perform much better when your array is large.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/clipboard.min.js?1692031300" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/perfect-scrollbar.min.js?1692031300" defer></script>
    <script>
      function useMathJax( config ){
        if( !Object.assign ){
          
          return;
        }
        window.MathJax = Object.assign( window.MathJax || {}, {
          loader: {
            load: ['[tex]/mhchem']
          },
          startup: {
            elements: [
              '.math'
            ]
          },
          tex: {
            inlineMath: [
              ['$', '$'], 
              ['\\(', '\\)']
            ]
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://ksu-cs-textbooks.github.io/cis580/js/mathjax/tex-mml-chtml.js?1692031300"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/theme.js?1692031300" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/tele-scroll.js?1692031300 defer"></script>
    
  </body>
</html>
