




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="I feel like we’ve passed that tree before…
via GIPHY">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Tile Maps :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="I feel like we’ve passed that tree before…
via GIPHY">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/10-tile-maps/">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Tile Maps :: K-State CIS 580 Textbook">
    <meta property="og:description" content="I feel like we’ve passed that tree before…
via GIPHY">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Tile Maps :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="I feel like we’ve passed that tree before…
via GIPHY">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="wordCount" content="10">
    <title>Tile Maps :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/10-tile-maps/" rel="canonical" type="text/html" title="Tile Maps :: K-State CIS 580 Textbook">
    <link href="/cis580/10-tile-maps/index.xml" rel="alternate" type="application/rss+xml" title="Tile Maps :: K-State CIS 580 Textbook">
    <link href="/cis580/10-tile-maps/tele.html" rel="alternate" type="text/html" title="Tile Maps :: K-State CIS 580 Textbook">
    <link href="/cis580/10-tile-maps/embed.html" rel="alternate" type="text/html" title="Tile Maps :: K-State CIS 580 Textbook">
    <link href="/cis580/css/fontawesome-all.min.css?1719519538" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1719519538" rel="stylesheet"></noscript>
    <link href="/cis580/css/nucleus.css?1719519538" rel="stylesheet">
    <link href="/cis580/css/auto-complete.css?1719519538" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1719519538" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar.min.css?1719519538" rel="stylesheet">
    <link href="/cis580/css/fonts.css?1719519538" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1719519538" rel="stylesheet"></noscript>
    <link href="/cis580/css/theme.css?1719519538" rel="stylesheet">
    <link href="/cis580/css/theme-auto.css?1719519538" rel="stylesheet" id="R-variant-style">
    <link href="/cis580/css/chroma-auto.css?1719519538" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/cis580/css/variant.css?1719519538" rel="stylesheet">
    <link href="/cis580/css/print.css?1719519538" rel="stylesheet" media="print">
    <link href="/cis580/css/format-print.css?1719519538" rel="stylesheet">
    <script src="/cis580/js/variant.js?1719519538"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.index_js_url="/cis580/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    
    <link href="/cis580/css/custom.css?1719519538" rel="stylesheet">
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/cis580/10-tile-maps/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Tile Maps</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/09-particle-systems/06-summary/" title="Refactoring as a Game Component (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/10-tile-maps/01-introduction/" title="Introduction (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="tile-maps">Tile Maps</h1>

<p>I feel like we’ve passed that tree before…</p>
<iframe src="https://giphy.com/embed/cjbfyJrICOaKIXBWyG" width="480" height="307" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/muppets-cjbfyJrICOaKIXBWyG">via GIPHY</a></p>
            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Tile Maps</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="introduction">Introduction</h1>

<p>While the earliest video games often featured worlds that were sized to the dimensions of the screen, it was not long before game worlds were to grow larger.  This brought serious challenges to game development, as the platforms of the time did not have very large memory resources to draw upon.</p>
<p>A similar problem existed in storing raster images in early computers, where memory space was a premium.  Remember, raster images have three or four color channels - Red, Green, Blue, and sometimes Alpha.  If each channel is 8 bits, and an image is 13 x 21 pixels like the one below, our total memory consumption would be 8 x 4 x 13 x 21 = 8,736 bits, about 1 KB.  But the image only contains three colors!  Given that, can you think of a way to represent it with a smaller memory footprint?</p>
<p><a href="#R-image-319635a3abe74736d92aae42fff31a9a" class="lightbox-link"><img alt="Raster Image using a Color Palette" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.1.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-319635a3abe74736d92aae42fff31a9a"><img alt="Raster Image using a Color Palette" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.1.1.png"></a></p>
<p>The answer they adopted was the use of a <em>color palette</em>, a collection of 8, 16, or 32 colors.  This collection was 0-indexed (so the first color was represented by a 0, the next by a 1, and so on&hellip;).  This meant you needed to sore 8 x 4 x 8 = 245 bits for a 8-color palette, and the actual image could be represented as a list of 3-bit color keys (3 bits can represent 0-7, the full range of keys for a 8-color palette).  So we only need an additional 3 x 13 x 21 = 819 bits to represent the image data.  The actual image therefore could be represented by only 1,064 bits - about 1/8th a KB.  The memory savings grow larger the larger the image represented.</p>
<p>With the concept of palettized image formats in mind, let’s look at an example of an early game - Super Mario Bros.  Do you notice anything about the game world that harkens back to our earlier use of palettes?</p>
<p><a href="#R-image-9d31c8afab585784bcda06649eaf7732" class="lightbox-link"><img alt="Super Mario Bros" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.1.2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9d31c8afab585784bcda06649eaf7732"><img alt="Super Mario Bros" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.1.2.png"></a></p>
<p>Notice how so much of the scene seems to be the same texture repeated?  Much like the color palette applies a collection of colors on a regular grid, a tile engine applies a collection of tile textures on a regular grid.  This allows a large level to be drawn with only a handful of textures.  Moreover, these textures are typically stored in a texture atlas (i.e. all the tiles appear in a single texture).</p>
<p>Let&rsquo;s look at how we can implement this strategy in our own games.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="tilemap-concepts">Tilemap Concepts</h1>

<p>Let&rsquo;s start from a purely conceptual level, with some diagrams using tile assets created <a href="https://opengameart.org/content/platform-tileset-nature" rel="external" target="_blank">by Eris available from OpenGameArt</a>.  A tile map could be thought of as a grid of tiles, as demonstrated in this image:</p>
<p><a href="#R-image-650c1fd26b21fb798a368895421a3e09" class="lightbox-link"><img alt="Tile map Example" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-650c1fd26b21fb798a368895421a3e09"><img alt="Tile map Example" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.1.png"></a></p>
<p>Along with the map is the tile set, which defines the individual tiles that can be used within the map, i.e.:</p>
<p><a href="#R-image-37feb73b4f911116f05211a468ccac37" class="lightbox-link"><img alt="Tile set Example" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-37feb73b4f911116f05211a468ccac37"><img alt="Tile set Example" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.2.png"></a></p>
<p>We assign a number to each tile in the tile set:</p>
<p><a href="#R-image-0372aabe1aa9bb0c2b7eb2769efaad07" class="lightbox-link"><img alt="Numbered tile set" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0372aabe1aa9bb0c2b7eb2769efaad07"><img alt="Numbered tile set" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.3.png"></a></p>
<p>We can then specify what tile fills a grid cell in the tile map with the same number, i.e.:</p>
<p><a href="#R-image-b4a74b588b0d7b63a3ddd802fb0ff49b" class="lightbox-link"><img alt="Tile map with numbered tiles" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.4.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b4a74b588b0d7b63a3ddd802fb0ff49b"><img alt="Tile map with numbered tiles" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.4.png"></a></p>
<p>You can see that a relatively complex map can be quickly assembled from a relative handful of tiles.  Looking at the image above, you may naturally consider a 2-dimensional array:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[,]</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">{-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">46</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">52</span><span class="p">,</span><span class="m">53</span><span class="p">,</span> <span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">45</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">37</span><span class="p">,</span><span class="m">38</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="m">52</span><span class="p">,</span><span class="m">53</span><span class="p">,</span><span class="m">57</span><span class="p">,</span><span class="m">47</span><span class="p">,</span> <span class="m">4</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">44</span><span class="p">,</span><span class="m">23</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="m">24</span><span class="p">,</span><span class="m">25</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span><span class="m">48</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span><span class="m">40</span><span class="p">,</span><span class="m">38</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">44</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">37</span><span class="p">,</span><span class="m">40</span><span class="p">,</span><span class="m">38</span><span class="p">,-</span><span class="m">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="m">12</span><span class="p">,</span><span class="m">57</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">25</span><span class="p">,</span> <span class="m">4</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">44</span><span class="p">,</span><span class="m">56</span><span class="p">,</span> <span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{-</span><span class="m">1</span><span class="p">,</span><span class="m">12</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span><span class="m">29</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">25</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">52</span><span class="p">,</span><span class="m">53</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span><span class="m">61</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span><span class="m">39</span><span class="p">,</span><span class="m">25</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{-</span><span class="m">1</span><span class="p">,</span><span class="m">62</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">45</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span><span class="m">62</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">28</span><span class="p">,-</span><span class="m">1</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">23</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">44</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span><span class="m">23</span><span class="p">,-</span><span class="m">1</span><span class="p">,-</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span><span class="m">62</span><span class="p">,-</span><span class="m">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>And to draw the map, we would iterate over this array, drawing the corresponding tile from the tileset:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">map</span><span class="p">.</span><span class="n">GetLength</span><span class="p">(</span><span class="m">0</span><span class="p">);</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">map</span><span class="p">.</span><span class="n">GetLength</span><span class="p">(</span><span class="m">1</span><span class="p">);</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">tileIndex</span> <span class="p">=</span> <span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">tileIndex</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// -1 indicates no tile, so skip drawing</span>
</span></span><span class="line"><span class="cl">    <span class="n">DrawTile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tileIndex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>So you can see we need to implement classes corresponding to 1) the set of available tiles, and 2) the tile map, which is really just a collection of indices for the tile set.  But before we do that, we need to discuss 2d and 1d arrays in a bit more detail.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="2d-and-1d-arrays">2D and 1D Arrays</h1>

<p>Let&rsquo;s talk briefly about how a 2d array is actually stored <em>in memory</em>.  We like to think of it as looking something like this visualization:</p>
<p><a href="#R-image-de015e7737db3271291607ece69ad7f9" class="lightbox-link"><img alt="2D array visualization" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.5.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-de015e7737db3271291607ece69ad7f9"><img alt="2D array visualization" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.5.png"></a></p>
<p>But in reality, it is stored <em>linearly</em>, like this:</p>
<p><a href="#R-image-c4ae96b7d0562514c518282a92c2dc2e" class="lightbox-link"><img alt="2D array in memory" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.6.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c4ae96b7d0562514c518282a92c2dc2e"><img alt="2D array in memory" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.6.png"></a></p>
<p>To access a particular element in the array, the 2d coordinates must be transformed into a 1d index.  Note that each row follows the proceeding rows, so the starting index of each row would be the width of the row, <em>plus</em> the x-coordinate, i.e. the index of 
<span class="math align-center">$ (3,1) $</span> would be 
<span class="math align-center">$ 1 * width + 3 $</span>:</p>
<p><a href="#R-image-b3ee83fe215b719e47c424b8c5532d8e" class="lightbox-link"><img alt="Accessing (3,1)" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.7.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b3ee83fe215b719e47c424b8c5532d8e"><img alt="Accessing (3,1)" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.7.png"></a></p>
<p>This can be generalized into the equation:</p>

<span class="math align-center">$$ 
i = y * width + x
 $$</span>
<p>And the reverse operation, converting an index into 2d coordinates, would be:</p>
<p>
<span class="math align-center">$$ 
x = i \\\% width
 $$</span>

<span class="math align-center">$$ 
y = i / width
 $$</span></p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Note that we are using <em>integer division</em> and <em>modulus</em> in these equations, as the
<span class="math align-center">$ y $</span> value is the number of full rows (i.e.
<span class="math align-center">$ width $</span>), and the
<span class="math align-center">$ y $</span> is the distance into the partial row (i.e. the remainder).</p>
</div>
</div>
<p>Thus, all we need to treat a 1d array as a 2d array (in addition to the data) is the width of the array.  The height is only needed to calculate the array size (and thus the upper bound), which would be:</p>

<span class="math align-center">$$ 
size = width * height
 $$</span>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/arrays/multidimensional-arrays" rel="external" target="_blank">C# Multidimensional Array</a> simply builds on this concept, wrapping the array data in an object (note that for each dimension, you will have a corresponding size for that dimension, i.e. width, height, and depth for a 3d array).</p>
<h3 id="efficiency-and-2d-arrays">Efficiency and 2d Arrays</h3>
<p>Now, a note on efficiency - iterating through a C# multi-dimensional array is slower than the corresponding 1d array, as the interpreter optimizes 1d array operations (see <a href="https://mdfarragher.medium.com/high-performance-arrays-in-c-2d55c04d37b5" rel="external" target="_blank">What is Faster In C#: An int[] or an int[,]</a> for a technical discussion of why).  With that in mind, for a game we&rsquo;ll always want to use a 1d array to represent 2d data.</p>
<p>A second note on efficiency.  The order in which you iterate over the array <em>also</em> has an impact on efficiency.  Consider an arbitrary 2d array <code>arr</code> implemented as a 1d array with <code>width</code> and <code>height</code>.</p>
<p>What would be the difference between loop 1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">sum</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span> <span class="p">+=</span> <span class="n">arr</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">width</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>And loop 2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">sum</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span> <span class="p">+=</span> <span class="n">arr</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">width</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>You probably would think they are effectively the same, and <em>logically</em> they are - they both will compute the sum of all the elements in the array.  But loop 2 will potentially run much faster.  The reason comes down to a hardware detail - how RAM and the L2 and L1 caches interact.</p>
<p>When you load a variable into a hardware register to do a calculation, it is loaded from RAM.  But as it is loaded, the memory containing it, and some of the memory around it is also loaded into the L2 and L1 caches.  If the next value in memory you try to access is cached, then it can be loaded from the cache instead of RAM.  This makes the operation much faster, as the L2 and L1 caches are located quite close to the CPU, and RAM is a good distance away (possibly many inches!).</p>
<p>Consider the order in which loop 1 accesses the array.  It first accesses the first element in the first row.  Then the first element in the second row, and then the first element in the third row, then the second element in the first row, and so on&hellip; You can see this in the figure below:</p>
<p><a href="#R-image-f949e0ff1ea14150decd1ded49fc8206" class="lightbox-link"><img alt="Loop 1 access order" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.8.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f949e0ff1ea14150decd1ded49fc8206"><img alt="Loop 1 access order" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.8.png"></a></p>
<p>Now, consider the same process for Loop 2:</p>
<p><a href="#R-image-aa8ee52382d5ece7a2c5244c6a415848" class="lightbox-link"><img alt="Loop 2 access order" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/10.2.9.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aa8ee52382d5ece7a2c5244c6a415848"><img alt="Loop 2 access order" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/10.2.9.png"></a></p>
<p>Notice how all the memory access happens linearly? This makes the most efficient use of the cached data, and will perform much better when your array is large.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="a-basic-tile-engine">A Basic Tile Engine</h1>

<p>Now that we have a good sense of what a tile map consists of, as well as how to effectively use a 1-dimensional array as a 2-dimensional array, let&rsquo;s discuss actual implementations. As we discussed conceptually, we need: 1) a set of tiles, and 2) the arrangement of those tiles into a map.</p>
<p>Let&rsquo;s start by thinking about our tiles.  To draw a tile, we need to know:</p>
<ol>
<li>What texture the tile appears in</li>
<li>The bounds of the tile in that texture</li>
<li>Where the tile should appear on screen</li>
</ol>
<p>To determine this information, we need several other items:</p>
<ul>
<li>The width of the map in tiles</li>
<li>The height of the map in tiles</li>
<li>The width of a tile in pixels</li>
<li>The height of a tile in pixels</li>
</ul>
<p>And we can simplify the problem with some assumptions:</p>
<ul>
<li>Tiles are all the same size</li>
<li>The tileset image has the tiles organized side-by-side in a grid pattern</li>
</ul>
<h4 id="representing-the-map">Representing the Map</h4>
<p>Given this understanding, we can determine some fields we&rsquo;ll need to keep track of the data:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;The map filename&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">string</span> <span class="n">_mapFilename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;The tileset texture&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Texture2D</span> <span class="n">_tilesetTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;The map and tile dimensions&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">int</span> <span class="n">_tileWidth</span><span class="p">,</span> <span class="n">_tileHeight</span><span class="p">,</span> <span class="n">_mapWidth</span><span class="p">,</span> <span class="n">_mapHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;The tileset data&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Rectangle</span><span class="p">[]</span> <span class="n">_tiles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;The map data&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">_map</span><span class="p">;</span></span></span></code></pre></div><h4 id="loading-the-data">Loading the Data</h4>
<p>Now let&rsquo;s turn our attention to how we can <em>populate</em> those fields. Let&rsquo;s first consider how we might write the data for a tilemap in a text file:</p>
<div class="highlight"><pre tabindex="0"><code>tileset
64, 64
10, 10
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 3, 3, 2, 4, 4, 1, 4, 2, 2, 2, 3, 3, 2, 2, 2, 2, 4, 4, 4, 2, 3, 3, 2, 2, 2, 2, 2, 2, 1, 2, 3, 3, 3, 1, 3, 2, 2, 2, 4, 4, 3, 3, 2, 2, 3, 2, 3, 2, 2, 4, 4, 3, 2, 2, 3, 2, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3</code></pre></div><p>In this example, the first line is the name of the tileset image file (which is loaded through the content pipeline, so it has no extension).  The second line is the width and height of a tile, and the third line is the width and height of the map (measured in tiles).  The last line is the indices of the tiles from the tileset image.</p>
<p>Loading the data from this file requires a method like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">LoadContent</span><span class="p">(</span><span class="n">ContentManager</span> <span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Read in the map file</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">data</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">ReadAllText</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">RootDirectory</span><span class="p">,</span> <span class="n">_mapFilename</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">lines</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// First line is tileset image file name </span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">tilesetFileName</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Trim</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">_tilesetTexture</span> <span class="p">=</span> <span class="n">content</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="n">tilesetFileName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Second line is tile size</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">secondLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_tileWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_tileHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Now that we know the tile size and tileset</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// image, we can determine tile bounds</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">tilesetColumns</span> <span class="p">=</span> <span class="n">_tilesetTexture</span><span class="p">.</span><span class="n">Width</span> <span class="p">/</span> <span class="n">_tileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">tilesetRows</span> <span class="p">=</span> <span class="n">_tilesetTexture</span><span class="p">.</span><span class="n">Height</span> <span class="p">/</span> <span class="n">_tileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_tiles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">tilesetColumns</span> <span class="p">*</span> <span class="n">tilesetRows</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">tilesetRows</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">tilesetColumns</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_tiles</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">tilesetColumns</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">x</span> <span class="p">*</span> <span class="n">_tileWidth</span><span class="p">,</span> <span class="c1">// upper left-hand x cordinate</span>
</span></span><span class="line"><span class="cl">                <span class="n">y</span> <span class="p">*</span> <span class="n">_tileHeight</span><span class="p">,</span> <span class="c1">// upper left-hand y coordinate</span>
</span></span><span class="line"><span class="cl">                <span class="n">_tileWidth</span><span class="p">,</span> <span class="c1">// width </span>
</span></span><span class="line"><span class="cl">                <span class="n">_tileHeight</span> <span class="c1">// height</span>
</span></span><span class="line"><span class="cl">                <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Third line is map size (in tiles)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">thirdLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_mapWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">_mapHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Fourth line is map data</span>
</span></span><span class="line"><span class="cl">    <span class="n">_map</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">_mapWidth</span> <span class="p">*</span> <span class="n">_mapHeight</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">fourthLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_mapWidth</span> <span class="p">*</span> <span class="n">_mapHeight</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">fourthLine</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>While there is a lot going on here, it is also mostly basic File I/O based on the structure of the file.</p>
<h4 id="rendering-the-tilemap">Rendering the Tilemap</h4>
<p>Finally, drawing the map involves iterating over the data and invoking <code>SpriteBatch.Draw()</code> for each tile that needs drawn.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">,</span> <span class="n">SpriteBatch</span> <span class="n">spriteBatch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">_mapHeight</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">_mapWidth</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Indexes start at 1, so shift for array coordinates</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">_map</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">_mapWidth</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Index of -1 (shifted from 0) should not be drawn</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">spriteBatch</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">_tilesetTexture</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">x</span> <span class="p">*</span> <span class="n">_tileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">y</span> <span class="p">*</span> <span class="n">_tileHeight</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">_tiles</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">Color</span><span class="p">.</span><span class="n">White</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Organizing these fields and methods into a class gives us a simple tile engine. This can be expanded to address a lot of different games&rsquo; needs.  However, it <em>does</em> require building the map file by hand, using raw tile indices.  This gets challenging quickly, which leads us to our next topic - using a tilemap editor.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="tiled-editor">Tiled Editor</h1>

<p>Once we start thinking in terms of large, complex maps editing the map by hand becomes a daunting task. Instead, we want a tool to edit the map visually. One of the best free tools to do so is the <a href="https://www.mapeditor.org/" rel="external" target="_blank">Tiled Map Editor</a>. Tiled is free, open-source, and widely used in the games industry. It allows you to quickly create a tilemap by importing tilesets and drawing the map using a suite of visual tools.  You can read more about Tiled and its functionality in the <a href="https://doc.mapeditor.org/en/stable/tiled" rel="external" target="_blank">documentation</a> and covered in <a href="https://youtu.be/ZwaomOYGuYo" rel="external" target="_blank">this video series by GamesfromScratch</a>.</p>
<p>However, it adds additional concepts to tile maps that we have not yet discussed.</p>
<h3 id="properties">Properties</h3>
<p>Because Tiled is intended to be usable in a wide variety of games, it allows <em>properties</em> to be defined on almost everything.  In Tiled, properties are simply key/value pairs, i.e. <code>&quot;Opacity&quot;</code> might be set to <code>0.5</code>.  There are no pre-defined keys, instead you decide what properties you need for your game.  The properties are stored in collections, essentially a <code>Dictionary&lt;string, string&gt;</code>, which is how we&rsquo;ll interpret them in our C# code.</p>
<h3 id="tilesets">Tilesets</h3>
<p>Tilesets are implemented in a similar fashion to our earlier discussions, however:</p>
<ol>
<li>An index of 0 represents &ldquo;no tile&rdquo;.  This allows you to used unsigned integers as a tile index</li>
<li>More than one tileset can be used.  Each new tileset begins with the next index.  So if we have two tilesets with eight tiles each, the first tileset will have indices 1-8, and the second will have 9-16.</li>
<li>Individual tiles can have properties - which is commonly used for collision information, to identify solid surfaces and platforms, etc.</li>
</ol>
<h3 id="map-layers">Map Layers</h3>
<p>Instead of a single 2d array of tiles, Tiled allows you to create maps with <em>multiple</em> layers, each with its own 2d array.  This can be used in a variety of ways:</p>
<ol>
<li>To create a foreground and background layer, a common approach in top-down views because it allows the player to walk behind foreground elements (i.e. the base of a tree is in the background layer, but the branches and crown is in the foreground)</li>
<li>To implement parallax scrolling - where layers scroll at different speeds to create the illusion of depth.  We discuss the implementation details of parallax scrolling <a href="https://textbooks.cs.ksu.edu/cis580/08-spritebatch-transforms/04-parallax-scrolling/" rel="external" target="_blank">in chapter 8</a>.</li>
<li>To create complex, multi-level dungeons where players can move between layers</li>
</ol>
<p>Conceptually, a map layer is implemented the same way as the simple tile map we discussed earlier. It is a 2d array of tile indices implemented as a 1d array, along with storing the width, height, and any properties that apply to the entire layer.</p>
<p>In addition to layers of tiles, Tiled also supports <em>image</em> and <em>object</em> layers.</p>
<h4 id="image-layers">Image Layers</h4>
<p>An image layer represents an image that is <em>not</em> a tile.  This can be used for large bitmaps that cover the entire layer, or smaller ones that appear in a particular spot.  Images can also repeat to fill the layer or defined space.</p>
<h5 id="object-layers">Object Layers</h5>
<p>In addition to tiles, and images, Tiled allows you to place &ldquo;objects&rdquo; in a map. These are represented by boxes that do not correspond to the grid system of the tiles.  Objects are simply a rectangle plus properties, and can be used to represent anything you need to place in the game world - spawn positions, event triggers, doors, etc.</p>
<p>Objects are organized into <em>object layers</em>, which are essentially a collection of objects.</p>
<h3 id="working-with-tiled-in-monogame">Working with Tiled in MonoGame</h3>
<p>Tiled uses an XML file format, <a href="https://doc.mapeditor.org/en/stable/reference/tmx-map-format/" rel="external" target="_blank">TMX</a>.  Thus, you can load a TMX file and then parse it with an XML parsing library.  In fact, Tiled was released with an example engine that does this, created by Kevin Gadd.  This was later converted into C# for use with XNA by Stephen Balanger and Zach Musgrave.</p>
<p>I further converted this for use with the current version of MonoGame, with additional documentation.  It can be found <a href="https://github.com/CIS580/tiled-monogame" rel="external" target="_blank">on GitHub</a>.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="summary">Summary</h1>

<p>In this chapter we learned about tile maps, an important technique for creating large game worlds with small memory footprints. We also examined the Tiled map editor and saw an example of loading a Tiled map. However, this approach used traditional File I/O.  In our next chapter, we&rsquo;ll learn how to use the Content Pipeline to process the TMX file directly.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          </section>
        </div>
      </main>
    
<div class="git-footer">
  <p class="theme-version-footer">6.0.0</p>
  <p>Last modified by: 
              <i class='fas fa-user'></i> Russell Feldhausen
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/43f194969a638fa4572819da4b31060ad574a9ce">Aug 11, 2023</a>
  </p>
  </div>
  
    
    </div>
    <script src="/cis580/js/clipboard.min.js?1719519538" defer></script>
    <script src="/cis580/js/perfect-scrollbar.min.js?1719519538" defer></script>
    <script>
      function useMathJax( config ){
        window.MathJax = Object.assign( window.MathJax || {}, {
          tex: {
            inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
            displayMath: [['\\[', '\\]'], ['$$', '$$']], 
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="/cis580/js/mathjax/tex-mml-chtml.js?1719519538"></script>
    <script src="/cis580/js/theme.js?1719519538" defer></script>
  </body>
</html>
