




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/c-parallax-scrolling/06-scrolling-layers/embed.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Parallax Scrolling">
    <meta property="article:published_time" content="2020-03-24T10:00:00-05:00">
    <meta property="article:modified_time" content="2021-03-11T13:44:31-06:00">
    <meta itemprop="name" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta itemprop="datePublished" content="2020-03-24T10:00:00-05:00">
    <meta itemprop="dateModified" content="2021-03-11T13:44:31-06:00">
    <meta itemprop="wordCount" content="735">
    <title>Scrolling Layers :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/c-parallax-scrolling/06-scrolling-layers/" rel="canonical" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/index.xml" rel="alternate" type="application/rss+xml" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/index.print.html" rel="alternate" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/tele.html" rel="alternate" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    
  <link href="/cis580/css/fontawesome-all.min.css?1723670678" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1723670678" rel="stylesheet"></noscript>
  <link href="/cis580/css/nucleus.css?1723670678" rel="stylesheet">
  <link href="/cis580/css/auto-complete.css?1723670678" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1723670678" rel="stylesheet"></noscript>
  <link href="/cis580/css/perfect-scrollbar.min.css?1723670678" rel="stylesheet">
  <link href="/cis580/css/fonts.css?1723670678" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1723670678" rel="stylesheet"></noscript>
  <link href="/cis580/css/theme.css?1723670678" rel="stylesheet">
  
  
  
  <link href="/cis580/css/theme-light-theme.css?1723670678" rel="stylesheet" id="R-variant-style">
  <link href="/cis580/css/chroma-relearn-light.css?1723670678" rel="stylesheet" id="R-variant-chroma-style">
  <link href="/cis580/css/variant.css?1723670678" rel="stylesheet">
  <link href="/cis580/css/print.css?1723670678" rel="stylesheet" media="print">
  
  
  
  <script>
    window.relearn = window.relearn || {};
    window.relearn.relBasePath='..\/..';
    window.relearn.relBaseUri='..\/..\/..';
    window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
    window.index_js_url="/cis580/index.search.js";
    // variant stuff
    window.variants && variants.init( [ 'light-theme' ] );
    // translations
    window.T_Copy_to_clipboard = `Copy to clipboard`;
    window.T_Copied_to_clipboard = `Copied to clipboard!`;
    window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
    window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
    window.T_Reset_view = `Reset view`;
    window.T_View_reset = `View reset!`;
    window.T_No_results_found = `No results found for "{0}"`;
    window.T_N_results_found = `{1} results found for "{0}"`;
  </script>
  
  <link href="/cis580/css/custom.css?1723670678" rel="stylesheet">
    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="/cis580/c-parallax-scrolling/06-scrolling-layers/embed.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    

<p>Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player&rsquo;s position.  But we could also tie the scrolling to a timer function - and have it scroll at a set speed.  Or we could apply it to a secondary target - something like a drone the player might launch.  We might also use the scrolling effect with <em>no</em> player, maybe as some kind of level preview, or for a cutscene.</p>
<p>How can we keep our parallax implementation flexible to meet each of these possibilities, while making it easy to use for the most basic approach of scrolling with the player?  We could use a delegate, but we probably also need to keep track of some variables.  Since we need both <em>data</em> and a <em>behavior</em>, a class is a better choice.  But we want the class to be swappable for other implementations, which means we need a common interface.</p>
<h2 id="the-iscrollcontroller-interface">The IScrollController Interface</h2>
<p>Let&rsquo;s define a new interface, <code>IScrollController</code> to play this role.  It should provide us with a transformation, and a means to update that transformation.  Let&rsquo;s structure that as a <code>Transform</code> property and an <code>Update()</code> method which matches the signature of the <code>IUpdateable</code> interface that game objects use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// An interface for a parallax scrolling controller</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">interface</span> <span class="nc">IScrollController</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The current transform matrix to use</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Matrix</span> <span class="n">Transform</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// Updates the transformation matrix</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Now we can turn our attention to a concrete implementation of this interface.</p>
<h2 id="auto-scroll--controller">Auto-Scroll  Controller</h2>
<p>Let&rsquo;s start with a simple controller that will scroll based on time.  Let&rsquo;s define a class <code>AutoScrollController</code> that implements our <code>IScrollController</code> interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// A controller that scrolls a parallax layer at a set speed</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">AutoScrollController</span> <span class="p">:</span> <span class="n">IScrollController</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll need to define a time variable to know how long we&rsquo;ve been scrolling:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The time that has elapsed</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span></span></span></code></pre></div><p>And a speed at which the layer should scroll:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The speed at which the layer should scroll</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">Speed</span> <span class="p">=</span> <span class="m">10f</span><span class="p">;</span></span></span></code></pre></div><p>To fulfill the interface requirements, we need to implement a <code>Transform</code> property with a getter.  We want this to apply our scrolling, so the speed times the elapsed time.  The direction of the translation needs to be negative, so the scrolling moves to the left.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Gets the current tansformation matrix</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">Transform</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">get</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(-</span><span class="n">elapsedTime</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>The second interface requirement is an <code>Update()</code> method.  We&rsquo;ll use this to update our elapsed time:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Updates the controller</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">elapsedTime</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">gameTime</span><span class="p">.</span><span class="n">ElapsedGameTime</span><span class="p">.</span><span class="n">TotalSeconds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>To use this controller, we&rsquo;ll need to update the <code>ParallaxLayer</code> class.</p>
<h2 id="refactoring-the-parallaxlayer-class">Refactoring the ParallaxLayer class</h2>
<p>The <code>ParallaxController</code> needs to have an instance of <code>IScrollController</code>; let&rsquo;s make that an <code>AutoScrollController</code> by default:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The controller for this scroll layer</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">IScrollController</span> <span class="n">ScrollController</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AutoScrollController</span><span class="p">();</span></span></span></code></pre></div><p>We&rsquo;ll use its <code>Transform</code> property, so we can get rid of the current <code>ParallaxLayer.transform</code>  field.  Remove the lines:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The transformation to apply to this parallax layer</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">transform</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span></span></span></code></pre></div><p>We need to tweak the <code>ParallaxLayer.Draw()</code> method to use the <code>ScrollController.Transform</code> instead:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Draws the Parallax layer</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">spriteBatch</span><span class="p">.</span><span class="n">Begin</span><span class="p">(</span><span class="n">SpriteSortMode</span><span class="p">.</span><span class="n">Deferred</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">ScrollController</span><span class="p">.</span><span class="n">Transform</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">sprite</span> <span class="k">in</span> <span class="n">Sprites</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sprite</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">spriteBatch</span><span class="p">,</span> <span class="n">gameTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">spriteBatch</span><span class="p">.</span><span class="n">End</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Finally, we want to ensure that our controller&rsquo;s <code>Update()</code> method is called.  The <code>ParallaxLayer</code> is a game component, so it already has an <code>Update()</code> method defined in it&rsquo;s base class, and it is being invoked by the <code>Game</code> class.  Let&rsquo;s override that method, and use it to update our controller:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Updates the ParallaxLayer</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;the GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ScrollController</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  </span></span></code></pre></div><p>Because we&rsquo;re already creating the <code>ParallaxLayer</code> in our <code>Game1</code> and adding it to the <code>Game1.Components</code> list, it should automatically update and render now.  Go ahead and run the program - you should see the background scroll by, and if you don&rsquo;t move the player, it will slip off-screen!</p>
<p>Let&rsquo;s add our remaining layers next!</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>
</div>
</main>
</div>



<script src="/cis580/js/clipboard.min.js?1723670678" defer></script>
<script src="/cis580/js/perfect-scrollbar.min.js?1723670678" defer></script>
<script src="/cis580/js/theme.js?1723670678" defer></script>

<script src="/cis580/js/embed-iframe.js?1723670678" defer></script>
</body>
</html>
