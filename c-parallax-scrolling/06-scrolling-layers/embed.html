<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta name="author" content="Nathan H. Bean">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta name="twitter:title" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/c-parallax-scrolling/06-scrolling-layers/index.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Parallax Scrolling">
    <meta property="article:published_time" content="2020-03-24T10:00:00-05:00">
    <meta property="article:modified_time" content="2021-03-11T13:44:31-06:00">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta itemprop="name" content="Scrolling Layers :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player’s position. But we could also tie the scrolling to a timer function - and have it scroll at a set speed. Or we could apply it to a secondary target - something like a drone the player might launch. We might also use the scrolling effect with no player, maybe as some kind of level preview, or for a cutscene.">
    <meta itemprop="datePublished" content="2020-03-24T10:00:00-05:00">
    <meta itemprop="dateModified" content="2021-03-11T13:44:31-06:00">
    <meta itemprop="wordCount" content="744">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <title>Scrolling Layers :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/c-parallax-scrolling/06-scrolling-layers/index.html" rel="canonical" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/index.xml" rel="alternate" type="application/rss+xml" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/index.print.html" rel="alternate" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/c-parallax-scrolling/06-scrolling-layers/tele.html" rel="alternate" type="text/html" title="Scrolling Layers :: K-State CIS 580 Textbook">
    <link href="/cis580/css/auto-complete/auto-complete.min.css?1755628803" rel="stylesheet">
    <script src="/cis580/js/auto-complete/auto-complete.min.js?1755628803" defer></script>
    <script src="/cis580/js/search-lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/search.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cis580/searchindex.en.js?1755628803";
    </script>
    <script src="/cis580/js/lunr/lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.stemmer.support.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.multi.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.en.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar/perfect-scrollbar.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/theme.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/format-html.min.css?1755628803" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/c-parallax-scrolling\/06-scrolling-layers\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cis580/css/custom.css?1755628803" rel="stylesheet">
  </head>
  <body class="mobile-support embed html" data-url="/cis580/c-parallax-scrolling/06-scrolling-layers/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable c-parallax-scrolling" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="scrolling-layers">Scrolling Layers</h1>

<p>Parallax scrolling is almost always tied to player movement - as the player moves, the layer scrolls in relation to the player&rsquo;s position.  But we could also tie the scrolling to a timer function - and have it scroll at a set speed.  Or we could apply it to a secondary target - something like a drone the player might launch.  We might also use the scrolling effect with <em>no</em> player, maybe as some kind of level preview, or for a cutscene.</p>
<p>How can we keep our parallax implementation flexible to meet each of these possibilities, while making it easy to use for the most basic approach of scrolling with the player?  We could use a delegate, but we probably also need to keep track of some variables.  Since we need both <em>data</em> and a <em>behavior</em>, a class is a better choice.  But we want the class to be swappable for other implementations, which means we need a common interface.</p>
<h2 id="the-iscrollcontroller-interface">The IScrollController Interface</h2>
<p>Let&rsquo;s define a new interface, <code>IScrollController</code> to play this role.  It should provide us with a transformation, and a means to update that transformation.  Let&rsquo;s structure that as a <code>Transform</code> property and an <code>Update()</code> method which matches the signature of the <code>IUpdateable</code> interface that game objects use:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// An interface for a parallax scrolling controller</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IScrollController</span> 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The current transform matrix to use</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        Matrix Transform { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// Updates the transformation matrix</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">void</span> Update(GameTime gameTime);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>Now we can turn our attention to a concrete implementation of this interface.</p>
<h2 id="auto-scroll--controller">Auto-Scroll  Controller</h2>
<p>Let&rsquo;s start with a simple controller that will scroll based on time.  Let&rsquo;s define a class <code>AutoScrollController</code> that implements our <code>IScrollController</code> interface:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// A controller that scrolls a parallax layer at a set speed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AutoScrollController</span> : IScrollController
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>We&rsquo;ll need to define a time variable to know how long we&rsquo;ve been scrolling:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The time that has elapsed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> elapsedTime = <span style="color:#ae81ff">0</span>;</span></span></code></pre></div>
<p>And a speed at which the layer should scroll:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The speed at which the layer should scroll</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Speed = <span style="color:#ae81ff">10f</span>;</span></span></code></pre></div>
<p>To fulfill the interface requirements, we need to implement a <code>Transform</code> property with a getter.  We want this to apply our scrolling, so the speed times the elapsed time.  The direction of the translation needs to be negative, so the scrolling moves to the left.</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the current tansformation matrix</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Matrix Transform
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Matrix.CreateTranslation(-elapsedTime * Speed, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>The second interface requirement is an <code>Update()</code> method.  We&rsquo;ll use this to update our elapsed time:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Updates the controller</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Update(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        elapsedTime += (<span style="color:#66d9ef">float</span>)gameTime.ElapsedGameTime.TotalSeconds;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>To use this controller, we&rsquo;ll need to update the <code>ParallaxLayer</code> class.</p>
<h2 id="refactoring-the-parallaxlayer-class">Refactoring the ParallaxLayer class</h2>
<p>The <code>ParallaxController</code> needs to have an instance of <code>IScrollController</code>; let&rsquo;s make that an <code>AutoScrollController</code> by default:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The controller for this scroll layer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IScrollController ScrollController { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#66d9ef">new</span> AutoScrollController();</span></span></code></pre></div>
<p>We&rsquo;ll use its <code>Transform</code> property, so we can get rid of the current <code>ParallaxLayer.transform</code>  field.  Remove the lines:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The transformation to apply to this parallax layer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Matrix transform = Matrix.Identity;</span></span></code></pre></div>
<p>We need to tweak the <code>ParallaxLayer.Draw()</code> method to use the <code>ScrollController.Transform</code> instead:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Draws the Parallax layer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Draw(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        spriteBatch.Begin(SpriteSortMode.Deferred, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">null</span>, ScrollController.Transform);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> sprite <span style="color:#66d9ef">in</span> Sprites)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            sprite.Draw(spriteBatch, gameTime);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        spriteBatch.End();
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>Finally, we want to ensure that our controller&rsquo;s <code>Update()</code> method is called.  The <code>ParallaxLayer</code> is a game component, so it already has an <code>Update()</code> method defined in it&rsquo;s base class, and it is being invoked by the <code>Game</code> class.  Let&rsquo;s override that method, and use it to update our controller:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Updates the ParallaxLayer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;the GameTime object&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Update(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ScrollController.Update(gameTime);
</span></span><span style="display:flex;"><span>    }  </span></span></code></pre></div>
<p>Because we&rsquo;re already creating the <code>ParallaxLayer</code> in our <code>Game1</code> and adding it to the <code>Game1.Components</code> list, it should automatically update and render now.  Go ahead and run the program - you should see the background scroll by, and if you don&rsquo;t move the player, it will slip off-screen!</p>
<p>Let&rsquo;s add our remaining layers next!</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
      
      
      
    </div>
    <script src="/cis580/js/clipboard/clipboard.min.js?1755628803" defer></script>
    <script src="/cis580/js/perfect-scrollbar/perfect-scrollbar.min.js?1755628803" defer></script>
    <script src="/cis580/js/theme.min.js?1755628803" defer></script>
  <script src="/cis580/js/embed-iframe.min.js?1755628803" defer></script>
  </body>
</html>
