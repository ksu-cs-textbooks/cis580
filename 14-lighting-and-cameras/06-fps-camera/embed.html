




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Let’s go ahead and create a camera that the player can actually control. This time, we’ll adopt a camera made popular by PC first-person shooters, where the player’s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.
The FPS Camera Class Let’s start by defining our class, FPSCamera:
/// &lt;summary&gt; /// A camera controlled by WASD &#43; Mouse /// &lt;/summary&gt; public class FPSCamera : ICamera { }Private Fields This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis only controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player’s movement.">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="FPS Camera :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Let’s go ahead and create a camera that the player can actually control. This time, we’ll adopt a camera made popular by PC first-person shooters, where the player’s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.
The FPS Camera Class Let’s start by defining our class, FPSCamera:
/// &lt;summary&gt; /// A camera controlled by WASD &#43; Mouse /// &lt;/summary&gt; public class FPSCamera : ICamera { }Private Fields This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis only controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player’s movement.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/14-lighting-and-cameras/06-fps-camera/embed.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="FPS Camera :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Let’s go ahead and create a camera that the player can actually control. This time, we’ll adopt a camera made popular by PC first-person shooters, where the player’s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.
The FPS Camera Class Let’s start by defining our class, FPSCamera:
/// &lt;summary&gt; /// A camera controlled by WASD &#43; Mouse /// &lt;/summary&gt; public class FPSCamera : ICamera { }Private Fields This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis only controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player’s movement.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Lighting and Cameras">
    <meta property="article:published_time" content="2020-03-24T10:00:00-05:00">
    <meta property="article:modified_time" content="2021-04-23T16:59:02-05:00">
    <meta itemprop="name" content="FPS Camera :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Let’s go ahead and create a camera that the player can actually control. This time, we’ll adopt a camera made popular by PC first-person shooters, where the player’s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.
The FPS Camera Class Let’s start by defining our class, FPSCamera:
/// &lt;summary&gt; /// A camera controlled by WASD &#43; Mouse /// &lt;/summary&gt; public class FPSCamera : ICamera { }Private Fields This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis only controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player’s movement.">
    <meta itemprop="datePublished" content="2020-03-24T10:00:00-05:00">
    <meta itemprop="dateModified" content="2021-04-23T16:59:02-05:00">
    <meta itemprop="wordCount" content="1097">
    <title>FPS Camera :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/14-lighting-and-cameras/06-fps-camera/" rel="canonical" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/06-fps-camera/index.xml" rel="alternate" type="application/rss+xml" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/06-fps-camera/index.print.html" rel="alternate" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/06-fps-camera/tele.html" rel="alternate" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    
  <link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/nucleus.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/perfect-scrollbar.min.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/fonts.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/theme.css?1737133119" rel="stylesheet">
  
  
  
  <link href="/cis580/css/theme-light-theme.css?1737133119" rel="stylesheet" id="R-variant-style">
  <link href="/cis580/css/chroma-relearn-light.css?1737133119" rel="stylesheet" id="R-variant-chroma-style">
  <link href="/cis580/css/variant.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/print.css?1737133119" rel="stylesheet" media="print">
  
  
  
  <script>
    window.relearn = window.relearn || {};
    window.relearn.relBasePath='..\/..';
    window.relearn.relBaseUri='..\/..\/..';
    window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
    window.index_js_url="/cis580/index.search.js";
    // variant stuff
    window.variants && variants.init( [ 'light-theme' ] );
    // translations
    window.T_Copy_to_clipboard = `Copy to clipboard`;
    window.T_Copied_to_clipboard = `Copied to clipboard!`;
    window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
    window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
    window.T_Reset_view = `Reset view`;
    window.T_View_reset = `View reset!`;
    window.T_No_results_found = `No results found for "{0}"`;
    window.T_N_results_found = `{1} results found for "{0}"`;
  </script>
  
  <link href="/cis580/css/custom.css?1737133119" rel="stylesheet">
    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="/cis580/14-lighting-and-cameras/06-fps-camera/embed.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    

<p>Let&rsquo;s go ahead and create a camera that the player can actually control.  This time, we&rsquo;ll adopt a camera made popular by PC first-person shooters, where the player&rsquo;s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.</p>
<h2 id="the-fps-camera-class">The FPS Camera Class</h2>
<p>Let&rsquo;s start by defining our class, <code>FPSCamera</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// A camera controlled by WASD + Mouse</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">FPSCamera</span> <span class="p">:</span> <span class="n">ICamera</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="private-fields">Private Fields</h3>
<p>This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis <em>only</em> controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player&rsquo;s movement.  Thus, we&rsquo;ll need to track these angles separately, and combine them when needed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The angle of rotation about the Y-axis</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">horizontalAngle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The angle of rotation about the X-axis</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">verticalAngle</span><span class="p">;</span></span></span></code></pre></div><p>We also need to keep track of the position of the camera in the world:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera&#39;s position in the world </span>
</span></span><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">position</span><span class="p">;</span></span></span></code></pre></div><p>And we need to know what the previous state of the mouse was:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The state of the mouse in the prior frame</span>
</span></span><span class="line"><span class="cl">    <span class="n">MouseState</span> <span class="n">oldMouseState</span><span class="p">;</span></span></span></code></pre></div><p>And an instance of the <code>Game</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The Game this camera belongs to </span>
</span></span><span class="line"><span class="cl">    <span class="n">Game</span> <span class="n">game</span><span class="p">;</span></span></span></code></pre></div><h3 id="public-properties">Public Properties</h3>
<p>We need to define the <code>View</code> and <code>Projection</code> matrices to meet our <code>ICamera</code> inteface requirements:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The view matrix for this camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">View</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="kd">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The projection matrix for this camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">Projection</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="kd">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll keep the setters protected, as they should only be set from within the camera (or a derived camera).</p>
<p>We also will provide a <code>Sensitivity</code> value for fine-tuning the mouse sensitivity; this would likely be adjusted from a menu, so it needs to be public:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The sensitivity of the mouse when aiming</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">Sensitivity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0.0018f</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll likewise expose the speed property, as it may be changed in-game to respond to powerups or special modes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The speed of the player while moving </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">Speed</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0.5f</span><span class="p">;</span></span></span></code></pre></div><h3 id="the-constructor">The Constructor</h3>
<p>Constructing the <code>FPSCamera</code> requires a <code>Game</code> instance, and an initial position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a new FPS Camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this camera belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;position&#34;&gt;The player&#39;s initial position&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">FPSCamera</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Inside the constructor, we&rsquo;ll initialize our angles to <code>0</code> (alternatively, you might also add a facing angle to the constructor so you can control both where the player starts and the direction they face):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">horizontalAngle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">verticalAngle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll also set up our  projection matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span><span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Viewport</span><span class="p">.</span><span class="n">AspectRatio</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1000</span><span class="p">);</span></span></span></code></pre></div><p>And finally, we&rsquo;ll center the mouse in the window, and save its state:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">Mouse</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Height</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">oldMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><h3 id="the-update-method">The Update Method</h3>
<p>The <code>Update()</code> method is where the heavy lifting of the class occurs, updating the camera position and calculating the view matrix.  There&rsquo;s a lot going on here, so we&rsquo;ll assemble it line-by-line, discusing each as we add it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Updates the camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The current GameTime&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>First up, we&rsquo;ll grab current input states:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">keyboard</span> <span class="p">=</span> <span class="n">Keyboard</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">newMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><p>Then we&rsquo;ll want to handle movement.  Before we move the camera, we need to know what direction it is currenlty facing.  We can represent this with a <code>Vector3</code> in that direction, which we calculate by rotating a forward vector by the horizontal angle:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Get the direction the player is currently facing</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">facing</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">horizontalAngle</span><span class="p">));</span></span></span></code></pre></div><p>Then we can apply forward and backward movement along this vector when the W or S keys are pressed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Forward and backward movement</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">W</span><span class="p">))</span> <span class="n">position</span> <span class="p">+=</span> <span class="n">facing</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">S</span><span class="p">))</span> <span class="n">position</span> <span class="p">-=</span> <span class="n">facing</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span></span></span></code></pre></div><p>The A and D keys provide <em>strifing</em> movement, movement <em>perpendicular</em> to the forward vector.  We can find this perpendicular vector by calculating the cross product of the facing and up vectors:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Strifing movement</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">A</span><span class="p">))</span> <span class="n">position</span> <span class="p">+=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">,</span> <span class="n">facing</span><span class="p">)</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">D</span><span class="p">))</span> <span class="n">position</span> <span class="p">-=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">,</span> <span class="n">facing</span><span class="p">)</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span></span></span></code></pre></div><p>That wraps up moving the camera&rsquo;s position in the world.  Now we need to tackle where the camera is looking.  This means adusting the vertical and horizontal angles based on mouse movement this frame (which we caculate by subtracing the new mouse position from the old):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Adjust horizontal angle</span>
</span></span><span class="line"><span class="cl">    <span class="n">horizontalAngle</span> <span class="p">+=</span> <span class="n">Sensitivity</span> <span class="p">*</span> <span class="p">(</span><span class="n">oldMouseState</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">newMouseState</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Adjust vertical angle </span>
</span></span><span class="line"><span class="cl">    <span class="n">verticalAngle</span> <span class="p">+=</span> <span class="n">Sensitivity</span> <span class="p">*</span> <span class="p">(</span><span class="n">oldMouseState</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">newMouseState</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span></span></span></code></pre></div><p>From these angles, we can calculate the direction the camera is facing, by rotating a forward-facing vector in both the horizontal and vertical axes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">direction</span> <span class="p">=</span>  <span class="n">Vector3</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationX</span><span class="p">(</span><span class="n">verticalAngle</span><span class="p">)</span> <span class="p">*</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">horizontalAngle</span><span class="p">));</span></span></span></code></pre></div><p>With that direction, we can now calculate the view matrix using <code>Matrix.CreateLookAt()</code>.  The target vector is the direction vector added to the position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// create the veiw matrix</span>
</span></span><span class="line"><span class="cl">    <span class="n">View</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="p">+</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">);</span></span></span></code></pre></div><p>Lastly, we reset the mouse state.  First we re-center the mouse, and then we save its new centered state as our old mouse state.  This centering is important in Windowed mode, as it keeps our mouse within the window even as the player spins 360 degrees or more.  Otherwise, our mouse would pop out of the window, and could interact with other windows while the player is trying to play our game.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Reset mouse state </span>
</span></span><span class="line"><span class="cl">    <span class="n">Mouse</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Height</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">oldMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><p>This does mean that you can no longer use the mouse to close the window, so it is important to have a means to exit the game.  By default, the <code>Game1</code> class uses hitting the escape key to do this. In full games you&rsquo;ll probably replace that functionality with a menu that contains an exit option.</p>
<h2 id="refactoring-the-game-class">Refactoring the Game Class</h2>
<p>Of course, to use this camera, you&rsquo;ll need to replace the <code>CirclingCamera</code> references in <code>Game1</code> with our <code>FPSCamera</code> implementation.  So you&rsquo;ll define a private <code>FPSCamera</code> reference:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The game camera</span>
</span></span><span class="line"><span class="cl">    <span class="n">FPSCamera</span> <span class="n">camera</span><span class="p">;</span></span></span></code></pre></div><p>Initialize it with its starting position in the <code>LoadContent()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Initialize the camera </span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FPSCamera</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">10</span><span class="p">));</span></span></span></code></pre></div><p>Update it in the <code>Update()</code> method (which isn&rsquo;t really a change):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Update the camera</span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span></span></span></code></pre></div><p>And provide it to the crates in the <code>Draw()</code> method (again, this shouldn&rsquo;t be a change from the <code>CirclingCamera</code> implementation):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Draw some crates</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="n">Crate</span> <span class="n">crate</span> <span class="k">in</span> <span class="n">crates</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">crate</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Now if you run the game, you should be able to move around the scene using WASD keys and the mouse.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>
</div>
</main>
</div>



<script src="/cis580/js/clipboard.min.js?1737133119" defer></script>
<script src="/cis580/js/perfect-scrollbar.min.js?1737133119" defer></script>
<script src="/cis580/js/theme.js?1737133119" defer></script>

<script src="/cis580/js/embed-iframe.js?1737133119" defer></script>
</body>
</html>
