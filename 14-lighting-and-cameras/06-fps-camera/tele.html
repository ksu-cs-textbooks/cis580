




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 580 Textbook">
    <meta name="author" content="Nathan H. Bean">
    <title>FPS Camera :: K-State CIS 580 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis580/14-lighting-and-cameras/06-fps-camera/index.html" rel="canonical" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/14-lighting-and-cameras/06-fps-camera/index.xml" rel="alternate" type="application/rss+xml" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/14-lighting-and-cameras/06-fps-camera/index.print.html" rel="alternate" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/14-lighting-and-cameras/06-fps-camera/embed.html" rel="alternate" type="text/html" title="FPS Camera :: K-State CIS 580 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/nucleus.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/perfect-scrollbar.min.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme-auto.css?1692031300" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/variant.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/print.css?1692031300" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/ie.css?1692031300" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/url.js?1692031300"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/variant.js?1692031300"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis580/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis580/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis580/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/custom.css?1692031300" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis580/14-lighting-and-cameras/06-fps-camera/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="fps-camera">FPS Camera</h1>

<p>Let&rsquo;s go ahead and create a camera that the player can actually control.  This time, we&rsquo;ll adopt a camera made popular by PC first-person shooters, where the player&rsquo;s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.</p>
<h2 id="the-fps-camera-class">The FPS Camera Class</h2>
<p>Let&rsquo;s start by defining our class, <code>FPSCamera</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// A camera controlled by WASD + Mouse</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FPSCamera</span> : ICamera
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><h3 id="private-fields">Private Fields</h3>
<p>This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis <em>only</em> controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player&rsquo;s movement.  Thus, we&rsquo;ll need to track these angles separately, and combine them when needed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The angle of rotation about the Y-axis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> horizontalAngle;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// The angle of rotation about the X-axis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> verticalAngle;</span></span></code></pre></div><p>We also need to keep track of the position of the camera in the world:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The camera&#39;s position in the world </span>
</span></span><span style="display:flex;"><span>    Vector3 position;</span></span></code></pre></div><p>And we need to know what the previous state of the mouse was:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The state of the mouse in the prior frame</span>
</span></span><span style="display:flex;"><span>    MouseState oldMouseState;</span></span></code></pre></div><p>And an instance of the <code>Game</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The Game this camera belongs to </span>
</span></span><span style="display:flex;"><span>    Game game;</span></span></code></pre></div><h3 id="public-properties">Public Properties</h3>
<p>We need to define the <code>View</code> and <code>Projection</code> matrices to meet our <code>ICamera</code> inteface requirements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The view matrix for this camera</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Matrix View { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The projection matrix for this camera</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Matrix Projection { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>We&rsquo;ll keep the setters protected, as they should only be set from within the camera (or a derived camera).</p>
<p>We also will provide a <code>Sensitivity</code> value for fine-tuning the mouse sensitivity; this would likely be adjusted from a menu, so it needs to be public:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The sensitivity of the mouse when aiming</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Sensitivity { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#ae81ff">0.0018f</span>;</span></span></code></pre></div><p>We&rsquo;ll likewise expose the speed property, as it may be changed in-game to respond to powerups or special modes:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The speed of the player while moving </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Speed { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#ae81ff">0.5f</span>;</span></span></code></pre></div><h3 id="the-constructor">The Constructor</h3>
<p>Constructing the <code>FPSCamera</code> requires a <code>Game</code> instance, and an initial position:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new FPS Camera</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;game&#34;&gt;The game this camera belongs to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;position&#34;&gt;The player&#39;s initial position&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> FPSCamera(Game game, Vector3 position)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.game = game;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.position = position;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Inside the constructor, we&rsquo;ll initialize our angles to <code>0</code> (alternatively, you might also add a facing angle to the constructor so you can control both where the player starts and the direction they face):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.horizontalAngle = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.verticalAngle = <span style="color:#ae81ff">0</span>;</span></span></code></pre></div><p>We&rsquo;ll also set up our  projection matrix:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.Projection = Matrix.CreatePerspectiveFieldOfView(MathHelper.PiOver4, game.GraphicsDevice.Viewport.AspectRatio, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1000</span>);</span></span></code></pre></div><p>And finally, we&rsquo;ll center the mouse in the window, and save its state:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Mouse.SetPosition(game.Window.ClientBounds.Width / <span style="color:#ae81ff">2</span>, game.Window.ClientBounds.Height / <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    oldMouseState = Mouse.GetState();</span></span></code></pre></div><h3 id="the-update-method">The Update Method</h3>
<p>The <code>Update()</code> method is where the heavy lifting of the class occurs, updating the camera position and calculating the view matrix.  There&rsquo;s a lot going on here, so we&rsquo;ll assemble it line-by-line, discusing each as we add it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Updates the camera</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;The current GameTime&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Update(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>First up, we&rsquo;ll grab current input states:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> keyboard = Keyboard.GetState();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> newMouseState = Mouse.GetState();</span></span></code></pre></div><p>Then we&rsquo;ll want to handle movement.  Before we move the camera, we need to know what direction it is currenlty facing.  We can represent this with a <code>Vector3</code> in that direction, which we calculate by rotating a forward vector by the horizontal angle:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Get the direction the player is currently facing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> facing = Vector3.Transform(Vector3.Forward, Matrix.CreateRotationY(horizontalAngle));</span></span></code></pre></div><p>Then we can apply forward and backward movement along this vector when the W or S keys are pressed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Forward and backward movement</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (keyboard.IsKeyDown(Keys.W)) position += facing * Speed;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (keyboard.IsKeyDown(Keys.S)) position -= facing * Speed;</span></span></code></pre></div><p>The A and D keys provide <em>strifing</em> movement, movement <em>perpendicular</em> to the forward vector.  We can find this perpendicular vector by calculating the cross product of the facing and up vectors:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Strifing movement</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (keyboard.IsKeyDown(Keys.A)) position += Vector3.Cross(Vector3.Up, facing) * Speed;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (keyboard.IsKeyDown(Keys.D)) position -= Vector3.Cross(Vector3.Up, facing) * Speed;</span></span></code></pre></div><p>That wraps up moving the camera&rsquo;s position in the world.  Now we need to tackle where the camera is looking.  This means adusting the vertical and horizontal angles based on mouse movement this frame (which we caculate by subtracing the new mouse position from the old):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Adjust horizontal angle</span>
</span></span><span style="display:flex;"><span>    horizontalAngle += Sensitivity * (oldMouseState.X - newMouseState.X);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Adjust vertical angle </span>
</span></span><span style="display:flex;"><span>    verticalAngle += Sensitivity * (oldMouseState.Y - newMouseState.Y);</span></span></code></pre></div><p>From these angles, we can calculate the direction the camera is facing, by rotating a forward-facing vector in both the horizontal and vertical axes:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    direction =  Vector3.Transform(Vector3.Forward, Matrix.CreateRotationX(verticalAngle) * Matrix.CreateRotationY(horizontalAngle));</span></span></code></pre></div><p>With that direction, we can now calculate the view matrix using <code>Matrix.CreateLookAt()</code>.  The target vector is the direction vector added to the position:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// create the veiw matrix</span>
</span></span><span style="display:flex;"><span>    View = Matrix.CreateLookAt(position, position + direction, Vector3.Up);</span></span></code></pre></div><p>Lastly, we reset the mouse state.  First we re-center the mouse, and then we save its new centered state as our old mouse state.  This centering is important in Windowed mode, as it keeps our mouse within the window even as the player spins 360 degrees or more.  Otherwise, our mouse would pop out of the window, and could interact with other windows while the player is trying to play our game.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Reset mouse state </span>
</span></span><span style="display:flex;"><span>    Mouse.SetPosition(game.Window.ClientBounds.Width / <span style="color:#ae81ff">2</span>, game.Window.ClientBounds.Height / <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    oldMouseState = Mouse.GetState();</span></span></code></pre></div><p>This does mean that you can no longer use the mouse to close the window, so it is important to have a means to exit the game.  By default, the <code>Game1</code> class uses hitting the escape key to do this. In full games you&rsquo;ll probably replace that functionality with a menu that contains an exit option.</p>
<h2 id="refactoring-the-game-class">Refactoring the Game Class</h2>
<p>Of course, to use this camera, you&rsquo;ll need to replace the <code>CirclingCamera</code> references in <code>Game1</code> with our <code>FPSCamera</code> implementation.  So you&rsquo;ll define a private <code>FPSCamera</code> reference:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The game camera</span>
</span></span><span style="display:flex;"><span>    FPSCamera camera;</span></span></code></pre></div><p>Initialize it with its starting position in the <code>LoadContent()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Initialize the camera </span>
</span></span><span style="display:flex;"><span>    camera = <span style="color:#66d9ef">new</span> FPSCamera(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> Vector3(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">10</span>));</span></span></code></pre></div><p>Update it in the <code>Update()</code> method (which isn&rsquo;t really a change):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Update the camera</span>
</span></span><span style="display:flex;"><span>    camera.Update(gameTime);</span></span></code></pre></div><p>And provide it to the crates in the <code>Draw()</code> method (again, this shouldn&rsquo;t be a change from the <code>CirclingCamera</code> implementation):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Draw some crates</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Crate crate <span style="color:#66d9ef">in</span> crates)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        crate.Draw(camera);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now if you run the game, you should be able to move around the scene using WASD keys and the mouse.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/clipboard.min.js?1692031300" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/perfect-scrollbar.min.js?1692031300" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/theme.js?1692031300" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/tele-scroll.js?1692031300 defer"></script>
    
  </body>
</html>
