




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Lights, Camera, Action!">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Lighting and Cameras :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Lights, Camera, Action!">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/14-lighting-and-cameras/">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Lighting and Cameras :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Lights, Camera, Action!">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Lighting and Cameras :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Lights, Camera, Action!">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="wordCount" content="3">
    <title>Lighting and Cameras :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/14-lighting-and-cameras/" rel="canonical" type="text/html" title="Lighting and Cameras :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/index.xml" rel="alternate" type="application/rss+xml" title="Lighting and Cameras :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/tele.html" rel="alternate" type="text/html" title="Lighting and Cameras :: K-State CIS 580 Textbook">
    <link href="/cis580/14-lighting-and-cameras/embed.html" rel="alternate" type="text/html" title="Lighting and Cameras :: K-State CIS 580 Textbook">
    <link href="/cis580/css/fontawesome-all.min.css?1719519539" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1719519539" rel="stylesheet"></noscript>
    <link href="/cis580/css/nucleus.css?1719519539" rel="stylesheet">
    <link href="/cis580/css/auto-complete.css?1719519539" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1719519539" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar.min.css?1719519539" rel="stylesheet">
    <link href="/cis580/css/fonts.css?1719519539" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1719519539" rel="stylesheet"></noscript>
    <link href="/cis580/css/theme.css?1719519539" rel="stylesheet">
    <link href="/cis580/css/theme-auto.css?1719519539" rel="stylesheet" id="R-variant-style">
    <link href="/cis580/css/chroma-auto.css?1719519539" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/cis580/css/variant.css?1719519539" rel="stylesheet">
    <link href="/cis580/css/print.css?1719519539" rel="stylesheet" media="print">
    <link href="/cis580/css/format-print.css?1719519539" rel="stylesheet">
    <script src="/cis580/js/variant.js?1719519539"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.index_js_url="/cis580/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    
    <link href="/cis580/css/custom.css?1719519539" rel="stylesheet">
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/cis580/14-lighting-and-cameras/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Lighting and Cameras</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/13-basic-3d-rendering/05-summary/" title="Summary (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/14-lighting-and-cameras/01-introduction/" title="Introduction (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="lighting-and-cameras">Lighting and Cameras</h1>

<p>Lights, Camera, Action!</p>
<img src="https://media.giphy.com/media/U8FvqfxkzxoSpokGaW/giphy.gif">
            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Lighting and Cameras</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="introduction">Introduction</h1>

<p>You&rsquo;ve now seen how vertices are grouped into triangles and rendered using accelerated hardware, how we can use a mesh of triangles to represent more complex objects, and how we can apply a texture to that mesh to provide visual detail.  Now we need to add light sources that can add shading to our models, and a camera which can be shared by all objects in a scene to provide a common view and projection matrix.</p>
<p>We&rsquo;ll once again be working from a starter project, which provides our needed content resources.  You can clone the starter from GitHub here: <a href="https://github.com/ksu-cis/lighting-and-cameras-starter" rel="external" target="_blank">https://github.com/ksu-cis/lighting-and-cameras-starter</a></p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="adding-a-crate">Adding a Crate</h1>

<p>The first thing we&rsquo;ll want to add is something to render.  For this example we&rsquo;ll employ a very common game prop - a crate.  As you might expect, a crate is little more than a cube with a texture applied.  However, we will need to make a few changes from our previous <code>Cube</code> class.</p>
<h2 id="cratetype-enum">CrateType Enum</h2>
<p>One of these is adding a texture - but we actually have three possible textures to choose from: &ldquo;crate0_diffuse&rdquo;, &ldquo;crate1_diffuse&rdquo;, and &ldquo;crate2_diffuse&rdquo;.   Let&rsquo;s make our single class represent all three possible crates, and use an enumeration to define which crate to create:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// The type of crate to create</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">CrateType</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Slats</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cross</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">DarkCross</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If we mark the first enum value as <code>0</code>, then the second and third will be <code>1</code> and <code>2</code> respectively.  Thus, we can convert an enum value into a filename through casting and concatenation: <code>$&quot;crate{(int)value}_diffuse&quot;</code>.  We&rsquo;ll use this approach in our constructor.</p>
<h2 id="crate-class">Crate Class</h2>
<p>Before we get to that, let&rsquo;s definine the class and its fields:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A class representing a crate</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Crate</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// The game this crate belongs to</span>
</span></span><span class="line"><span class="cl">    <span class="n">Game</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The VertexBuffer of crate vertices</span>
</span></span><span class="line"><span class="cl">    <span class="n">VertexBuffer</span> <span class="n">vertexBuffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The IndexBuffer defining the Crate&#39;s triangles</span>
</span></span><span class="line"><span class="cl">    <span class="n">IndexBuffer</span> <span class="n">indexBuffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The effect to render the crate with</span>
</span></span><span class="line"><span class="cl">    <span class="n">BasicEffect</span> <span class="n">effect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The texture to apply to the crate</span>
</span></span><span class="line"><span class="cl">    <span class="n">Texture2D</span> <span class="n">texture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>No surprises here - it looks very much like our prior shapes.</p>
<h3 id="initializevertices">InitializeVertices</h3>
<p>But we&rsquo;ll use a different vertex format for our vertices, <code>VertexPositionNormalTexture</code>.  This vertex includes a <code>Position</code> (a <code>Vector3</code>), a <code>Normal</code> (a <code>Vector3</code> that is perpendicular to the surface at the vertex), and a <code>TextureCoordinate</code> (a <code>Vector2</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the vertex of the cube</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">InitializeVertices</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">vertexData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">[]</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">// Front Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Back Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Backward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Top Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Bottom Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Down</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Down</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Down</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Down</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Left Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Left</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Left</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Left</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Left</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Right Face</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Right</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Right</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Right</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">VertexPositionNormalTexture</span><span class="p">()</span> <span class="p">{</span> <span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span> <span class="m">1.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">1.0f</span><span class="p">),</span> <span class="n">TextureCoordinate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="n">Normal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Right</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertexBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">VertexBuffer</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">VertexPositionNormalTexture</span><span class="p">),</span> <span class="n">vertexData</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">BufferUsage</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertexBuffer</span><span class="p">.</span><span class="n">SetData</span><span class="p">&lt;</span><span class="n">VertexPositionNormalTexture</span><span class="p">&gt;(</span><span class="n">vertexData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Defining the vertices is not much differen than we did for our <code>Cube</code>, except that we now need to include texture coordinates.  This <em>does</em> mean that we can no longer share vertices between faces, as they will have different texture coordinates.  Similarly, the different faces have different normals, which are a vector <em>out</em> of the face - hence the <code>Vector3.Up</code> (0, 1, 0) for the top face, <code>Vector3.Right</code> (1, 0, 0) for the right face, and so on.</p>
<p>We&rsquo;ll copy these values into our <code>vertexBuffer</code> for later use.</p>
<h3 id="initializing-the-indices">Initializing the Indices</h3>
<p>The index buffer is handled similarily:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the Index Buffer</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">InitializeIndices</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">indexData</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">short</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Front face</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Back face </span>
</span></span><span class="line"><span class="cl">            <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Top face</span>
</span></span><span class="line"><span class="cl">            <span class="m">8</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">8</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Bottom face </span>
</span></span><span class="line"><span class="cl">            <span class="m">12</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">12</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Left face </span>
</span></span><span class="line"><span class="cl">            <span class="m">16</span><span class="p">,</span> <span class="m">18</span><span class="p">,</span> <span class="m">17</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">16</span><span class="p">,</span> <span class="m">19</span><span class="p">,</span> <span class="m">18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Right face </span>
</span></span><span class="line"><span class="cl">            <span class="m">20</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">21</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">20</span><span class="p">,</span> <span class="m">23</span><span class="p">,</span> <span class="m">22</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">indexBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IndexBuffer</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">,</span> <span class="n">IndexElementSize</span><span class="p">.</span><span class="n">SixteenBits</span><span class="p">,</span> <span class="n">indexData</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">BufferUsage</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">indexBuffer</span><span class="p">.</span><span class="n">SetData</span><span class="p">&lt;</span><span class="kt">short</span><span class="p">&gt;(</span><span class="n">indexData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="initializing-the-effect">Initializing the Effect</h3>
<p>And our effect is handled as with the textured quad:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the BasicEffect to render our crate</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">void</span> <span class="n">InitializeEffect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BasicEffect</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateScale</span><span class="p">(</span><span class="m">2.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">View</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">12</span><span class="p">),</span> <span class="c1">// The camera position</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="c1">// The camera target,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span>            <span class="c1">// The camera up vector</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span>                         <span class="c1">// The field-of-view </span>
</span></span><span class="line"><span class="cl">            <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Viewport</span><span class="p">.</span><span class="n">AspectRatio</span><span class="p">,</span>   <span class="c1">// The aspect ratio</span>
</span></span><span class="line"><span class="cl">            <span class="m">0.1f</span><span class="p">,</span> <span class="c1">// The near plane distance </span>
</span></span><span class="line"><span class="cl">            <span class="m">100.0f</span> <span class="c1">// The far plane distance</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">TextureEnabled</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">Texture</span> <span class="p">=</span> <span class="n">texture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="drawing-the-crate">Drawing the Crate</h3>
<p>As is drawing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Draws the crate</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// apply the effect </span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">CurrentTechnique</span><span class="p">.</span><span class="n">Passes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Apply</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// set the vertex buffer</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">SetVertexBuffer</span><span class="p">(</span><span class="n">vertexBuffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set the index buffer</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Indices</span> <span class="p">=</span> <span class="n">indexBuffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Draw the triangles</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">DrawIndexedPrimitives</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">PrimitiveType</span><span class="p">.</span><span class="n">TriangleList</span><span class="p">,</span> <span class="c1">// Tye type to draw</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>                          <span class="c1">// The first vertex to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>                          <span class="c1">// The first index to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">12</span>                          <span class="c1">// the number of triangles to draw</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="constructing-the-crate">Constructing the Crate</h3>
<p>When we construct the crate is where we see the next change - we&rsquo;ll need to determine which texture to load:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Creates a new crate instance</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this crate belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;type&#34;&gt;The type of crate to use&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Crate</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">CrateType</span> <span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">texture</span> <span class="p">=</span> <span class="n">game</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="s">$&#34;crate{(int)type}_diffuse&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeVertices</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeIndices</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeEffect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h2 id="adding-the-crate-to-the-game">Adding the Crate to the Game</h2>
<p>And, as before, we&rsquo;ll add our crate to the game and draw it.  We&rsquo;ll need an instance variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// our crate</span>
</span></span><span class="line"><span class="cl">    <span class="n">Crate</span> <span class="n">crate</span><span class="p">;</span></span></span></code></pre></div><p>Which we&rsquo;ll initialize in <code>Game.LoadContent()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// initialize the crate </span>
</span></span><span class="line"><span class="cl">    <span class="n">crate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">Slats</span><span class="p">);</span></span></span></code></pre></div><p>And render in our <code>Game.Draw()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">crate</span><span class="p">.</span><span class="n">Draw</span><span class="p">();</span></span></span></code></pre></div><p>If you run the game now, you should see our crate appear!</p>
<p><a href="#R-image-35f991c6a53bc455c8b1172a3519104a" class="lightbox-link"><img alt="The rendered crate" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/lighting-and-cameras-2.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-35f991c6a53bc455c8b1172a3519104a"><img alt="The rendered crate" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/lighting-and-cameras-2.1.png"></a></p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="adding-lights">Adding Lights</h1>

<p>Well, we have a crate.  Let&rsquo;s make it more interesting by adding some lights.  To start with, we&rsquo;ll use the <code>BasicEffect</code>&rsquo;s default lights.  Add the line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">effect</span><span class="p">.</span><span class="n">EnableDefaultLighting</span><span class="p">();</span></span></span></code></pre></div><p>Into your <code>Crate.IntializeEffect()</code> method.  Then run the program again.  Notice a difference?</p>
<p><a href="#R-image-5fbba83c01adee8cd62a5998ad6c6432" class="lightbox-link"><img alt="Side-by-side comparison of a lit and unlit crate" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5fbba83c01adee8cd62a5998ad6c6432"><img alt="Side-by-side comparison of a lit and unlit crate" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.1.png"></a>.</p>
<p>The default lighting is useful to quickly see what our object will look like illuminated, but ultimately, we&rsquo;ll want to define our own lights and how they interact with our objects.</p>
<h2 id="lighting-calculations">Lighting Calculations</h2>
<p>The <code>BasicEffect</code> uses the <a href="https://en.wikipedia.org/wiki/Phong_shading" rel="external" target="_blank">Phong shading model</a> (named after its inventor, Bui Tuong Phong).  This model approximates shading accounting for the smoothness of the object.  It uses an equation to calculate the color of each pixel.  This equation appears in the image below:</p>
<p><a href="#R-image-d288fc0c292e0d340fb7a8d48aad46b1" class="lightbox-link"><img alt="Phong equation" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/phong-equation.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d288fc0c292e0d340fb7a8d48aad46b1"><img alt="Phong equation" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/phong-equation.png"></a></p>
<p>Essentailly, the Phong approach calculates three different lighting values, and combines them into shading values to apply to a model.  Each of these is based on the behavior of light, which is a particle (and a wave) that travels in (largely) stright lines.  We can think of these lines as rays.</p>
<p>The first is <em>ambient</em> light, which reprsents light that has been bouncing around the scene so much that it is hitting our object from all directions.  Rather than try to capture that chaos, the Phong model simply substitutes a single flat value that is applied to all surfaces in the scene.  In a brightly lit scene, this might be a high value; for a creepy night scene, we would use a very low value to provide only dim illumination away from light sources.</p>
<p>The second is <em>diffuse</em> light, which is the light that strikes a surface and scatters.  We choose the strength of this light based on the characteristics of the material.  Rough materials have more diffuse light, as the light striking the surface bounces off in all directions, so only some of it is toward the observer.</p>
<p>The third is <em>specular</em> light, which is <em>also</em> light that strikes a surface and bounces off, and is chosen by the properties of the material.  However, high specular light corresponds to smooth surfaces - because they are smooth, light rays that strike near one another tend to bounce the same direction.  Hence, light that is striking at the right angle will all bounce towards the veiwer, creating &ldquo;hot spots&rdquo; of very bright color.</p>
<p>These calculations are based on the angle between the surface and the viewer - this is why we need to provide a normal, as well as a direction the camera is looking and a direction the light is coming from; the angles between these vectors are used in calculating these lighting components.</p>
<p>The <code>BasicEffect</code> uses the <a href="https://www.monogame.net/documentation/?page=T_Microsoft_Xna_Framework_Graphics_DirectionalLight" rel="external" target="_blank">DirectionalLight class</a> to represent lights.  You define the diffuse and specular color as <code>Vector3</code> objects (where the x,y,and z correspond to rgb values, within the range [0..1] where 0 is no light, and 1 is full light).  You also define a direction the light is coming from as a <code>Vector3</code>.  Since ambient light doesn&rsquo;t have a direction, you simply represent it with a color <code>Vector3</code>.  When the object is rendered, the shader combines those color contributions of each light additively with the colors sampled from the texture(s) that are being applied.  We can define up to three directional light sources with the <code>BasicEffect</code>.</p>
<h2 id="customizing-our-crate-lighting">Customizing our Crate Lighting</h2>
<p>Let&rsquo;s see this in action.  Delete the <code>effect.EnableDefaultLighting()</code> line in your <code>Crate.InitializeEffect()</code> and replace it with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Turn on lighting</span>
</span></span><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">LightingEnabled</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Set up light 0</span>
</span></span><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">DirectionalLight0</span><span class="p">.</span><span class="n">Enabled</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">DirectionalLight0</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">DirectionalLight0</span><span class="p">.</span><span class="n">DiffuseColor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0.8f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">DirectionalLight0</span><span class="p">.</span><span class="n">SpecularColor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">);</span></span></span></code></pre></div><p>Notice the difference?  We&rsquo;re shining a red light onto our crate from an oblique angle, above and to the left.</p>
<p><a href="#R-image-f61767a7e35e08282d060d9eb22725e4" class="lightbox-link"><img alt="The Illuminated Crate" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f61767a7e35e08282d060d9eb22725e4"><img alt="The Illuminated Crate" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.2.png"></a></p>
<p>Notice how one face of the crate is in complete shadow?  Let&rsquo;s add some ambient light with the command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">effect</span><span class="p">.</span><span class="n">AmbientLightColor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0.3f</span><span class="p">,</span> <span class="m">0.3f</span><span class="p">,</span> <span class="m">0.3f</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-2c5fd1975487785e759dd5768b8619ca" class="lightbox-link"><img alt="The crate with ambient light" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2c5fd1975487785e759dd5768b8619ca"><img alt="The crate with ambient light" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/lighting-and-cameras-3.3.png"></a></p>
<p>Notice how the shadowed face is now somewhat visible?</p>
<p>Go ahead and try tweaking the values for <code>AmbientLightColor</code> and <code>DirectionalLight0</code>, and see how that changes the way your crate looks.  You can also set the properties of <code>DirectionalLight1</code> and <code>DirectionalLight2</code>.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="adding-a-camera">Adding a Camera</h1>

<p>So far we&rsquo;ve set the World, View, and Transform matrix of each 3D object within that object.  That works fine for these little demo projects, but once we start building a full-fledged game, we expect to look at everything in the world <em>from the same perspective</em>.  This effectively means we want to use the <em>same</em> view and perspective matrices for all objects in a scene.  Moreover, we want to move that perspective around in a well-defined manner.</p>
<p>What we want is a <em>camera</em> - an object that maintains a position and derives a view matrix from that position.  Our camera also should provide a projection matrix, as we may want to tweak it in response to game activity - i.e. we might swap it for another matrix when the player uses a sniper rifle.</p>
<p>In fact, we may want <em>multiple</em> cameras in a game.  We might want to change from a first-person camera to an overhead camera when the player gets into a vehicle, or we may want to present a fly-through of the level before the player starts playing.  Since each of these may work in very different ways, let&rsquo;s start by defining an interface of their common aspects.</p>
<h2 id="the-icamera-interface">The ICamera Interface</h2>
<p>Those commonalities are our two matrices - the view and the perspective.  Let&rsquo;s expose them with read-only properties (properties with only a getter):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// An interface defining a camera</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">interface</span> <span class="nc">ICamera</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The view matrix</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Matrix</span> <span class="n">View</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The projection matrix</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Matrix</span> <span class="n">Projection</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now let&rsquo;s define some cameras.</p>
<h2 id="circlingcamera">CirclingCamera</h2>
<p>To start with, let&rsquo;s duplicate something we&rsquo;ve already done.  Let&rsquo;s create a camera that just spins around the origin.  We&rsquo;ll call it <code>CirclingCamera</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A camera that circles the origin </span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">CirclingCamera</span> <span class="p">:</span> <span class="n">ICamera</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We know from our previous work, we&rsquo;ll need to keep track of the angle:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera&#39;s angle </span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">angle</span><span class="p">;</span></span></span></code></pre></div><p>We might also hold a vector for the camera&rsquo;s position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera&#39;s position</span>
</span></span><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">position</span><span class="p">;</span></span></span></code></pre></div><p>And a rotation speed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera&#39;s speed </span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">speed</span><span class="p">;</span></span></span></code></pre></div><p>And the <code>Game</code> (which we need to determine the aspect ratio of the screen):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The game this camera belongs to </span>
</span></span><span class="line"><span class="cl">    <span class="n">Game</span> <span class="n">game</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll also define private backing variables for our view and perspective matrices:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The view matrix </span>
</span></span><span class="line"><span class="cl">    <span class="n">Matrix</span> <span class="n">view</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The projection matrix </span>
</span></span><span class="line"><span class="cl">    <span class="n">Matrix</span> <span class="n">projection</span><span class="p">;</span></span></span></code></pre></div><p>And fulfill our interface by making them accessible as properties:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The camera&#39;s view matrix </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">View</span> <span class="p">=&gt;</span> <span class="n">view</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The camera&#39;s projection matrix </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">Projection</span> <span class="p">=&gt;</span> <span class="n">projection</span><span class="p">;</span></span></span></code></pre></div><p>Then we can add our constructor:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a new camera that circles the origin</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this camera belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;position&#34;&gt;The initial position of the camera&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;speed&#34;&gt;The speed of the camera&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CirclingCamera</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">speed</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">speed</span> <span class="p">=</span> <span class="n">speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">projection</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Viewport</span><span class="p">.</span><span class="n">AspectRatio</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">1000</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">view</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">position</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Vector3</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>This just sets our initial variables.  Finally, we can write our update method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Updates the camera&#39;s positon</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// update the angle based on the elapsed time and speed</span>
</span></span><span class="line"><span class="cl">        <span class="n">angle</span> <span class="p">+=</span> <span class="n">speed</span> <span class="p">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">gameTime</span><span class="p">.</span><span class="n">ElapsedGameTime</span><span class="p">.</span><span class="n">TotalSeconds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Calculate a new view matrix</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">view</span> <span class="p">=</span> 
</span></span><span class="line"><span class="cl">            <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="p">*</span>
</span></span><span class="line"><span class="cl">            <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Since our rotation is around the origin, we can simply multiply a lookat matrix by a rotation matrix representing the incremental change.</p>
<h2 id="refactoring-game1">Refactoring Game1</h2>
<p>Finally, we&rsquo;ll need to add our camera to the <code>Game1</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera </span>
</span></span><span class="line"><span class="cl">    <span class="n">CirclingCamera</span> <span class="n">camera</span><span class="p">;</span></span></span></code></pre></div><p>Initialize it in the <code>Game.LoadContent()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Initialize the camera </span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CirclingCamera</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="m">0.5f</span><span class="p">);</span></span></span></code></pre></div><p>Update it in the <code>Game1.Update()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Update the camera </span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span></span></span></code></pre></div><p>And in our draw method, we&rsquo;ll need to supply this camera to our <code>crate</code>.  Replace the line <code>crate.Draw()</code> with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">crate</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span></span></span></code></pre></div><h3 id="refactoring-crate">Refactoring Crate</h3>
<p>This of course means we&rsquo;ll need to tweak the <code>Draw</code> method in <code>Crate</code>.  Change it to this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Draws the crate</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;camera&#34;&gt;The camera to use to draw the crate&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">(</span><span class="n">ICamera</span> <span class="n">camera</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set the view and projection matrices</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">View</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">View</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">Projection</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// apply the effect </span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">CurrentTechnique</span><span class="p">.</span><span class="n">Passes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Apply</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// set the vertex buffer</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">SetVertexBuffer</span><span class="p">(</span><span class="n">vertexBuffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set the index buffer</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Indices</span> <span class="p">=</span> <span class="n">indexBuffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Draw the triangles</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">DrawIndexedPrimitives</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">PrimitiveType</span><span class="p">.</span><span class="n">TriangleList</span><span class="p">,</span> <span class="c1">// Tye type to draw</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>                          <span class="c1">// The first vertex to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>                          <span class="c1">// The first index to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">12</span>                          <span class="c1">// the number of triangles to draw</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Now if you run your code, you should find yourself circling the lit crate.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="more-crates">More Crates!</h1>

<p>Let&rsquo;s up the ante a bit, and add <em>multiple</em> crates to the game.</p>
<h2 id="refactor-crate">Refactor Crate</h2>
<p>We don&rsquo;t want all of our crates in the same spot, so it&rsquo;s time to change our world matrix.  Let&rsquo;s refactor our <code>Crate</code> so we can pass a matrix in through the constructor:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Creates a new crate instance</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this crate belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;type&#34;&gt;The type of crate to use&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;world&#34;&gt;The position and orientation of the crate in the world&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Crate</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">CrateType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Matrix</span> <span class="n">world</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">texture</span> <span class="p">=</span> <span class="n">game</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="s">$&#34;crate{(int)type}_diffuse&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeVertices</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeIndices</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeEffect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">world</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>It is important that we set the <code>effect.World</code> only <em>after</em> we have constructed it in <code>InitializeEffect()</code>.</p>
<h2 id="refactor-game1">Refactor Game1</h2>
<p>Let&rsquo;s use our refactored <code>Crate</code> by changing the variable <code>crate</code> in your <code>Game1</code> class to an array:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// A collection of crates</span>
</span></span><span class="line"><span class="cl">    <span class="n">Crate</span><span class="p">[]</span> <span class="n">crates</span><span class="p">;</span></span></span></code></pre></div><p>And initialize them in the <code>Game1.LoadContent()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Make some crates</span>
</span></span><span class="line"><span class="cl">    <span class="n">crates</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Crate</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">DarkCross</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">Slats</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">Cross</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(-</span><span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">DarkCross</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">)</span> <span class="p">*</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">7</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">Slats</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">-</span><span class="m">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Crate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">CrateType</span><span class="p">.</span><span class="n">Cross</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="m">3</span><span class="p">)</span> <span class="p">*</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateTranslation</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="p">-</span><span class="m">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span></span></span></code></pre></div><p>And draw the collection in <code>Game1.Draw()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Draw some crates</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="n">Crate</span> <span class="n">crate</span> <span class="k">in</span> <span class="n">crates</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">crate</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Try running your code now - you should see a collection of crates.</p>
<p><a href="#R-image-749cba7b00979cc298a1c658dc771f02" class="lightbox-link"><img alt="Crates" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/lighting-and-cameras-5.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-749cba7b00979cc298a1c658dc771f02"><img alt="Crates" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/lighting-and-cameras-5.1.png"></a></p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="fps-camera">FPS Camera</h1>

<p>Let&rsquo;s go ahead and create a camera that the player can actually control.  This time, we&rsquo;ll adopt a camera made popular by PC first-person shooters, where the player&rsquo;s looking direction is controlled by the mouse, and the WASD keys move forward and back and strife side-to-side.</p>
<h2 id="the-fps-camera-class">The FPS Camera Class</h2>
<p>Let&rsquo;s start by defining our class, <code>FPSCamera</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// A camera controlled by WASD + Mouse</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">FPSCamera</span> <span class="p">:</span> <span class="n">ICamera</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="private-fields">Private Fields</h3>
<p>This camera is somewhat unique in it partially the splits vertical from horizontal axes; the vertical axis <em>only</em> controls the angle the player is looking along, while the horizontal axis informs both looking and the direction of the player&rsquo;s movement.  Thus, we&rsquo;ll need to track these angles separately, and combine them when needed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The angle of rotation about the Y-axis</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">horizontalAngle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The angle of rotation about the X-axis</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">verticalAngle</span><span class="p">;</span></span></span></code></pre></div><p>We also need to keep track of the position of the camera in the world:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The camera&#39;s position in the world </span>
</span></span><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">position</span><span class="p">;</span></span></span></code></pre></div><p>And we need to know what the previous state of the mouse was:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The state of the mouse in the prior frame</span>
</span></span><span class="line"><span class="cl">    <span class="n">MouseState</span> <span class="n">oldMouseState</span><span class="p">;</span></span></span></code></pre></div><p>And an instance of the <code>Game</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The Game this camera belongs to </span>
</span></span><span class="line"><span class="cl">    <span class="n">Game</span> <span class="n">game</span><span class="p">;</span></span></span></code></pre></div><h3 id="public-properties">Public Properties</h3>
<p>We need to define the <code>View</code> and <code>Projection</code> matrices to meet our <code>ICamera</code> inteface requirements:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The view matrix for this camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">View</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="kd">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The projection matrix for this camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Matrix</span> <span class="n">Projection</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="kd">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll keep the setters protected, as they should only be set from within the camera (or a derived camera).</p>
<p>We also will provide a <code>Sensitivity</code> value for fine-tuning the mouse sensitivity; this would likely be adjusted from a menu, so it needs to be public:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The sensitivity of the mouse when aiming</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">Sensitivity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0.0018f</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll likewise expose the speed property, as it may be changed in-game to respond to powerups or special modes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The speed of the player while moving </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">Speed</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0.5f</span><span class="p">;</span></span></span></code></pre></div><h3 id="the-constructor">The Constructor</h3>
<p>Constructing the <code>FPSCamera</code> requires a <code>Game</code> instance, and an initial position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a new FPS Camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this camera belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;position&#34;&gt;The player&#39;s initial position&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">FPSCamera</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Inside the constructor, we&rsquo;ll initialize our angles to <code>0</code> (alternatively, you might also add a facing angle to the constructor so you can control both where the player starts and the direction they face):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">horizontalAngle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">verticalAngle</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll also set up our  projection matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span><span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Viewport</span><span class="p">.</span><span class="n">AspectRatio</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1000</span><span class="p">);</span></span></span></code></pre></div><p>And finally, we&rsquo;ll center the mouse in the window, and save its state:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">Mouse</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Height</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">oldMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><h3 id="the-update-method">The Update Method</h3>
<p>The <code>Update()</code> method is where the heavy lifting of the class occurs, updating the camera position and calculating the view matrix.  There&rsquo;s a lot going on here, so we&rsquo;ll assemble it line-by-line, discusing each as we add it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Updates the camera</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The current GameTime&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>First up, we&rsquo;ll grab current input states:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">keyboard</span> <span class="p">=</span> <span class="n">Keyboard</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">newMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><p>Then we&rsquo;ll want to handle movement.  Before we move the camera, we need to know what direction it is currenlty facing.  We can represent this with a <code>Vector3</code> in that direction, which we calculate by rotating a forward vector by the horizontal angle:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Get the direction the player is currently facing</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">facing</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">horizontalAngle</span><span class="p">));</span></span></span></code></pre></div><p>Then we can apply forward and backward movement along this vector when the W or S keys are pressed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Forward and backward movement</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">W</span><span class="p">))</span> <span class="n">position</span> <span class="p">+=</span> <span class="n">facing</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">S</span><span class="p">))</span> <span class="n">position</span> <span class="p">-=</span> <span class="n">facing</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span></span></span></code></pre></div><p>The A and D keys provide <em>strifing</em> movement, movement <em>perpendicular</em> to the forward vector.  We can find this perpendicular vector by calculating the cross product of the facing and up vectors:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Strifing movement</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">A</span><span class="p">))</span> <span class="n">position</span> <span class="p">+=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">,</span> <span class="n">facing</span><span class="p">)</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">D</span><span class="p">))</span> <span class="n">position</span> <span class="p">-=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">,</span> <span class="n">facing</span><span class="p">)</span> <span class="p">*</span> <span class="n">Speed</span><span class="p">;</span></span></span></code></pre></div><p>That wraps up moving the camera&rsquo;s position in the world.  Now we need to tackle where the camera is looking.  This means adusting the vertical and horizontal angles based on mouse movement this frame (which we caculate by subtracing the new mouse position from the old):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Adjust horizontal angle</span>
</span></span><span class="line"><span class="cl">    <span class="n">horizontalAngle</span> <span class="p">+=</span> <span class="n">Sensitivity</span> <span class="p">*</span> <span class="p">(</span><span class="n">oldMouseState</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">newMouseState</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Adjust vertical angle </span>
</span></span><span class="line"><span class="cl">    <span class="n">verticalAngle</span> <span class="p">+=</span> <span class="n">Sensitivity</span> <span class="p">*</span> <span class="p">(</span><span class="n">oldMouseState</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">newMouseState</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span></span></span></code></pre></div><p>From these angles, we can calculate the direction the camera is facing, by rotating a forward-facing vector in both the horizontal and vertical axes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">direction</span> <span class="p">=</span>  <span class="n">Vector3</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">Forward</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationX</span><span class="p">(</span><span class="n">verticalAngle</span><span class="p">)</span> <span class="p">*</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">horizontalAngle</span><span class="p">));</span></span></span></code></pre></div><p>With that direction, we can now calculate the view matrix using <code>Matrix.CreateLookAt()</code>.  The target vector is the direction vector added to the position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// create the veiw matrix</span>
</span></span><span class="line"><span class="cl">    <span class="n">View</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="p">+</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">);</span></span></span></code></pre></div><p>Lastly, we reset the mouse state.  First we re-center the mouse, and then we save its new centered state as our old mouse state.  This centering is important in Windowed mode, as it keeps our mouse within the window even as the player spins 360 degrees or more.  Otherwise, our mouse would pop out of the window, and could interact with other windows while the player is trying to play our game.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Reset mouse state </span>
</span></span><span class="line"><span class="cl">    <span class="n">Mouse</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Width</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">Window</span><span class="p">.</span><span class="n">ClientBounds</span><span class="p">.</span><span class="n">Height</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">oldMouseState</span> <span class="p">=</span> <span class="n">Mouse</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span></span></span></code></pre></div><p>This does mean that you can no longer use the mouse to close the window, so it is important to have a means to exit the game.  By default, the <code>Game1</code> class uses hitting the escape key to do this. In full games you&rsquo;ll probably replace that functionality with a menu that contains an exit option.</p>
<h2 id="refactoring-the-game-class">Refactoring the Game Class</h2>
<p>Of course, to use this camera, you&rsquo;ll need to replace the <code>CirclingCamera</code> references in <code>Game1</code> with our <code>FPSCamera</code> implementation.  So you&rsquo;ll define a private <code>FPSCamera</code> reference:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The game camera</span>
</span></span><span class="line"><span class="cl">    <span class="n">FPSCamera</span> <span class="n">camera</span><span class="p">;</span></span></span></code></pre></div><p>Initialize it with its starting position in the <code>LoadContent()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Initialize the camera </span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FPSCamera</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">10</span><span class="p">));</span></span></span></code></pre></div><p>Update it in the <code>Update()</code> method (which isn&rsquo;t really a change):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Update the camera</span>
</span></span><span class="line"><span class="cl">    <span class="n">camera</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span></span></span></code></pre></div><p>And provide it to the crates in the <code>Draw()</code> method (again, this shouldn&rsquo;t be a change from the <code>CirclingCamera</code> implementation):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Draw some crates</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="n">Crate</span> <span class="n">crate</span> <span class="k">in</span> <span class="n">crates</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">crate</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Now if you run the game, you should be able to move around the scene using WASD keys and the mouse.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="summary">Summary</h1>

<p>In this lesson, we&rsquo;ve seen how to apply Phong lighting using the BasicEffect, and how to set up cameras.  Armed with this knowledge, you&rsquo;re ready to start building explorable game environments.</p>
<p>A good next step is to think about what other kinds of cameras you can create.  What about an over-the-shoulder camera that follows the player?  Or a first-person camera that uses GamePad input?  As you now know, a game camera is nothing more than code to determine where the camera is in a scene, and where it is pointed.  From that, you can create a View matrix.  You might also try expanding the options for the Perspective matrix from the default implementation we&rsquo;ve been using.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          </section>
        </div>
      </main>
    
<div class="git-footer">
  <p class="theme-version-footer">6.0.0</p>
  <p>Last modified by: 
              <i class='fas fa-user'></i> Russell Feldhausen
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/43f194969a638fa4572819da4b31060ad574a9ce">Aug 11, 2023</a>
  </p>
  </div>
  
    
    </div>
    <script src="/cis580/js/clipboard.min.js?1719519539" defer></script>
    <script src="/cis580/js/perfect-scrollbar.min.js?1719519539" defer></script>
    <script src="/cis580/js/theme.js?1719519539" defer></script>
  </body>
</html>
