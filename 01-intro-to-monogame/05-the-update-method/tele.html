




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 580 Textbook">
    <meta name="author" content="Nathan H. Bean">
    <title>The Update Method :: K-State CIS 580 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis580/01-intro-to-monogame/05-the-update-method/index.html" rel="canonical" type="text/html" title="The Update Method :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/01-intro-to-monogame/05-the-update-method/index.xml" rel="alternate" type="application/rss+xml" title="The Update Method :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/01-intro-to-monogame/05-the-update-method/index.print.html" rel="alternate" type="text/html" title="The Update Method :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/01-intro-to-monogame/05-the-update-method/embed.html" rel="alternate" type="text/html" title="The Update Method :: K-State CIS 580 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1691771333" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1691771333" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/nucleus.css?1691771333" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1691771333" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1691771333" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/perfect-scrollbar.min.css?1691771333" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1691771333" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1691771333" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme.css?1691771333" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme-auto.css?1691771333" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/variant.css?1691771333" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/print.css?1691771333" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/ie.css?1691771333" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/url.js?1691771333"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/variant.js?1691771333"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis580/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis580/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis580/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/custom.css?1691771333" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis580/01-intro-to-monogame/05-the-update-method/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="the-update-method">The Update Method</h1>

<p>As we mentioned before, the virtual <code>Game.Update(GameTime gameTime)</code> method is a hook for adding your game&rsquo;s logic.  By overriding this method, and adding your own game logic code, you fulfill the update step of the game loop.</p>
<p>This is where you place the <em>simulation</em> code for your game - where the world the game is representing is updated.  Here, all your actors (the parts of the game world that move and interact) are updated.</p>
<p>Note the <code>GameTime</code> parameter - it provides us with both the total time the game has been running, <em>and</em> the time that has elapsed between this and the previous step through the game loop (the frame).  We can use this in our physics calculations.</p>
<h3 id="our-simple-example">Our Simple Example</h3>
<p>So in our example, we want the ball to move around the screen, according to its velocity.  If you remember your physics, the velocity is the change in position over time, i.e.:</p>
<p>$$
\overrightarrow{p&rsquo;} = \overrightarrow{p} + \overrightarrow{v} * t
$$</p>
<p>We can express this in C# easily:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>_ballPosition += _ballVelocity * (<span style="color:#66d9ef">float</span>)gameTime.ElapsedGameTime.TotalSeconds;</span></span></code></pre></div><p>Add this code to the <code>Update()</code> method, just below the <code>// TODO</code> statement.  Note that MonoGame provides operator overrides for performing algebraic operations on <code>Vector2</code> structs, which makes writing expressions involving vectors very much like the mathematical notation.  Also, note again that we have to cast the double <code>TotalSeconds</code> into a float as we are loosing some precision in the operation.</p>
<p>Also, note that because we multiply the velocity by the elapsed time, it does not matter <em>what</em> our timestep is - the ball will always move at the same speed.  Had we simply added the velocity to the position, a game running with a 60fps timestep would be twice as fast as one running at 30fps.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>You may encounter advocates of using a hard-coded fixed time step to avoid calculations with elapsed time.  While it is true this approach makes those calculations unnecessary (and thus, makes your code more efficient), you are trading off the ability of your game to adjust to different monitor refresh rates.  In cases where your hardware is constant (i.e. the Nintendo Entertainment System), this was an easy choice.  But with computer games, I would advocate for always calculating with the elapsed time.</p>
</div>
</div>
<h4 id="keeping-the-ball-on-screen">Keeping the Ball on-screen</h4>
<p>We need to handle when the ball moves off-screen.  We said we wanted to make it <em>bounce</em> off the edges, which is pretty straightforward.  First, we need to determine if the ball is moving off-screen.  To know when this would happen, we need to know two things:</p>
<ol>
<li>The coordinates of the ball</li>
<li>The coordinates of the edges of the screen</li>
</ol>
<p>For 1, we have <code>_ballPosition</code>.  Let&rsquo;s assume this is the upper-right corner of the ball image.  We&rsquo;ll also need to factor in the size of the ball.  The image linked above is 64 pixels, so I&rsquo;ll assume that is the size of the ball we&rsquo;re using.  Feel free to change it to match your asset.</p>
<p>For 2, we can use <code>GraphicsDevice.Viewport</code> to get a rectangle defining the screen.</p>
<p>It can be very helpful to draw a diagram of this kind of setup <em>before</em> you try to derive the necessary calculations, i.e.:</p>
<p>
<a href="#image-25c340775d72b500801dc3288eda46d1" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/1.5.1.png" alt="A diagram of the game" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-25c340775d72b500801dc3288eda46d1">
<img src="https://ksu-cs-textbooks.github.io/cis580/images/1.5.1.png" alt="A diagram of the game" class="lightbox-image" loading="lazy">
</a></p>
<p>To check if the ball is moving off the left of the screen, we could use an <code>if</code> statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(_ballPosition.X &lt; GraphicsDevice.Viewport.X) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Bounce ball</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We could then reverse the direction of the ball by multiplying its velocity in the horizontal plane by $-1$:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    _ballVelocity.X *= -<span style="color:#ae81ff">1</span>;</span></span></code></pre></div><p>Moving off-screen to the right would be almost identical, so we could actually combine the two into a single if-statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Moving offscreen horizontally</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (_ballPosition.X &lt; GraphicsDevice.Viewport.X || _ballPosition.X &gt; GraphicsDevice.Viewport.Width - <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _ballVelocity.X *= -<span style="color:#ae81ff">1</span>;    
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Note that we need to shorten the width by 64 pixels to keep the ball on-screen.</p>
<p>The vertical bounce is almost identical:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Moving offscreen vertically</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (_ballPosition.Y &lt; GraphicsDevice.Viewport.Y || _ballPosition.Y &gt; GraphicsDevice.Viewport.Height - <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _ballVelocity.Y *= -<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Our bounce here is not quite accurate, as the ball may have moved some pixels off-screen <em>before</em> we reverse the direction.<br>
In the worst case, it will actually so far off screen that with floating point error, it might be off-screen next frame as well (which will result in it getting stuck).  But as long as our ball is traveling less than its dimensions each frame, we should be okay.</p>
</div>
</div>
<p>Now we just need to draw our bouncy ball.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/clipboard.min.js?1691771333" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/perfect-scrollbar.min.js?1691771333" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/theme.js?1691771333" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/tele-scroll.js?1691771333 defer"></script>
    
  </body>
</html>
