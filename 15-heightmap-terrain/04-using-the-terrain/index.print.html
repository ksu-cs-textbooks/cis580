




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Let’s see our terrain in action. First we’ll need to make some changes in our ExampleGame class. We’ll add a Terrain field:
// The terrain Terrain terrain;In our ExampleGame.LoadContent(), we’ll load the heightmap and construct our terrain:
// Build the terrain Texture2D heightmap = Content.Load&lt;Texture2D&gt;(&#34;heightmap&#34;); terrain = new Terrain(this, heightmap, 10f, Matrix.Identity);And in our ExampleGame.Draw() we’ll render it with the existing camera:
// Draw the terrain terrain.Draw(camera);Now if you run the game, you should see your terrain, and even be able to move around it using the camera controls (WASD &#43; Mouse).">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Using the Terrain :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Let’s see our terrain in action. First we’ll need to make some changes in our ExampleGame class. We’ll add a Terrain field:
// The terrain Terrain terrain;In our ExampleGame.LoadContent(), we’ll load the heightmap and construct our terrain:
// Build the terrain Texture2D heightmap = Content.Load&lt;Texture2D&gt;(&#34;heightmap&#34;); terrain = new Terrain(this, heightmap, 10f, Matrix.Identity);And in our ExampleGame.Draw() we’ll render it with the existing camera:
// Draw the terrain terrain.Draw(camera);Now if you run the game, you should see your terrain, and even be able to move around it using the camera controls (WASD &#43; Mouse).">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/15-heightmap-terrain/04-using-the-terrain/">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Using the Terrain :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Let’s see our terrain in action. First we’ll need to make some changes in our ExampleGame class. We’ll add a Terrain field:
// The terrain Terrain terrain;In our ExampleGame.LoadContent(), we’ll load the heightmap and construct our terrain:
// Build the terrain Texture2D heightmap = Content.Load&lt;Texture2D&gt;(&#34;heightmap&#34;); terrain = new Terrain(this, heightmap, 10f, Matrix.Identity);And in our ExampleGame.Draw() we’ll render it with the existing camera:
// Draw the terrain terrain.Draw(camera);Now if you run the game, you should see your terrain, and even be able to move around it using the camera controls (WASD &#43; Mouse).">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Heightmap Terrain">
    <meta property="article:published_time" content="2020-03-24T10:00:00-05:00">
    <meta property="article:modified_time" content="2023-11-03T12:55:41-05:00">
    <meta itemprop="name" content="Using the Terrain :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Let’s see our terrain in action. First we’ll need to make some changes in our ExampleGame class. We’ll add a Terrain field:
// The terrain Terrain terrain;In our ExampleGame.LoadContent(), we’ll load the heightmap and construct our terrain:
// Build the terrain Texture2D heightmap = Content.Load&lt;Texture2D&gt;(&#34;heightmap&#34;); terrain = new Terrain(this, heightmap, 10f, Matrix.Identity);And in our ExampleGame.Draw() we’ll render it with the existing camera:
// Draw the terrain terrain.Draw(camera);Now if you run the game, you should see your terrain, and even be able to move around it using the camera controls (WASD &#43; Mouse).">
    <meta itemprop="datePublished" content="2020-03-24T10:00:00-05:00">
    <meta itemprop="dateModified" content="2023-11-03T12:55:41-05:00">
    <meta itemprop="wordCount" content="893">
    <title>Using the Terrain :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/15-heightmap-terrain/04-using-the-terrain/" rel="canonical" type="text/html" title="Using the Terrain :: K-State CIS 580 Textbook">
    <link href="/cis580/15-heightmap-terrain/04-using-the-terrain/index.xml" rel="alternate" type="application/rss+xml" title="Using the Terrain :: K-State CIS 580 Textbook">
    <link href="/cis580/15-heightmap-terrain/04-using-the-terrain/tele.html" rel="alternate" type="text/html" title="Using the Terrain :: K-State CIS 580 Textbook">
    <link href="/cis580/15-heightmap-terrain/04-using-the-terrain/embed.html" rel="alternate" type="text/html" title="Using the Terrain :: K-State CIS 580 Textbook">
    <link href="/cis580/css/fontawesome-all.min.css?1723670680" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1723670680" rel="stylesheet"></noscript>
    <link href="/cis580/css/nucleus.css?1723670680" rel="stylesheet">
    <link href="/cis580/css/auto-complete.css?1723670680" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1723670680" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar.min.css?1723670680" rel="stylesheet">
    <link href="/cis580/css/fonts.css?1723670680" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1723670680" rel="stylesheet"></noscript>
    <link href="/cis580/css/theme.css?1723670680" rel="stylesheet">
    <link href="/cis580/css/theme-auto.css?1723670680" rel="stylesheet" id="R-variant-style">
    <link href="/cis580/css/chroma-auto.css?1723670680" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/cis580/css/variant.css?1723670680" rel="stylesheet">
    <link href="/cis580/css/print.css?1723670680" rel="stylesheet" media="print">
    <link href="/cis580/css/format-print.css?1723670680" rel="stylesheet">
    <script src="/cis580/js/variant.js?1723670680"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.index_js_url="/cis580/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    
    <link href="/cis580/css/custom.css?1723670680" rel="stylesheet">
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/cis580/15-heightmap-terrain/04-using-the-terrain/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/cis580/15-heightmap-terrain/"><span itemprop="name">Heightmap Terrain</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Using the Terrain</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/15-heightmap-terrain/03-terrain-class/" title="Terrain Class (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/15-heightmap-terrain/05-interpolating-heights/" title="Interpolating Heights (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="using-the-terrain">Using the Terrain</h1>

<p>Let&rsquo;s see our terrain in action.  First we&rsquo;ll need to make some changes in our <code>ExampleGame</code> class.  We&rsquo;ll add a <code>Terrain</code> field:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The terrain </span>
</span></span><span class="line"><span class="cl">    <span class="n">Terrain</span> <span class="n">terrain</span><span class="p">;</span></span></span></code></pre></div><p>In our <code>ExampleGame.LoadContent()</code>, we&rsquo;ll load the heightmap and construct our terrain:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Build the terrain</span>
</span></span><span class="line"><span class="cl">    <span class="n">Texture2D</span> <span class="n">heightmap</span> <span class="p">=</span> <span class="n">Content</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Texture2D</span><span class="p">&gt;(</span><span class="s">&#34;heightmap&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">terrain</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Terrain</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">heightmap</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">);</span></span></span></code></pre></div><p>And in our <code>ExampleGame.Draw()</code> we&rsquo;ll render it with the existing camera:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Draw the terrain</span>
</span></span><span class="line"><span class="cl">    <span class="n">terrain</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span></span></span></code></pre></div><p>Now if you run the game, you should see your terrain, and even be able to move around it using the camera controls (WASD + Mouse).</p>
<p><a href="#R-image-6ffa578aa27db8adc392c3d1d425e775" class="lightbox-link"><img alt="The rendered terrain" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/heightmap-terrain-4.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6ffa578aa27db8adc392c3d1d425e775"><img alt="The rendered terrain" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/heightmap-terrain-4.1.png"></a></p>
<p>You&rsquo;ll probably notice that your camera does not change position as you move over the terrain - in fact, in some parts of the map you can actually end up looking up from underneath!</p>
<p>Clearly we need to do a bit more work.  We need a way to tell the camera what its Y-value should be, based on what part of the terrain it is over.</p>
<h2 id="the-iheightmap-interface">The IHeightMap Interface</h2>
<p>Rather than linking our camera <em>directly</em> to our terrain implementation, let&rsquo;s define an interface that could be used for any surface the player might be walking on.  For lack of a better name, I&rsquo;m calling this interface <code>IHeightMap</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// An interface providing methods for determining the </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// height at a point in a height map</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">interface</span> <span class="nc">IHeightMap</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// Gets the height of the map at the specified position</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;param name=&#34;x&#34;&gt;The x coordinate in the world&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;param name=&#34;z&#34;&gt;The z coordinate in the world&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;returns&gt;The height at the specified position&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">GetHeightAt</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>The interface defines a single method, <code>GetHeightAt()</code>.  Note that we take the X and Z coordinate - these are <em>world coordinates</em> in the game.  The return value is the Y world coordinate corresponding to the elevation of the terrain at <code>x</code> and <code>z</code>.</p>
<h2 id="refactoring-fpscamera">Refactoring FPSCamera</h2>
<p>We can then use this interface within our <code>FPSCamera</code> class to change its height based on its X and Z.  We&rsquo;ll start by adding a property of type <code>ICamera</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Gets or sets the heightmap this camera is interacting with</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">IHeightMap</span> <span class="n">HeightMap</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span></span></span></code></pre></div><p>We also might want to add a property to say how far above any heightmap we want the camera to be.  Let&rsquo;s call this <code>HeightOffset</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Gets or sets how high above the heightmap the camera should be</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">HeightOffset</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span></span></span></code></pre></div><p>And we&rsquo;ll modify our <code>FPSCamera.Update()</code> to use the <code>HeightMap</code> and <code>HeightOffset</code> to determine the camera&rsquo;s Y position:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Adjust camera height to heightmap </span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">HeightMap</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">position</span><span class="p">.</span><span class="n">Y</span> <span class="p">=</span> <span class="n">HeightMap</span><span class="p">.</span><span class="n">GetHeightAt</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">Z</span><span class="p">)</span> <span class="p">+</span> <span class="n">HeightOffset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>This should be done <em>before</em> we set the updated <code>View</code> matrix.</p>
<p>Notice that we wrap this in a <code>null</code> check.  If there is no heightmap, we want to keep our default behavior.</p>
<h2 id="refactoring-examplegame">Refactoring ExampleGame</h2>
<p>Since the <code>HeightMap</code> is a property of the <code>FPSCamera</code>, we&rsquo;ll need to set it to our terrain in the <code>ExampleGame.LoadContent()</code> method after both the camera and terrain have been created:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">camera</span><span class="p">.</span><span class="n">HeightMap</span> <span class="p">=</span> <span class="n">Terrain</span><span class="p">;</span></span></span></code></pre></div><h2 id="refactoring-terrain">Refactoring Terrain</h2>
<p>Now we need to implement the <code>IHeightMap</code> interface in our <code>Terrain</code> class.  Add it to the class definition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Terrain</span> <span class="p">:</span> <span class="n">IHeightMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>And add the method it calls for:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Gets the height of the terrain at</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// the supplied world coordinates</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;x&#34;&gt;The x world coordinate&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;z&#34;&gt;The z world coordinate&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">GetHeightAt</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{}</span></span></span></code></pre></div><p>Now, let&rsquo;s talk through the process of finding the height.  As our comments suggest, we&rsquo;re using <em>world</em> coordinates, not <em>model</em> coordinates.  As long as the world matrix remains the identity matrix, these are the same.  But as soon as that changes, the world coordinates no longer line up.  So the first thing we need to do is transform them from world coordinates to model coordinates.</p>
<p>Since multiplying a vector in model coordinates by the world matrix transforms them into world coordinates, the inverse should be true.  Specifically, multiplying world coordinates by the <em>inverse of the world matrix</em> should transform them into model coordinates.</p>
<p>The <a href="https://www.monogame.net/documentation/?page=M_Microsoft_Xna_Framework_Matrix_Invert_1" rel="external" target="_blank">Matrix.Invert()</a> method can create this inverse matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">Matrix</span> <span class="n">inverseWorld</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Invert</span><span class="p">(</span><span class="n">effect</span><span class="p">.</span><span class="n">World</span><span class="p">);</span></span></span></code></pre></div><p>We&rsquo;ll also need the world coordinates as a <code>Vector3</code> to transform:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">worldCoordinates</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span></span></span></code></pre></div><p>Here we don&rsquo;t care about the y value, so we&rsquo;ll set it to 0.</p>
<p>Then we can apply the transformation with <a href="https://www.monogame.net/documentation/?page=M_Microsoft_Xna_Framework_Vector3_Transform_7" rel="external" target="_blank">Vector3.Transform()</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">modelCoordinates</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">worldCoordinates</span><span class="p">,</span> <span class="n">inverseWorld</span><span class="p">);</span></span></span></code></pre></div><p>At this point, <code>modelCoordinates.X</code> and <code>modelCoordinates.Z</code> correspond to the x and -y indices of our <code>heights</code> array, respectively.  The y coordinate needs to be inverted, because our terrain was defined along the negative z-axis (as the positive z-axis is towards the screen).  Let&rsquo;s save them in float variables so we don&rsquo;t have to remember to invert the z as our y coordinate:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">tx</span> <span class="p">=</span> <span class="n">modelCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">ty</span> <span class="p">=</span> <span class="p">-</span><span class="n">modelCoordinates</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span></span></span></code></pre></div><p>These <em>should</em> correspond to the x and y indices in the <code>heights</code> array, but it is also possible that they are out-of-bounds.  It&rsquo;s a good idea to check:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">ty</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">tx</span> <span class="p">&gt;=</span> <span class="n">width</span> <span class="p">||</span> <span class="n">ty</span> <span class="p">&gt;=</span> <span class="n">height</span><span class="p">)</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span></span></span></code></pre></div><p>If we&rsquo;re out-of-bounds, we&rsquo;ll just return a height of 0.  Otherwise, we&rsquo;ll return the value in our <code>heights</code> array:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">heights</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">tx</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ty</span><span class="p">];</span></span></span></code></pre></div><p>Now try running the game and exploring your terrain.  The camera should now move vertically according to the elevation!</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

        </div>
      </main>
    
<div class="git-footer">
  <p class="theme-version-footer">6.0.0</p>
  <p>Last modified by: 
              <i class='fas fa-user'></i> Nathan Bean
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/2f4b8e95434e2e87a8fc23966880512273005d60">Nov 3, 2023</a>
  </p>
  </div>
  
    
    </div>
    <script src="/cis580/js/clipboard.min.js?1723670680" defer></script>
    <script src="/cis580/js/perfect-scrollbar.min.js?1723670680" defer></script>
    <script src="/cis580/js/theme.js?1723670680" defer></script>
  </body>
</html>
