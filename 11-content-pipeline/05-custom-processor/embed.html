<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta name="author" content="Nathan H. Bean">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta name="twitter:title" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/05-custom-processor/index.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta property="og:description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Content Pipeline">
    <meta property="article:published_time" content="2020-03-20T10:53:05-05:00">
    <meta property="article:modified_time" content="2023-10-11T12:42:22-05:00">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta itemprop="name" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-11T12:42:22-05:00">
    <meta itemprop="wordCount" content="569">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <title>Custom Processor :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/05-custom-processor/index.html" rel="canonical" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/index.xml" rel="alternate" type="application/rss+xml" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/index.print.html" rel="alternate" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/tele.html" rel="alternate" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/css/auto-complete/auto-complete.min.css?1756153111" rel="stylesheet">
    <script src="/cis580/js/auto-complete/auto-complete.min.js?1756153111" defer></script>
    <script src="/cis580/js/search-lunr.min.js?1756153111" defer></script>
    <script src="/cis580/js/search.min.js?1756153111" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cis580/searchindex.en.js?1756153111";
    </script>
    <script src="/cis580/js/lunr/lunr.min.js?1756153111" defer></script>
    <script src="/cis580/js/lunr/lunr.stemmer.support.min.js?1756153111" defer></script>
    <script src="/cis580/js/lunr/lunr.multi.min.js?1756153111" defer></script>
    <script src="/cis580/js/lunr/lunr.en.min.js?1756153111" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1756153111" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1756153111" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar/perfect-scrollbar.min.css?1756153111" rel="stylesheet">
    <link href="/cis580/css/theme.min.css?1756153111" rel="stylesheet">
    <link href="/cis580/css/format-html.min.css?1756153111" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/11-content-pipeline\/05-custom-processor\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cis580/css/custom.css?1756153111" rel="stylesheet">
  </head>
  <body class="mobile-support embed html" data-url="/cis580/11-content-pipeline/05-custom-processor/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 11-content-pipeline" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="custom-processor">Custom Processor</h1>

<p>A processor is a class that extends the <code>ContentProcessor&lt;TInput, TOutput&gt;</code>class and overrides its <code>Process()</code> method. Like the importer, this is a template class, but with <em>two</em> templates!  The <code>TInput</code> identifies the class coming into the <code>Process()</code> method as an argument, and the <code>TOutput</code> identifies the class being returned from the method. Not that these don&rsquo;t have to be different classes - in our case, we&rsquo;ll continue using the <code>TilemapContent</code> class we defined earlier, and just populate a few more of its properties:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> SimpleTilemapPipeline
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// and setting up the tile information.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapProcessor</span> : ContentProcessor&lt;BasicTilemapContent, BasicTilemapContent&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> BasicTilemapContent Process(BasicTilemapContent map, ContentProcessorContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// they get loaded together by the ContentProcessor.  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span style="display:flex;"><span>            map.TilesetTexture = context.BuildAndLoadAsset&lt;TextureContent, Texture2DContent&gt;(<span style="color:#66d9ef">new</span> ExternalReference&lt;TextureContent&gt;(map.TilesetImageFilename), <span style="color:#e6db74">&#34;TextureProcessor&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Determine the number of rows and columns of tiles in the tileset texture            </span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetColumns = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Width / map.TileWidth;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetRows = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Height / map.TileWidth;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// These will be stored in the tiles array</span>
</span></span><span style="display:flex;"><span>            map.Tiles = <span style="color:#66d9ef">new</span> Rectangle[tilesetColumns * tilesetRows];
</span></span><span style="display:flex;"><span>            context.Logger.LogMessage(<span style="color:#e6db74">$&#34;{map.Tiles.Length} Total tiles&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; tilesetRows; y++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; tilesetColumns; x++)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    map.Tiles[y * tilesetColumns + x] = <span style="color:#66d9ef">new</span> Rectangle(
</span></span><span style="display:flex;"><span>                        x * map.TileWidth,
</span></span><span style="display:flex;"><span>                        y * map.TileHeight,
</span></span><span style="display:flex;"><span>                        map.TileWidth,
</span></span><span style="display:flex;"><span>                        map.TileHeight
</span></span><span style="display:flex;"><span>                        );
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Return the fully processed tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Something very interesting happens here.  The processor builds and loads the tilemap texture into the <code>Texture2DContent</code> member. This means that when we use <code>Content.Load&lt;T&gt;()</code> to load the <strong>.xnb</strong> file, it will <em>already contain the texture</em>. We don&rsquo;t need any additional steps in our game to load dependent assets. This makes complex, multi-file assets much easier to work with!</p>
<p>This is one of the most important abilities of the <code>ContentProcessorContext</code> object supplied to each processor - it allows them to build additional assets (External References in XNA lingo) without requiring those assets to be explicitly added to the content project.  We can also supply content processor parameters, or even specify a different importer and processor to use for that dependant asset to the build method.</p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    Info
  </summary>
  <div class="box-content">
<p>In this example, we used a <code>Texture2DContent</code> variable and the <code>context.BuildAndLoadAsset&lt;Texture2DContent&gt;()</code> method to build and load the asset. This approach embeds the dependent asset into the resulting map object. But what if we wanted to use the same texture in multiple maps? In that case, we could change our member to be a <code>ExternalReference&lt;Texture2DContent&gt;</code> and use the <code>context.BuildAsset&lt;Texture2D&gt;()</code> method to build it.  The benefit of this approach is that the texture is not embedded in the map&rsquo;s xnb file, but rather gets its own file. That way the <code>ContentProcessor</code> only needs load its data once - it&rsquo;s basically the flyweight pattern for external resources!</p>
  </div>
</details>
<p>The other task our processor does is determine the source bounds for each of our four tiles - this code is directly taken from the earlier tilemap example&rsquo;s <code>Load()</code> method.</p>
<p>As with our importer and content class we are also using an attribute - in this case <code>[ContentProcessor]</code>. It simply defines a name for the MonoGame Content Builder to display for the processor.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
      
      
      
    </div>
    <script src="/cis580/js/clipboard/clipboard.min.js?1756153111" defer></script>
    <script src="/cis580/js/perfect-scrollbar/perfect-scrollbar.min.js?1756153111" defer></script>
    <script src="/cis580/js/theme.min.js?1756153111" defer></script>
  <script src="/cis580/js/embed-iframe.min.js?1756153111" defer></script>
  </body>
</html>
