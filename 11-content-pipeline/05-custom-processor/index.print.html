




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/05-custom-processor/">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta property="og:description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Content Pipeline">
    <meta property="article:published_time" content="2020-03-20T10:53:05-05:00">
    <meta property="article:modified_time" content="2023-10-11T12:42:22-05:00">
    <meta itemprop="name" content="Custom Processor :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="A processor is a class that extends the ContentProcessor&lt;TInput, TOutput&gt;class and overrides its Process() method. Like the importer, this is a template class, but with two templates! The TInput identifies the class coming into the Process() method as an argument, and the TOutput identifies the class being returned from the method. Not that these don’t have to be different classes - in our case, we’ll continue using the TilemapContent class we defined earlier, and just populate a few more of its properties:">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-11T12:42:22-05:00">
    <meta itemprop="wordCount" content="568">
    <title>Custom Processor :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/05-custom-processor/" rel="canonical" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/index.xml" rel="alternate" type="application/rss+xml" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/tele.html" rel="alternate" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/05-custom-processor/embed.html" rel="alternate" type="text/html" title="Custom Processor :: K-State CIS 580 Textbook">
    <link href="/cis580/css/fontawesome-all.min.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/nucleus.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/auto-complete.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar.min.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/fonts.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/theme.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/theme-auto.css?1723670679" rel="stylesheet" id="R-variant-style">
    <link href="/cis580/css/chroma-auto.css?1723670679" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/cis580/css/variant.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/print.css?1723670679" rel="stylesheet" media="print">
    <link href="/cis580/css/format-print.css?1723670679" rel="stylesheet">
    <script src="/cis580/js/variant.js?1723670679"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.index_js_url="/cis580/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    
    <link href="/cis580/css/custom.css?1723670679" rel="stylesheet">
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/cis580/11-content-pipeline/05-custom-processor/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/cis580/11-content-pipeline/"><span itemprop="name">Content Pipeline</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Custom Processor</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/04-custom-importer/" title="Custom Importer (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/06-using-in-a-game/" title="Using in a Game (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="custom-processor">Custom Processor</h1>

<p>A processor is a class that extends the <code>ContentProcessor&lt;TInput, TOutput&gt;</code>class and overrides its <code>Process()</code> method. Like the importer, this is a template class, but with <em>two</em> templates!  The <code>TInput</code> identifies the class coming into the <code>Process()</code> method as an argument, and the <code>TOutput</code> identifies the class being returned from the method. Not that these don&rsquo;t have to be different classes - in our case, we&rsquo;ll continue using the <code>TilemapContent</code> class we defined earlier, and just populate a few more of its properties:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">SimpleTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// and setting up the tile information.</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapProcessor</span> <span class="p">:</span> <span class="n">ContentProcessor</span><span class="p">&lt;</span><span class="n">BasicTilemapContent</span><span class="p">,</span> <span class="n">BasicTilemapContent</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">override</span> <span class="n">BasicTilemapContent</span> <span class="n">Process</span><span class="p">(</span><span class="n">BasicTilemapContent</span> <span class="n">map</span><span class="p">,</span> <span class="n">ContentProcessorContext</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span class="line"><span class="cl">            <span class="c1">// they get loaded together by the ContentProcessor.  </span>
</span></span><span class="line"><span class="cl">            <span class="c1">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">BuildAndLoadAsset</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">,</span> <span class="n">Texture2DContent</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ExternalReference</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">&gt;(</span><span class="n">map</span><span class="p">.</span><span class="n">TilesetImageFilename</span><span class="p">),</span> <span class="s">&#34;TextureProcessor&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Determine the number of rows and columns of tiles in the tileset texture            </span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetColumns</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Width</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetRows</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Height</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// These will be stored in the tiles array</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">tilesetColumns</span> <span class="p">*</span> <span class="n">tilesetRows</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="n">LogMessage</span><span class="p">(</span><span class="s">$&#34;{map.Tiles.Length} Total tiles&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">tilesetRows</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">tilesetColumns</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">tilesetColumns</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">x</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">y</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span>
</span></span><span class="line"><span class="cl">                        <span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// Return the fully processed tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Something very interesting happens here.  The processor builds and loads the tilemap texture into the <code>Texture2DContent</code> member. This means that when we use <code>Content.Load&lt;T&gt;()</code> to load the <strong>.xnb</strong> file, it will <em>already contain the texture</em>. We don&rsquo;t need any additional steps in our game to load dependent assets. This makes complex, multi-file assets much easier to work with!</p>
<p>This is one of the most important abilities of the <code>ContentProcessorContext</code> object supplied to each processor - it allows them to build additional assets (External References in XNA lingo) without requiring those assets to be explicitly added to the content project.  We can also supply content processor parameters, or even specify a different importer and processor to use for that dependant asset to the build method.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>In this example, we used a <code>Texture2DContent</code> variable and the <code>context.BuildAndLoadAsset&lt;Texture2DContent&gt;()</code> method to build and load the asset. This approach embeds the dependent asset into the resulting map object. But what if we wanted to use the same texture in multiple maps? In that case, we could change our member to be a <code>ExternalReference&lt;Texture2DContent&gt;</code> and use the <code>context.BuildAsset&lt;Texture2D&gt;()</code> method to build it.  The benefit of this approach is that the texture is not embedded in the map&rsquo;s xnb file, but rather gets its own file. That way the <code>ContentProcessor</code> only needs load its data once - it&rsquo;s basically the flyweight pattern for external resources!</p>
</div>
</div>
<p>The other task our processor does is determine the source bounds for each of our four tiles - this code is directly taken from the earlier tilemap example&rsquo;s <code>Load()</code> method.</p>
<p>As with our importer and content class we are also using an attribute - in this case <code>[ContentProcessor]</code>. It simply defines a name for the MonoGame Content Builder to display for the processor.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

        </div>
      </main>
    
<div class="git-footer">
  <p class="theme-version-footer">6.0.0</p>
  <p>Last modified by: 
              <i class='fas fa-user'></i> Nathan Bean
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/129086e8732aa5ce435875f99975e5563370cef2">Oct 11, 2023</a>
  </p>
  </div>
  
    
    </div>
    <script src="/cis580/js/clipboard.min.js?1723670679" defer></script>
    <script src="/cis580/js/perfect-scrollbar.min.js?1723670679" defer></script>
    <script src="/cis580/js/theme.js?1723670679" defer></script>
  </body>
</html>
