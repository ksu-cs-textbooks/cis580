




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/04-custom-importer/embed.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta property="og:description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Content Pipeline">
    <meta property="article:published_time" content="2020-03-20T10:53:05-05:00">
    <meta property="article:modified_time" content="2023-10-10T18:39:10-05:00">
    <meta itemprop="name" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-10T18:39:10-05:00">
    <meta itemprop="wordCount" content="663">
    <title>Custom Importer :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/04-custom-importer/" rel="canonical" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/index.xml" rel="alternate" type="application/rss+xml" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/index.print.html" rel="alternate" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/tele.html" rel="alternate" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    
  <link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/nucleus.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/perfect-scrollbar.min.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/fonts.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/theme.css?1737133119" rel="stylesheet">
  
  
  
  <link href="/cis580/css/theme-light-theme.css?1737133119" rel="stylesheet" id="R-variant-style">
  <link href="/cis580/css/chroma-relearn-light.css?1737133119" rel="stylesheet" id="R-variant-chroma-style">
  <link href="/cis580/css/variant.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/print.css?1737133119" rel="stylesheet" media="print">
  
  
  
  <script>
    window.relearn = window.relearn || {};
    window.relearn.relBasePath='..\/..';
    window.relearn.relBaseUri='..\/..\/..';
    window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
    window.index_js_url="/cis580/index.search.js";
    // variant stuff
    window.variants && variants.init( [ 'light-theme' ] );
    // translations
    window.T_Copy_to_clipboard = `Copy to clipboard`;
    window.T_Copied_to_clipboard = `Copied to clipboard!`;
    window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
    window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
    window.T_Reset_view = `Reset view`;
    window.T_View_reset = `View reset!`;
    window.T_No_results_found = `No results found for "{0}"`;
    window.T_N_results_found = `{1} results found for "{0}"`;
  </script>
  
  <link href="/cis580/css/custom.css?1737133119" rel="stylesheet">
    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="/cis580/11-content-pipeline/04-custom-importer/embed.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    

<p>An importer is a class that extends the <code>ContentImporter&lt;T&gt;</code> class and overrides its <code>Import()</code> method.  Notice the class is a <em>template</em> class (the <code>&lt;T&gt;</code> in the definition).  When we define our own class, we need to replace that <code>T</code> with the specific class we want the importer to populate.  In our case, this is the <code>BasicTilemapContent</code> we defined in the previous page.</p>
<p>All importers need to override the <code>Import()</code> method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.  The purpose of an importer is to read the important parts of the asset file and load them into an object that gets passed down the pipeline, to the content processor.</p>
<p>For our example, let&rsquo;s revisit our tilemap file, now named <em>example.tmap</em>:</p>
<div class="highlight"><pre tabindex="0"><code>tileset.png
64,64
10,10
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 3, 3, 2, 4, 4, 1, 4, 2, 2, 2, 3, 3, 2, 2, 2, 2, 4, 4, 4, 2, 3, 3, 2, 2, 2, 2, 2, 2, 1, 2, 3, 3, 3, 1, 3, 2, 2, 2, 4, 4, 3, 3, 2, 2, 3, 2, 3, 2, 2, 4, 4, 3, 2, 2, 3, 2, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3</code></pre></div><p>To quickly review, the first line is the name of our tileset image file, the second is the dimensions of a single tile (in the form <strong>width,height</strong>), the third is the size of our map in tiles (again, <strong>width,height</strong>), and the fourth is the indices of the individual tiles (with a <strong>0</strong> representing no tile).</p>
<p>Now we want to load that file&rsquo;s information into a <code>TilemapContent</code> object in our importer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Xna.Framework.Content.Pipeline</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Xna.Framework.Content.Pipeline.Graphics</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">BasicTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// An importer for a basic tilemap file. The purpose of an importer to to load all important data </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// from a file into a content object; any processing of that data occurs in the subsequent content</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// processor step. </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [ContentImporter(&#34;.tmap&#34;, DisplayName = &#34;BasicTilemapImporter&#34;, DefaultProcessor = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapImporter</span> <span class="p">:</span> <span class="n">ContentImporter</span><span class="p">&lt;</span><span class="n">BasicTilemapContent</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">override</span> <span class="n">BasicTilemapContent</span> <span class="n">Import</span><span class="p">(</span><span class="kt">string</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ContentImporterContext</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Create a new BasicTilemapContent</span>
</span></span><span class="line"><span class="cl">            <span class="n">BasicTilemapContent</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Read in the map file and split along newlines </span>
</span></span><span class="line"><span class="cl">            <span class="kt">string</span> <span class="n">data</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">ReadAllText</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">lines</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// First line in the map file is the image file name,</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// we store it so it can be loaded in the processor</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TilesetImageFilename</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Trim</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Second line is the tileset image size</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">secondLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Third line is the map size (in tiles)</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">thirdLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">MapWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">MapHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Fourth line is the map data (the indices of tiles in the map)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We can use the Linq Select() method to convert the array of strings</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// into an array of ints</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileIndices</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">).</span><span class="n">Select</span><span class="p">(</span><span class="n">index</span> <span class="p">=&gt;</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">index</span><span class="p">)).</span><span class="n">ToArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// At this point, we&#39;ve copied all of the file data into our</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// BasicTilemapContent object, so we pass it on to the processor</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We decorate the class with the <code>[ContentImporter]</code> attribute, which specifies a file extension this importer applies to (which is why we used the <strong>.tmap</strong> extension instead of the <strong>.txt</strong> we did previously), a name used by the MonoGame Content Editor to identify the importer, and also the suggested Content Processor to use next in the pipeline.</p>
<p>The bulk of the <code>Import()</code> method is just the parts of the <code>Load()</code> method from our original tilemap project that populated variables based on the contents of the file.  The loading of the texture and the determination of tile bounds we save for the content processor (though we save the image filename so we will have it then). The populated <code>BasicTilemapContent</code> object will be passed to it next.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>
</div>
</main>
</div>



<script src="/cis580/js/clipboard.min.js?1737133119" defer></script>
<script src="/cis580/js/perfect-scrollbar.min.js?1737133119" defer></script>
<script src="/cis580/js/theme.js?1737133119" defer></script>

<script src="/cis580/js/embed-iframe.js?1737133119" defer></script>
</body>
</html>
