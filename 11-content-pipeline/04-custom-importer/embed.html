<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta name="author" content="Nathan H. Bean">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta name="twitter:title" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/04-custom-importer/index.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta property="og:description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Content Pipeline">
    <meta property="article:published_time" content="2020-03-20T10:53:05-05:00">
    <meta property="article:modified_time" content="2023-10-10T18:39:10-05:00">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta itemprop="name" content="Custom Importer :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="An importer is a class that extends the ContentImporter&lt;T&gt; class and overrides its Import() method. Notice the class is a template class (the &lt;T&gt; in the definition). When we define our own class, we need to replace that T with the specific class we want the importer to populate. In our case, this is the BasicTilemapContent we defined in the previous page.
All importers need to override the Import() method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-10T18:39:10-05:00">
    <meta itemprop="wordCount" content="665">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <title>Custom Importer :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/04-custom-importer/index.html" rel="canonical" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/index.xml" rel="alternate" type="application/rss+xml" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/index.print.html" rel="alternate" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/04-custom-importer/tele.html" rel="alternate" type="text/html" title="Custom Importer :: K-State CIS 580 Textbook">
    <link href="/cis580/css/auto-complete/auto-complete.min.css?1755628803" rel="stylesheet">
    <script src="/cis580/js/auto-complete/auto-complete.min.js?1755628803" defer></script>
    <script src="/cis580/js/search-lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/search.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cis580/searchindex.en.js?1755628803";
    </script>
    <script src="/cis580/js/lunr/lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.stemmer.support.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.multi.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.en.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar/perfect-scrollbar.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/theme.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/format-html.min.css?1755628803" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/11-content-pipeline\/04-custom-importer\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cis580/css/custom.css?1755628803" rel="stylesheet">
  </head>
  <body class="mobile-support embed html" data-url="/cis580/11-content-pipeline/04-custom-importer/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 11-content-pipeline" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="custom-importer">Custom Importer</h1>

<p>An importer is a class that extends the <code>ContentImporter&lt;T&gt;</code> class and overrides its <code>Import()</code> method.  Notice the class is a <em>template</em> class (the <code>&lt;T&gt;</code> in the definition).  When we define our own class, we need to replace that <code>T</code> with the specific class we want the importer to populate.  In our case, this is the <code>BasicTilemapContent</code> we defined in the previous page.</p>
<p>All importers need to override the <code>Import()</code> method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.  The purpose of an importer is to read the important parts of the asset file and load them into an object that gets passed down the pipeline, to the content processor.</p>
<p>For our example, let&rsquo;s revisit our tilemap file, now named <em>example.tmap</em>:</p>
<div class="highlight" dir="auto"><pre tabindex="0"><code>tileset.png
64,64
10,10
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 3, 3, 2, 4, 4, 1, 4, 2, 2, 2, 3, 3, 2, 2, 2, 2, 4, 4, 4, 2, 3, 3, 2, 2, 2, 2, 2, 2, 1, 2, 3, 3, 3, 1, 3, 2, 2, 2, 4, 4, 3, 3, 2, 2, 3, 2, 3, 2, 2, 4, 4, 3, 2, 2, 3, 2, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3</code></pre></div>
<p>To quickly review, the first line is the name of our tileset image file, the second is the dimensions of a single tile (in the form <strong>width,height</strong>), the third is the size of our map in tiles (again, <strong>width,height</strong>), and the fourth is the indices of the individual tiles (with a <strong>0</strong> representing no tile).</p>
<p>Now we want to load that file&rsquo;s information into a <code>TilemapContent</code> object in our importer:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.IO;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Xna.Framework.Content.Pipeline;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Xna.Framework.Content.Pipeline.Graphics;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> BasicTilemapPipeline
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// An importer for a basic tilemap file. The purpose of an importer to to load all important data </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// from a file into a content object; any processing of that data occurs in the subsequent content</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// processor step. </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentImporter(&#34;.tmap&#34;, DisplayName = &#34;BasicTilemapImporter&#34;, DefaultProcessor = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapImporter</span> : ContentImporter&lt;BasicTilemapContent&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> BasicTilemapContent Import(<span style="color:#66d9ef">string</span> filename, ContentImporterContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Create a new BasicTilemapContent</span>
</span></span><span style="display:flex;"><span>            BasicTilemapContent map = <span style="color:#66d9ef">new</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Read in the map file and split along newlines </span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span> data = File.ReadAllText(filename);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> lines = data.Split(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// First line in the map file is the image file name,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// we store it so it can be loaded in the processor</span>
</span></span><span style="display:flex;"><span>            map.TilesetImageFilename = lines[<span style="color:#ae81ff">0</span>].Trim();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Second line is the tileset image size</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> secondLine = lines[<span style="color:#ae81ff">1</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>            map.TileWidth = <span style="color:#66d9ef">int</span>.Parse(secondLine[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>            map.TileHeight = <span style="color:#66d9ef">int</span>.Parse(secondLine[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Third line is the map size (in tiles)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> thirdLine = lines[<span style="color:#ae81ff">2</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>            map.MapWidth = <span style="color:#66d9ef">int</span>.Parse(thirdLine[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>            map.MapHeight = <span style="color:#66d9ef">int</span>.Parse(thirdLine[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Fourth line is the map data (the indices of tiles in the map)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We can use the Linq Select() method to convert the array of strings</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// into an array of ints</span>
</span></span><span style="display:flex;"><span>            map.TileIndices = lines[<span style="color:#ae81ff">3</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>).Select(index =&gt; <span style="color:#66d9ef">int</span>.Parse(index)).ToArray();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// At this point, we&#39;ve copied all of the file data into our</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// BasicTilemapContent object, so we pass it on to the processor</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>We decorate the class with the <code>[ContentImporter]</code> attribute, which specifies a file extension this importer applies to (which is why we used the <strong>.tmap</strong> extension instead of the <strong>.txt</strong> we did previously), a name used by the MonoGame Content Editor to identify the importer, and also the suggested Content Processor to use next in the pipeline.</p>
<p>The bulk of the <code>Import()</code> method is just the parts of the <code>Load()</code> method from our original tilemap project that populated variables based on the contents of the file.  The loading of the texture and the determination of tile bounds we save for the content processor (though we save the image filename so we will have it then). The populated <code>BasicTilemapContent</code> object will be passed to it next.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
      
      
      
    </div>
    <script src="/cis580/js/clipboard/clipboard.min.js?1755628803" defer></script>
    <script src="/cis580/js/perfect-scrollbar/perfect-scrollbar.min.js?1755628803" defer></script>
    <script src="/cis580/js/theme.min.js?1755628803" defer></script>
  <script src="/cis580/js/embed-iframe.min.js?1755628803" defer></script>
  </body>
</html>
