




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Get Your Assets into the Game!
via GIPHY">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Get Your Assets into the Game!
via GIPHY">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Get Your Assets into the Game!
via GIPHY">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Get Your Assets into the Game!
via GIPHY">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-10T18:39:10-05:00">
    <meta itemprop="wordCount" content="8">
    <title>Content Pipeline :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/" rel="canonical" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/index.xml" rel="alternate" type="application/rss+xml" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/tele.html" rel="alternate" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/embed.html" rel="alternate" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/css/fontawesome-all.min.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/nucleus.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/auto-complete.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar.min.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/fonts.css?1723670679" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1723670679" rel="stylesheet"></noscript>
    <link href="/cis580/css/theme.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/theme-auto.css?1723670679" rel="stylesheet" id="R-variant-style">
    <link href="/cis580/css/chroma-auto.css?1723670679" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/cis580/css/variant.css?1723670679" rel="stylesheet">
    <link href="/cis580/css/print.css?1723670679" rel="stylesheet" media="print">
    <link href="/cis580/css/format-print.css?1723670679" rel="stylesheet">
    <script src="/cis580/js/variant.js?1723670679"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.index_js_url="/cis580/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    
    <link href="/cis580/css/custom.css?1723670679" rel="stylesheet">
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/cis580/11-content-pipeline/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Content Pipeline</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/10-tile-maps/06-summary/" title="Summary (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/01-introduction/" title="Introduction (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="content-pipeline">Content Pipeline</h1>

<p>Get Your Assets into the Game!</p>
<iframe src="https://giphy.com/embed/k5b6fkFnSA3yo" width="479" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/sonymusicperu-mariobross-k5b6fkFnSA3yo">via GIPHY</a></p>
            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Content Pipeline</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="introduction">Introduction</h1>

<p>The creation of assets (textures, audio, models, etc) is a major aspect of game development. In fact, asset creators account for most of a game development team (often a 90/10 split between asset creators and programmers). So creating and using assets is a very important part of creating games!</p>
<p>To make this process manageable, most assets are created with other software tools - editors specific to the kind of asset we are dealing with. Asset creators become quite proficient with these tools, and provide their assets in a save file form specific to one of these tools.</p>
<p>We can load these files directly in our game, especially if our game targets Windows, where we have a lot of available supporting libraries. But those file formats are tailored towards the needs of the editor program - they often contain data we don&rsquo;t need, or format it in a way that must be transformed to use in our games. And the processing involved in loading can be a lot more involved than we like, causing long load times.</p>
<p>One way around this is the use of a <em>Content Pipeline</em> which transforms assets from an editor-specific file format to one optimized for our games. This happens during the <em>build</em> process, so the transformed asset files are bundled with our executable, ready to be utilized.</p>
<p>This chapter will describe the content pipeline approach specific to XNA.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="the-content-pipeline">The Content Pipeline</h1>

<p>As we described in the introduction, the XNA Content Pipeline&rsquo;s purpose is to transform asset files (content) in to a form most readily useable by our games. It is implemented as a separate build step that is run every time we compile our game. In fact, each XNA game is actually <em>two</em> projects - the <em>Content</em> project, and the <em>Game</em> project.</p>
<p>The pipeline is broken up into several steps:</p>
<ol>
<li>Importing the asset data</li>
<li>Processing the asset data</li>
<li>Serializing the asset data</li>
<li>Loading the serialized asset data</li>
</ol>
<p>You can see the process here:</p>
<p><a href="#R-image-e054362c73597b79094f93f9667f6b2a" class="lightbox-link"><img alt="XNA Content Pipeline" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/11.2.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e054362c73597b79094f93f9667f6b2a"><img alt="XNA Content Pipeline" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/11.2.1.png"></a></p>
<p>Each of these steps is accomplished by a different class, and the data passed between the steps is also typically done as an object (defined by a class).</p>
<p>The two projects share a single file - the <strong>.xnb</strong> file generated from the content. This is essentially an object that has been serialized as binary data by the content serializer class, and will be deserialized back into an object by the content loader class.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>An important aspect of the serialization process is that the object that is serialized into a <strong>.xnb</strong> file and the one deserialized from it <em>don&rsquo;t have to be the defined by the same class</em>! For example, in the content pipeline simple 2d textures are represented by a <code>Texture2DContent</code> instance, while in runtime projects we load the serialized data into a <code>Texture2D</code> instance. The key is that the serialized data is the same for both.</p>
</div>
</div>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="extending-the-pipeline">Extending the Pipeline</h1>

<p>You might be wondering why the content pipeline in XNA was created this way - with importers, processors, content writers, and content readers.  The answer is simple - modularity.  If you want to load a new image format that the <code>TextureImporter</code> does not handle, you can write your own custom importer to load its data into a <code>TextureContent</code> object, and then still use the existing <code>TextureProcessor</code> and serialization process.</p>
<p>Alternatively, you may want to handle a new content type that has no associated classes in XNA at all.  In this case, you will need to write a custom importer, processor, writer, and reader.</p>
<p>The basic tilemap we worked with in the previous chapter is a good candidate for learning how to create our own custom content importers and processors. We&rsquo;re already familiar with it, and it has just the right amount of complexity to show off important ideas about customizing the content pipeline without becoming unwieldy.</p>
<p>We&rsquo;ll start by thinking about what data we really need in our game - this defines our <em>runtime class</em>.  Basically, we need to keep our <code>Draw()</code> method and any information needed within it. But the <code>Load()</code> method we can get rid of entirely!  Our stripped-down class might look something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">ExampleGame</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemap</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The map width</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">MapWidth</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The map height</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">MapHeight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The width of a tile in the map</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">TileWidth</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The height of a tile in the map</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">TileHeight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// The texture containing the tiles</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Texture2D</span> <span class="n">TilesetTexture</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Rectangle</span><span class="p">[]</span> <span class="n">Tiles</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">TileIndices</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">init</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">,</span> <span class="n">SpriteBatch</span> <span class="n">spriteBatch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">MapHeight</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">MapWidth</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// Indices start at 1, so shift by 1 for array coordinates</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">TileIndices</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">MapWidth</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1">// Index of -1 (shifted from 0) should not be drawn</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1">// Draw the current tile</span>
</span></span><span class="line"><span class="cl">                    <span class="n">spriteBatch</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">TilesetTexture</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                            <span class="n">x</span> <span class="p">*</span> <span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">y</span> <span class="p">*</span> <span class="n">TileHeight</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">TileHeight</span>
</span></span><span class="line"><span class="cl">                            <span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="n">Tiles</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">Color</span><span class="p">.</span><span class="n">White</span>
</span></span><span class="line"><span class="cl">                        <span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We also need to provide a content pipeline version of our tilemap class. For this one, we won&rsquo;t need any of the functionality of our <code>Draw()</code> or <code>Load()</code> methods (as we don&rsquo;t need to draw in the pipeline, and we&rsquo;ll move responsibility for loading into our content importer and processor). So really, we only nee to provide a class to contain all the data contained within our tilemap file. To keep things simple, we&rsquo;ll use the same file format we did in the previous chapter, but we&rsquo;ll give the file a new extension: <strong>.tmap</strong> (it will still be a text file). Such a class might look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">BasicTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">    [ContentSerializerRuntimeType(&#34;ExampleGame.BasicTilemap, ExampleGame&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapContent</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;Map dimensions&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">MapWidth</span><span class="p">,</span> <span class="n">MapHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;Tile dimensions&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span> <span class="n">TileWidth</span><span class="p">,</span> <span class="n">TileHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;The tileset texture&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Texture2DContent</span> <span class="n">TilesetTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;The tileset data&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Rectangle</span><span class="p">[]</span> <span class="n">Tiles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;The map data&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">TileIndices</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;The map filename&lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">        [ContentSerializerIgnore]</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">string</span> <span class="n">mapFilename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt; The tileset image filename &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">        [ContentSerializerIgnore]</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">String</span> <span class="n">TilesetImageFilename</span><span class="p">;</span>      
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Note the use of the attributes <code>[ContentSerializerRuntimeType]</code> on the class, and <code>[ContentSerializerIgnore]</code>. By using these attributes and following a few simple rules, we avoid the need to write a custom content serializer and loader to write and read our specific <strong>.xnb</strong> file.</p>
<p>The <code>[ContentSerializerRuntimeType]</code> identifies what the runtime version of this class will be, as a string containing the fully-qualified class name (the class name with all its namespaces), followed by a comma and the namespaces of the class. This is specified as a string so that our content project doesn&rsquo;t need to have a reference to our game project (or a separate library project) where the class is defined.</p>
<p>The <code>[ContentSerializerIgnore]</code> attribute identifies attributes (properties and fields) of the content pipeline version that do not have a corresponding attribute in the runtime version. Thus, these will not be written to the <strong>.xnb</strong> file. For all other attributes, they need to be declared <em>in the same order</em> in both classes.  For the most part, they also need to be the same <code>Type</code> (with the exception of any classes that have distinct content pipeline/runtime forms, like the <code>Texture2DContent</code>/<code>Texture2D</code>).</p>
<p>Also, all members that will be serialized/deserialized need to be declared <code>public</code>. They can be either fields or properties, and you can mix-and-match. Here in the runtime I am using properties with an <code>init</code> accessor so that each property can only be set once, during the deserialization process. In the pipeline version I am using fields. This is mostly to demonstrate the flexibility - feel free to use whatever you feel most comfortable with.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="custom-importer">Custom Importer</h1>

<p>An importer is a class that extends the <code>ContentImporter&lt;T&gt;</code> class and overrides its <code>Import()</code> method.  Notice the class is a <em>template</em> class (the <code>&lt;T&gt;</code> in the definition).  When we define our own class, we need to replace that <code>T</code> with the specific class we want the importer to populate.  In our case, this is the <code>BasicTilemapContent</code> we defined in the previous page.</p>
<p>All importers need to override the <code>Import()</code> method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.  The purpose of an importer is to read the important parts of the asset file and load them into an object that gets passed down the pipeline, to the content processor.</p>
<p>For our example, let&rsquo;s revisit our tilemap file, now named <em>example.tmap</em>:</p>
<div class="highlight"><pre tabindex="0"><code>tileset.png
64,64
10,10
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 3, 3, 2, 4, 4, 1, 4, 2, 2, 2, 3, 3, 2, 2, 2, 2, 4, 4, 4, 2, 3, 3, 2, 2, 2, 2, 2, 2, 1, 2, 3, 3, 3, 1, 3, 2, 2, 2, 4, 4, 3, 3, 2, 2, 3, 2, 3, 2, 2, 4, 4, 3, 2, 2, 3, 2, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3</code></pre></div><p>To quickly review, the first line is the name of our tileset image file, the second is the dimensions of a single tile (in the form <strong>width,height</strong>), the third is the size of our map in tiles (again, <strong>width,height</strong>), and the fourth is the indices of the individual tiles (with a <strong>0</strong> representing no tile).</p>
<p>Now we want to load that file&rsquo;s information into a <code>TilemapContent</code> object in our importer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Xna.Framework.Content.Pipeline</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Xna.Framework.Content.Pipeline.Graphics</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">BasicTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// An importer for a basic tilemap file. The purpose of an importer to to load all important data </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// from a file into a content object; any processing of that data occurs in the subsequent content</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// processor step. </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [ContentImporter(&#34;.tmap&#34;, DisplayName = &#34;BasicTilemapImporter&#34;, DefaultProcessor = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapImporter</span> <span class="p">:</span> <span class="n">ContentImporter</span><span class="p">&lt;</span><span class="n">BasicTilemapContent</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">override</span> <span class="n">BasicTilemapContent</span> <span class="n">Import</span><span class="p">(</span><span class="kt">string</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ContentImporterContext</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Create a new BasicTilemapContent</span>
</span></span><span class="line"><span class="cl">            <span class="n">BasicTilemapContent</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Read in the map file and split along newlines </span>
</span></span><span class="line"><span class="cl">            <span class="kt">string</span> <span class="n">data</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">ReadAllText</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">lines</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// First line in the map file is the image file name,</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// we store it so it can be loaded in the processor</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TilesetImageFilename</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Trim</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Second line is the tileset image size</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">secondLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">secondLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Third line is the map size (in tiles)</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">thirdLine</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">MapWidth</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">MapHeight</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">thirdLine</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Fourth line is the map data (the indices of tiles in the map)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We can use the Linq Select() method to convert the array of strings</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// into an array of ints</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileIndices</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="m">3</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">).</span><span class="n">Select</span><span class="p">(</span><span class="n">index</span> <span class="p">=&gt;</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">index</span><span class="p">)).</span><span class="n">ToArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// At this point, we&#39;ve copied all of the file data into our</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// BasicTilemapContent object, so we pass it on to the processor</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We decorate the class with the <code>[ContentImporter]</code> attribute, which specifies a file extension this importer applies to (which is why we used the <strong>.tmap</strong> extension instead of the <strong>.txt</strong> we did previously), a name used by the MonoGame Content Editor to identify the importer, and also the suggested Content Processor to use next in the pipeline.</p>
<p>The bulk of the <code>Import()</code> method is just the parts of the <code>Load()</code> method from our original tilemap project that populated variables based on the contents of the file.  The loading of the texture and the determination of tile bounds we save for the content processor (though we save the image filename so we will have it then). The populated <code>BasicTilemapContent</code> object will be passed to it next.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="custom-processor">Custom Processor</h1>

<p>A processor is a class that extends the <code>ContentProcessor&lt;TInput, TOutput&gt;</code>class and overrides its <code>Process()</code> method. Like the importer, this is a template class, but with <em>two</em> templates!  The <code>TInput</code> identifies the class coming into the <code>Process()</code> method as an argument, and the <code>TOutput</code> identifies the class being returned from the method. Not that these don&rsquo;t have to be different classes - in our case, we&rsquo;ll continue using the <code>TilemapContent</code> class we defined earlier, and just populate a few more of its properties:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">SimpleTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// and setting up the tile information.</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapProcessor</span> <span class="p">:</span> <span class="n">ContentProcessor</span><span class="p">&lt;</span><span class="n">BasicTilemapContent</span><span class="p">,</span> <span class="n">BasicTilemapContent</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">override</span> <span class="n">BasicTilemapContent</span> <span class="n">Process</span><span class="p">(</span><span class="n">BasicTilemapContent</span> <span class="n">map</span><span class="p">,</span> <span class="n">ContentProcessorContext</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span class="line"><span class="cl">            <span class="c1">// they get loaded together by the ContentProcessor.  </span>
</span></span><span class="line"><span class="cl">            <span class="c1">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">BuildAndLoadAsset</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">,</span> <span class="n">Texture2DContent</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ExternalReference</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">&gt;(</span><span class="n">map</span><span class="p">.</span><span class="n">TilesetImageFilename</span><span class="p">),</span> <span class="s">&#34;TextureProcessor&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Determine the number of rows and columns of tiles in the tileset texture            </span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetColumns</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Width</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetRows</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Height</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// These will be stored in the tiles array</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">tilesetColumns</span> <span class="p">*</span> <span class="n">tilesetRows</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="n">LogMessage</span><span class="p">(</span><span class="s">$&#34;{map.Tiles.Length} Total tiles&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">tilesetRows</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">tilesetColumns</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">tilesetColumns</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">x</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">y</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span>
</span></span><span class="line"><span class="cl">                        <span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// Return the fully processed tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Something very interesting happens here.  The processor builds and loads the tilemap texture into the <code>Texture2DContent</code> member. This means that when we use <code>Content.Load&lt;T&gt;()</code> to load the <strong>.xnb</strong> file, it will <em>already contain the texture</em>. We don&rsquo;t need any additional steps in our game to load dependent assets. This makes complex, multi-file assets much easier to work with!</p>
<p>This is one of the most important abilities of the <code>ContentProcessorContext</code> object supplied to each processor - it allows them to build additional assets (External References in XNA lingo) without requiring those assets to be explicitly added to the content project.  We can also supply content processor parameters, or even specify a different importer and processor to use for that dependant asset to the build method.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>In this example, we used a <code>Texture2DContent</code> variable and the <code>context.BuildAndLoadAsset&lt;Texture2DContent&gt;()</code> method to build and load the asset. This approach embeds the dependent asset into the resulting map object. But what if we wanted to use the same texture in multiple maps? In that case, we could change our member to be a <code>ExternalReference&lt;Texture2DContent&gt;</code> and use the <code>context.BuildAsset&lt;Texture2D&gt;()</code> method to build it.  The benefit of this approach is that the texture is not embedded in the map&rsquo;s xnb file, but rather gets its own file. That way the <code>ContentProcessor</code> only needs load its data once - it&rsquo;s basically the flyweight pattern for external resources!</p>
</div>
</div>
<p>The other task our processor does is determine the source bounds for each of our four tiles - this code is directly taken from the earlier tilemap example&rsquo;s <code>Load()</code> method.</p>
<p>As with our importer and content class we are also using an attribute - in this case <code>[ContentProcessor]</code>. It simply defines a name for the MonoGame Content Builder to display for the processor.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="using-in-a-game">Using in a Game</h1>

<p>Using our newly-created custom pipeline in a game we are building is not terribly complicated, but does require some understanding of how projects in Visual Studio interact. Perhaps most important to this is understanding that the <strong>Content.mgcb</strong> file in your game solution <em>is actually another Visual Studio project!</em> As such, it can reference other project, just like the C# projects you are used to. This can be done through the MGCB Editor.  Just select the content project itself, and scroll down in the properties until you find the <strong>References</strong> value:</p>
<p><a href="#R-image-d1aa1f2cd2f90d4d4db28ac8787ee338" class="lightbox-link"><img alt="Selecting the MGCB Project References" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/11.6.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1aa1f2cd2f90d4d4db28ac8787ee338"><img alt="Selecting the MGCB Project References" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/11.6.1.png"></a></p>
<p>This opens a dialog you can use to add custom pipeline projects as references to your MGCB content project (in the form of <strong>.DLL</strong> files). Just browse to their location (and remember, they need to be <em>inside</em> your solution folder if you want them committed to your repository).</p>
<p><a href="#R-image-6dc32a4db46511d6097319d21f9d4e26" class="lightbox-link"><img alt="The references dialog" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/11.6.2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6dc32a4db46511d6097319d21f9d4e26"><img alt="The references dialog" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/11.6.2.png"></a></p>
<p>If your content pipeline project is in the same solution as your game project, you can browse to your content pipeline&rsquo;s <strong>/bin</strong> folder to find it.</p>
<p>Alternatively you can set your content project as a dependency of your game project, which will ensure the custom pipeline project built and the DLL is copied into your game project&rsquo;s <strong>/bin</strong> folder <em>before</em> the content project is built.  This will keep everything up-to-date, but you don&rsquo;t need the DLL to run your game (so your <strong>/bin</strong> folder is slightly bloated by this approach). This extra reference can be removed before releasing though, and it is often worth it to ensure changes to your custom pipeline are being applied in development.</p>
<p>You can also manually add the reference to your <strong>Content.mgcb</strong> file (it is just a text file, after all). The one for our example looks like:</p>
<div class="highlight"><pre tabindex="0"><code>#----------------------------- Global Properties ----------------------------#

/outputDir:bin/$(Platform)
/intermediateDir:obj/$(Platform)
/platform:Windows
/config:
/profile:Reach
/compress:False

#-------------------------------- References --------------------------------#

/reference:..\..\BasicTilemapPipeline\bin\Debug\net6.0\BasicTilemapPipeline.dll

#---------------------------------- Content ---------------------------------#

#begin example.tmap
/importer:BasicTilemapImporter
/processor:BasicTilemapProcessor
/build:example.tmap</code></pre></div><p>Once the reference is added using any of these methods, you can add your <strong>.tmap</strong> file to the content project, and it should automatically select the BasicTilemapImporter and BasicTilemapProcessor (You can also manually specify it in the <strong>.mgcb</strong> project file as shown above):</p>
<p><a href="#R-image-bed7762ed282a2189140403679e838de" class="lightbox-link"><img alt="The importer and processor in the MGCBEditor" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/11.6.3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bed7762ed282a2189140403679e838de"><img alt="The importer and processor in the MGCBEditor" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/11.6.3.png"></a></p>
<p>Once added, you can build the project, and an <strong>example.xnb</strong> file will be built and deposited in the <strong>/bin/Content</strong> folder.</p>
<p>Using it in our game simply requires using <code>Content.Load&lt;BasicTilemap&gt;(&quot;example.tmap&quot;)</code> to load the tilemap into a variable, and invoking its <code>Draw()</code> method to render it.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="the-context-object">The Context Object</h1>

<p>You probably noticed that we supply a context object to both our importer and processor - a <a href="https://docs.monogame.net/api/Microsoft.Xna.Framework.Content.Pipeline.ContentImporterContext.html" rel="external" target="_blank">ContentImporterContext</a> for the importer and a <a href="https://docs.monogame.net/api/Microsoft.Xna.Framework.Content.Pipeline.ContentProcessorContext.html" rel="external" target="_blank">ContentProcessorContext</a> for the processor.</p>
<p>They both contain a <code>Logger</code> property, which allows us to log messages during the build process of our assets.  This is important, as we can&rsquo;t use breakpoints in a content project.  So instead, we often use <code>context.Logger.LogMessage()</code>, <code>context.Logger.LogImportantMessage()</code>, and <code>context.Logger.LogWarning()</code> to let us expose the inner workings of our context pipeline.</p>
<p>We also used the ContentProcessorContext to build an external reference - the texture. In addition to this important functionality, it also exposes a dictionary of parameters supplied to the content processor. Essentially, <em>any public property</em> will be exposed as a processor parameter.  For example, if we add this to our processor class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// Applies a scaling factor to tiles while processing the tilemap</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">float</span> <span class="n">Scale</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">1.0f</span><span class="p">;</span></span></span></code></pre></div><p>The Scale property will now appear in the MGCB Editor:</p>
<p><a href="#R-image-6b64c7f02e26325e2a96b299d3516f46" class="lightbox-link"><img alt="The Scale BasicTilemapProcessor Property" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/11.7.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6b64c7f02e26325e2a96b299d3516f46"><img alt="The Scale BasicTilemapProcessor Property" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/11.7.1.png"></a></p>
<p>And, if we were to set it in the editor, the new value would be accessible in the processor, so we can use it in our <code>Process()</code> method.  Here&rsquo;s the revised processor:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">SimpleTilemapPipeline</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// and setting up the tile information.</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">BasicTilemapProcessor</span> <span class="p">:</span> <span class="n">ContentProcessor</span><span class="p">&lt;</span><span class="n">BasicTilemapContent</span><span class="p">,</span> <span class="n">BasicTilemapContent</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// A scaling parameter to make the tilemap bigger</span>
</span></span><span class="line"><span class="cl">        <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">float</span> <span class="n">Scale</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">1.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">override</span> <span class="n">BasicTilemapContent</span> <span class="n">Process</span><span class="p">(</span><span class="n">BasicTilemapContent</span> <span class="n">map</span><span class="p">,</span> <span class="n">ContentProcessorContext</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span class="line"><span class="cl">            <span class="c1">// they get loaded together by the ContentProcessor.  </span>
</span></span><span class="line"><span class="cl">            <span class="c1">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">BuildAndLoadAsset</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">,</span> <span class="n">Texture2DContent</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ExternalReference</span><span class="p">&lt;</span><span class="n">TextureContent</span><span class="p">&gt;(</span><span class="n">map</span><span class="p">.</span><span class="n">TilesetImageFilename</span><span class="p">),</span> <span class="s">&#34;TextureProcessor&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Determine the number of rows and columns of tiles in the tileset texture</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetColumns</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Width</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">tilesetRows</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">TilesetTexture</span><span class="p">.</span><span class="n">Mipmaps</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Height</span> <span class="p">/</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// These will be stored in the tiles array</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">[</span><span class="n">tilesetColumns</span> <span class="p">*</span> <span class="n">tilesetRows</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="n">LogMessage</span><span class="p">(</span><span class="s">$&#34;{map.Tiles.Length} Total tiles&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">tilesetRows</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">tilesetColumns</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// The Tiles array provides the source rectangle for a tile</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// within the tileset texture</span>
</span></span><span class="line"><span class="cl">                    <span class="n">map</span><span class="p">.</span><span class="n">Tiles</span><span class="p">[</span><span class="n">y</span> <span class="p">*</span> <span class="n">tilesetColumns</span> <span class="p">+</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">x</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">y</span> <span class="p">*</span> <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span>
</span></span><span class="line"><span class="cl">                        <span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Now that we&#39;ve created our source rectangles, we can </span>
</span></span><span class="line"><span class="cl">            <span class="c1">// apply the scaling factor to the tile dimensions - this </span>
</span></span><span class="line"><span class="cl">            <span class="c1">// will have us draw tiles at a different size than their source</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">map</span><span class="p">.</span><span class="n">TileWidth</span> <span class="p">*</span> <span class="n">Scale</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">map</span><span class="p">.</span><span class="n">TileHeight</span> <span class="p">*</span> <span class="n">Scale</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Return the fully processed tilemap</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
            <footer class="footline">
              
              
              
              
            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>

<h1 id="summary">Summary</h1>

<p>In this chapter we explored the XNA Content Pipeline in more detail, and saw how to extend the pipeline with new custom importers and processors. We saw how these can offload preparing assets for inclusion in our game to the build step, rather than performing that work while running the game. We also saw how to add custom parameters to our content processors, allowing us to tweak how assets are prepared. Taken together, this is a powerful tool for getting assets into our game in and efficient and robust manner.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>

          </section>
        </div>
      </main>
    
<div class="git-footer">
  <p class="theme-version-footer">6.0.0</p>
  <p>Last modified by: 
              <i class='fas fa-user'></i> Nathan Bean
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/87e04cf93598b5c8c3a54f4edd2bc789e2c7d397">Oct 10, 2023</a>
  </p>
  </div>
  
    
    </div>
    <script src="/cis580/js/clipboard.min.js?1723670679" defer></script>
    <script src="/cis580/js/perfect-scrollbar.min.js?1723670679" defer></script>
    <script src="/cis580/js/theme.js?1723670679" defer></script>
  </body>
</html>
