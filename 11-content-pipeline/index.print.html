<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="Get Your Assets into the Game!
via GIPHY">
    <meta name="author" content="Nathan H. Bean">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta name="twitter:title" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="Get Your Assets into the Game!
via GIPHY">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/index.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta property="og:description" content="Get Your Assets into the Game!
via GIPHY">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <meta itemprop="name" content="Content Pipeline :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="Get Your Assets into the Game!
via GIPHY">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-10-10T18:39:10-05:00">
    <meta itemprop="wordCount" content="8">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cis580/images/hero.png">
    <title>Content Pipeline :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/11-content-pipeline/index.html" rel="canonical" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/index.xml" rel="alternate" type="application/rss+xml" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/tele.html" rel="alternate" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/11-content-pipeline/embed.html" rel="alternate" type="text/html" title="Content Pipeline :: K-State CIS 580 Textbook">
    <link href="/cis580/css/auto-complete/auto-complete.min.css?1755628803" rel="stylesheet">
    <script src="/cis580/js/auto-complete/auto-complete.min.js?1755628803" defer></script>
    <script src="/cis580/js/search-lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/search.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cis580/searchindex.en.js?1755628803";
    </script>
    <script src="/cis580/js/lunr/lunr.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.stemmer.support.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.multi.min.js?1755628803" defer></script>
    <script src="/cis580/js/lunr/lunr.en.min.js?1755628803" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/fonts/fontawesome/css/fontawesome-all.min.css?1755628803" rel="stylesheet"></noscript>
    <link href="/cis580/css/perfect-scrollbar/perfect-scrollbar.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/theme.min.css?1755628803" rel="stylesheet">
    <link href="/cis580/css/format-print.min.css?1755628803" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/11-content-pipeline\/index.html';
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cis580/css/custom.css?1755628803" rel="stylesheet">
  </head>
  <body class="mobile-support print" data-url="/cis580/11-content-pipeline/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class="a11y-only"><a itemprop="item" href="/cis580/index.html"><span itemprop="name">CIS 580: Foundations of Game Programming</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Content Pipeline</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/ksu-cs-textbooks/cis580/edit/master/content/11-content-pipeline/_index.md" rel="external" target="_blank" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/10-tile-maps/06-summary/index.html" title="Summary (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/01-introduction/index.html" title="Introduction (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
            <div class="topbar-button topbar-button-embed" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/embed.html" title="Embeddable Version"><i class="fa-fw fas fa-expand-arrows-alt"></i></a>
            </div>
            <div class="topbar-button topbar-button-tele" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cis580/11-content-pipeline/tele.html" title="Teleprompter View"><i class="fa-fw fas fa-tv"></i></a>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 11-content-pipeline" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="content-pipeline">Content Pipeline</h1>

<p>Get Your Assets into the Game!</p>
<iframe src="https://giphy.com/embed/k5b6fkFnSA3yo" width="479" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/sonymusicperu-mariobross-k5b6fkFnSA3yo">via GIPHY</a></p>
  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Content Pipeline</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="introduction">Introduction</h1>

<p>The creation of assets (textures, audio, models, etc) is a major aspect of game development. In fact, asset creators account for most of a game development team (often a 90/10 split between asset creators and programmers). So creating and using assets is a very important part of creating games!</p>
<p>To make this process manageable, most assets are created with other software tools - editors specific to the kind of asset we are dealing with. Asset creators become quite proficient with these tools, and provide their assets in a save file form specific to one of these tools.</p>
<p>We can load these files directly in our game, especially if our game targets Windows, where we have a lot of available supporting libraries. But those file formats are tailored towards the needs of the editor program - they often contain data we don&rsquo;t need, or format it in a way that must be transformed to use in our games. And the processing involved in loading can be a lot more involved than we like, causing long load times.</p>
<p>One way around this is the use of a <em>Content Pipeline</em> which transforms assets from an editor-specific file format to one optimized for our games. This happens during the <em>build</em> process, so the transformed asset files are bundled with our executable, ready to be utilized.</p>
<p>This chapter will describe the content pipeline approach specific to XNA.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="the-content-pipeline">The Content Pipeline</h1>

<p>As we described in the introduction, the XNA Content Pipeline&rsquo;s purpose is to transform asset files (content) in to a form most readily useable by our games. It is implemented as a separate build step that is run every time we compile our game. In fact, each XNA game is actually <em>two</em> projects - the <em>Content</em> project, and the <em>Game</em> project.</p>
<p>The pipeline is broken up into several steps:</p>
<ol>
<li>Importing the asset data</li>
<li>Processing the asset data</li>
<li>Serializing the asset data</li>
<li>Loading the serialized asset data</li>
</ol>
<p>You can see the process here:</p>
<p><a href="#R-image-39434da2e29e6df2efe53d48bc56ac40" class="lightbox-link"><img alt="XNA Content Pipeline" class="border lazy lightbox figure-image" loading="lazy" src="/cis580/images/11.2.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-39434da2e29e6df2efe53d48bc56ac40"><img alt="XNA Content Pipeline" class="border lazy lightbox lightbox-image" loading="lazy" src="/cis580/images/11.2.1.png"></a></p>
<p>Each of these steps is accomplished by a different class, and the data passed between the steps is also typically done as an object (defined by a class).</p>
<p>The two projects share a single file - the <strong>.xnb</strong> file generated from the content. This is essentially an object that has been serialized as binary data by the content serializer class, and will be deserialized back into an object by the content loader class.</p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    Info
  </summary>
  <div class="box-content">
<p>An important aspect of the serialization process is that the object that is serialized into a <strong>.xnb</strong> file and the one deserialized from it <em>don&rsquo;t have to be the defined by the same class</em>! For example, in the content pipeline simple 2d textures are represented by a <code>Texture2DContent</code> instance, while in runtime projects we load the serialized data into a <code>Texture2D</code> instance. The key is that the serialized data is the same for both.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="extending-the-pipeline">Extending the Pipeline</h1>

<p>You might be wondering why the content pipeline in XNA was created this way - with importers, processors, content writers, and content readers.  The answer is simple - modularity.  If you want to load a new image format that the <code>TextureImporter</code> does not handle, you can write your own custom importer to load its data into a <code>TextureContent</code> object, and then still use the existing <code>TextureProcessor</code> and serialization process.</p>
<p>Alternatively, you may want to handle a new content type that has no associated classes in XNA at all.  In this case, you will need to write a custom importer, processor, writer, and reader.</p>
<p>The basic tilemap we worked with in the previous chapter is a good candidate for learning how to create our own custom content importers and processors. We&rsquo;re already familiar with it, and it has just the right amount of complexity to show off important ideas about customizing the content pipeline without becoming unwieldy.</p>
<p>We&rsquo;ll start by thinking about what data we really need in our game - this defines our <em>runtime class</em>.  Basically, we need to keep our <code>Draw()</code> method and any information needed within it. But the <code>Load()</code> method we can get rid of entirely!  Our stripped-down class might look something like:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> ExampleGame
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemap</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The map width</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> MapWidth { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The map height</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> MapHeight { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The width of a tile in the map</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> TileWidth { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The height of a tile in the map</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> TileHeight { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// The texture containing the tiles</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Texture2D TilesetTexture { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Rectangle[] Tiles { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span>[] TileIndices { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">init</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Draw(GameTime gameTime, SpriteBatch spriteBatch)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; MapHeight; y++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; MapWidth; x++)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Indices start at 1, so shift by 1 for array coordinates</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">int</span> index = TileIndices[y * MapWidth + x] - <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Index of -1 (shifted from 0) should not be drawn</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (index == -<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Draw the current tile</span>
</span></span><span style="display:flex;"><span>                    spriteBatch.Draw(
</span></span><span style="display:flex;"><span>                        TilesetTexture,
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">new</span> Rectangle(
</span></span><span style="display:flex;"><span>                            x * TileWidth,
</span></span><span style="display:flex;"><span>                            y * TileHeight,
</span></span><span style="display:flex;"><span>                            TileWidth,
</span></span><span style="display:flex;"><span>                            TileHeight
</span></span><span style="display:flex;"><span>                            ),
</span></span><span style="display:flex;"><span>                        Tiles[index],
</span></span><span style="display:flex;"><span>                        Color.White
</span></span><span style="display:flex;"><span>                        );
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>We also need to provide a content pipeline version of our tilemap class. For this one, we won&rsquo;t need any of the functionality of our <code>Draw()</code> or <code>Load()</code> methods (as we don&rsquo;t need to draw in the pipeline, and we&rsquo;ll move responsibility for loading into our content importer and processor). So really, we only nee to provide a class to contain all the data contained within our tilemap file. To keep things simple, we&rsquo;ll use the same file format we did in the previous chapter, but we&rsquo;ll give the file a new extension: <strong>.tmap</strong> (it will still be a text file). Such a class might look like:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> BasicTilemapPipeline
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentSerializerRuntimeType(&#34;ExampleGame.BasicTilemap, ExampleGame&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapContent</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;Map dimensions&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> MapWidth, MapHeight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;Tile dimensions&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> TileWidth, TileHeight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;The tileset texture&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Texture2DContent TilesetTexture;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;The tileset data&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Rectangle[] Tiles;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;The map data&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span>[] TileIndices;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;The map filename&lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [ContentSerializerIgnore]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> mapFilename;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt; The tileset image filename &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [ContentSerializerIgnore]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> String TilesetImageFilename;      
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Note the use of the attributes <code>[ContentSerializerRuntimeType]</code> on the class, and <code>[ContentSerializerIgnore]</code>. By using these attributes and following a few simple rules, we avoid the need to write a custom content serializer and loader to write and read our specific <strong>.xnb</strong> file.</p>
<p>The <code>[ContentSerializerRuntimeType]</code> identifies what the runtime version of this class will be, as a string containing the fully-qualified class name (the class name with all its namespaces), followed by a comma and the namespaces of the class. This is specified as a string so that our content project doesn&rsquo;t need to have a reference to our game project (or a separate library project) where the class is defined.</p>
<p>The <code>[ContentSerializerIgnore]</code> attribute identifies attributes (properties and fields) of the content pipeline version that do not have a corresponding attribute in the runtime version. Thus, these will not be written to the <strong>.xnb</strong> file. For all other attributes, they need to be declared <em>in the same order</em> in both classes.  For the most part, they also need to be the same <code>Type</code> (with the exception of any classes that have distinct content pipeline/runtime forms, like the <code>Texture2DContent</code>/<code>Texture2D</code>).</p>
<p>Also, all members that will be serialized/deserialized need to be declared <code>public</code>. They can be either fields or properties, and you can mix-and-match. Here in the runtime I am using properties with an <code>init</code> accessor so that each property can only be set once, during the deserialization process. In the pipeline version I am using fields. This is mostly to demonstrate the flexibility - feel free to use whatever you feel most comfortable with.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="custom-importer">Custom Importer</h1>

<p>An importer is a class that extends the <code>ContentImporter&lt;T&gt;</code> class and overrides its <code>Import()</code> method.  Notice the class is a <em>template</em> class (the <code>&lt;T&gt;</code> in the definition).  When we define our own class, we need to replace that <code>T</code> with the specific class we want the importer to populate.  In our case, this is the <code>BasicTilemapContent</code> we defined in the previous page.</p>
<p>All importers need to override the <code>Import()</code> method. This method takes a filename (the filename of the asset) as an argument, and returns the class specified in the template.  The purpose of an importer is to read the important parts of the asset file and load them into an object that gets passed down the pipeline, to the content processor.</p>
<p>For our example, let&rsquo;s revisit our tilemap file, now named <em>example.tmap</em>:</p>
<div class="highlight" dir="auto"><pre tabindex="0"><code>tileset.png
64,64
10,10
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 3, 3, 2, 4, 4, 1, 4, 2, 2, 2, 3, 3, 2, 2, 2, 2, 4, 4, 4, 2, 3, 3, 2, 2, 2, 2, 2, 2, 1, 2, 3, 3, 3, 1, 3, 2, 2, 2, 4, 4, 3, 3, 2, 2, 3, 2, 3, 2, 2, 4, 4, 3, 2, 2, 3, 2, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3</code></pre></div>
<p>To quickly review, the first line is the name of our tileset image file, the second is the dimensions of a single tile (in the form <strong>width,height</strong>), the third is the size of our map in tiles (again, <strong>width,height</strong>), and the fourth is the indices of the individual tiles (with a <strong>0</strong> representing no tile).</p>
<p>Now we want to load that file&rsquo;s information into a <code>TilemapContent</code> object in our importer:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.IO;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Xna.Framework.Content.Pipeline;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Xna.Framework.Content.Pipeline.Graphics;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> BasicTilemapPipeline
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// An importer for a basic tilemap file. The purpose of an importer to to load all important data </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// from a file into a content object; any processing of that data occurs in the subsequent content</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// processor step. </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentImporter(&#34;.tmap&#34;, DisplayName = &#34;BasicTilemapImporter&#34;, DefaultProcessor = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapImporter</span> : ContentImporter&lt;BasicTilemapContent&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> BasicTilemapContent Import(<span style="color:#66d9ef">string</span> filename, ContentImporterContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Create a new BasicTilemapContent</span>
</span></span><span style="display:flex;"><span>            BasicTilemapContent map = <span style="color:#66d9ef">new</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Read in the map file and split along newlines </span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">string</span> data = File.ReadAllText(filename);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> lines = data.Split(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// First line in the map file is the image file name,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// we store it so it can be loaded in the processor</span>
</span></span><span style="display:flex;"><span>            map.TilesetImageFilename = lines[<span style="color:#ae81ff">0</span>].Trim();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Second line is the tileset image size</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> secondLine = lines[<span style="color:#ae81ff">1</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>            map.TileWidth = <span style="color:#66d9ef">int</span>.Parse(secondLine[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>            map.TileHeight = <span style="color:#66d9ef">int</span>.Parse(secondLine[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Third line is the map size (in tiles)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> thirdLine = lines[<span style="color:#ae81ff">2</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>            map.MapWidth = <span style="color:#66d9ef">int</span>.Parse(thirdLine[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>            map.MapHeight = <span style="color:#66d9ef">int</span>.Parse(thirdLine[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Fourth line is the map data (the indices of tiles in the map)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We can use the Linq Select() method to convert the array of strings</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// into an array of ints</span>
</span></span><span style="display:flex;"><span>            map.TileIndices = lines[<span style="color:#ae81ff">3</span>].Split(<span style="color:#e6db74">&#39;,&#39;</span>).Select(index =&gt; <span style="color:#66d9ef">int</span>.Parse(index)).ToArray();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// At this point, we&#39;ve copied all of the file data into our</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// BasicTilemapContent object, so we pass it on to the processor</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>We decorate the class with the <code>[ContentImporter]</code> attribute, which specifies a file extension this importer applies to (which is why we used the <strong>.tmap</strong> extension instead of the <strong>.txt</strong> we did previously), a name used by the MonoGame Content Editor to identify the importer, and also the suggested Content Processor to use next in the pipeline.</p>
<p>The bulk of the <code>Import()</code> method is just the parts of the <code>Load()</code> method from our original tilemap project that populated variables based on the contents of the file.  The loading of the texture and the determination of tile bounds we save for the content processor (though we save the image filename so we will have it then). The populated <code>BasicTilemapContent</code> object will be passed to it next.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="custom-processor">Custom Processor</h1>

<p>A processor is a class that extends the <code>ContentProcessor&lt;TInput, TOutput&gt;</code>class and overrides its <code>Process()</code> method. Like the importer, this is a template class, but with <em>two</em> templates!  The <code>TInput</code> identifies the class coming into the <code>Process()</code> method as an argument, and the <code>TOutput</code> identifies the class being returned from the method. Not that these don&rsquo;t have to be different classes - in our case, we&rsquo;ll continue using the <code>TilemapContent</code> class we defined earlier, and just populate a few more of its properties:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> SimpleTilemapPipeline
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// and setting up the tile information.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapProcessor</span> : ContentProcessor&lt;BasicTilemapContent, BasicTilemapContent&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> BasicTilemapContent Process(BasicTilemapContent map, ContentProcessorContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// they get loaded together by the ContentProcessor.  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span style="display:flex;"><span>            map.TilesetTexture = context.BuildAndLoadAsset&lt;TextureContent, Texture2DContent&gt;(<span style="color:#66d9ef">new</span> ExternalReference&lt;TextureContent&gt;(map.TilesetImageFilename), <span style="color:#e6db74">&#34;TextureProcessor&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Determine the number of rows and columns of tiles in the tileset texture            </span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetColumns = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Width / map.TileWidth;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetRows = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Height / map.TileWidth;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// These will be stored in the tiles array</span>
</span></span><span style="display:flex;"><span>            map.Tiles = <span style="color:#66d9ef">new</span> Rectangle[tilesetColumns * tilesetRows];
</span></span><span style="display:flex;"><span>            context.Logger.LogMessage(<span style="color:#e6db74">$&#34;{map.Tiles.Length} Total tiles&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; tilesetRows; y++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; tilesetColumns; x++)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    map.Tiles[y * tilesetColumns + x] = <span style="color:#66d9ef">new</span> Rectangle(
</span></span><span style="display:flex;"><span>                        x * map.TileWidth,
</span></span><span style="display:flex;"><span>                        y * map.TileHeight,
</span></span><span style="display:flex;"><span>                        map.TileWidth,
</span></span><span style="display:flex;"><span>                        map.TileHeight
</span></span><span style="display:flex;"><span>                        );
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Return the fully processed tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Something very interesting happens here.  The processor builds and loads the tilemap texture into the <code>Texture2DContent</code> member. This means that when we use <code>Content.Load&lt;T&gt;()</code> to load the <strong>.xnb</strong> file, it will <em>already contain the texture</em>. We don&rsquo;t need any additional steps in our game to load dependent assets. This makes complex, multi-file assets much easier to work with!</p>
<p>This is one of the most important abilities of the <code>ContentProcessorContext</code> object supplied to each processor - it allows them to build additional assets (External References in XNA lingo) without requiring those assets to be explicitly added to the content project.  We can also supply content processor parameters, or even specify a different importer and processor to use for that dependant asset to the build method.</p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    Info
  </summary>
  <div class="box-content">
<p>In this example, we used a <code>Texture2DContent</code> variable and the <code>context.BuildAndLoadAsset&lt;Texture2DContent&gt;()</code> method to build and load the asset. This approach embeds the dependent asset into the resulting map object. But what if we wanted to use the same texture in multiple maps? In that case, we could change our member to be a <code>ExternalReference&lt;Texture2DContent&gt;</code> and use the <code>context.BuildAsset&lt;Texture2D&gt;()</code> method to build it.  The benefit of this approach is that the texture is not embedded in the map&rsquo;s xnb file, but rather gets its own file. That way the <code>ContentProcessor</code> only needs load its data once - it&rsquo;s basically the flyweight pattern for external resources!</p>
  </div>
</details>
<p>The other task our processor does is determine the source bounds for each of our four tiles - this code is directly taken from the earlier tilemap example&rsquo;s <code>Load()</code> method.</p>
<p>As with our importer and content class we are also using an attribute - in this case <code>[ContentProcessor]</code>. It simply defines a name for the MonoGame Content Builder to display for the processor.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="using-in-a-game">Using in a Game</h1>

<p>Using our newly-created custom pipeline in a game we are building is not terribly complicated, but does require some understanding of how projects in Visual Studio interact. Perhaps most important to this is understanding that the <strong>Content.mgcb</strong> file in your game solution <em>is actually another Visual Studio project!</em> As such, it can reference other project, just like the C# projects you are used to. This can be done through the MGCB Editor.  Just select the content project itself, and scroll down in the properties until you find the <strong>References</strong> value:</p>
<p><a href="#R-image-c8c164350495969020a826f47a98cf77" class="lightbox-link"><img alt="Selecting the MGCB Project References" class="border lazy lightbox figure-image" loading="lazy" src="/cis580/images/11.6.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c8c164350495969020a826f47a98cf77"><img alt="Selecting the MGCB Project References" class="border lazy lightbox lightbox-image" loading="lazy" src="/cis580/images/11.6.1.png"></a></p>
<p>This opens a dialog you can use to add custom pipeline projects as references to your MGCB content project (in the form of <strong>.DLL</strong> files). Just browse to their location (and remember, they need to be <em>inside</em> your solution folder if you want them committed to your repository).</p>
<p><a href="#R-image-82e1b5c0de1a834d5fbb12363f08a47c" class="lightbox-link"><img alt="The references dialog" class="border lazy lightbox figure-image" loading="lazy" src="/cis580/images/11.6.2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-82e1b5c0de1a834d5fbb12363f08a47c"><img alt="The references dialog" class="border lazy lightbox lightbox-image" loading="lazy" src="/cis580/images/11.6.2.png"></a></p>
<p>If your content pipeline project is in the same solution as your game project, you can browse to your content pipeline&rsquo;s <strong>/bin</strong> folder to find it.</p>
<p>Alternatively you can set your content project as a dependency of your game project, which will ensure the custom pipeline project built and the DLL is copied into your game project&rsquo;s <strong>/bin</strong> folder <em>before</em> the content project is built.  This will keep everything up-to-date, but you don&rsquo;t need the DLL to run your game (so your <strong>/bin</strong> folder is slightly bloated by this approach). This extra reference can be removed before releasing though, and it is often worth it to ensure changes to your custom pipeline are being applied in development.</p>
<p>You can also manually add the reference to your <strong>Content.mgcb</strong> file (it is just a text file, after all). The one for our example looks like:</p>
<div class="highlight" dir="auto"><pre tabindex="0"><code>#----------------------------- Global Properties ----------------------------#

/outputDir:bin/$(Platform)
/intermediateDir:obj/$(Platform)
/platform:Windows
/config:
/profile:Reach
/compress:False

#-------------------------------- References --------------------------------#

/reference:..\..\BasicTilemapPipeline\bin\Debug\net6.0\BasicTilemapPipeline.dll

#---------------------------------- Content ---------------------------------#

#begin example.tmap
/importer:BasicTilemapImporter
/processor:BasicTilemapProcessor
/build:example.tmap</code></pre></div>
<p>Once the reference is added using any of these methods, you can add your <strong>.tmap</strong> file to the content project, and it should automatically select the BasicTilemapImporter and BasicTilemapProcessor (You can also manually specify it in the <strong>.mgcb</strong> project file as shown above):</p>
<p><a href="#R-image-5aea2dfcda119f6bb63187d31aa3ba24" class="lightbox-link"><img alt="The importer and processor in the MGCBEditor" class="border lazy lightbox figure-image" loading="lazy" src="/cis580/images/11.6.3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5aea2dfcda119f6bb63187d31aa3ba24"><img alt="The importer and processor in the MGCBEditor" class="border lazy lightbox lightbox-image" loading="lazy" src="/cis580/images/11.6.3.png"></a></p>
<p>Once added, you can build the project, and an <strong>example.xnb</strong> file will be built and deposited in the <strong>/bin/Content</strong> folder.</p>
<p>Using it in our game simply requires using <code>Content.Load&lt;BasicTilemap&gt;(&quot;example.tmap&quot;)</code> to load the tilemap into a variable, and invoking its <code>Draw()</code> method to render it.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="the-context-object">The Context Object</h1>

<p>You probably noticed that we supply a context object to both our importer and processor - a <a href="https://docs.monogame.net/api/Microsoft.Xna.Framework.Content.Pipeline.ContentImporterContext.html" rel="external" target="_blank">ContentImporterContext</a> for the importer and a <a href="https://docs.monogame.net/api/Microsoft.Xna.Framework.Content.Pipeline.ContentProcessorContext.html" rel="external" target="_blank">ContentProcessorContext</a> for the processor.</p>
<p>They both contain a <code>Logger</code> property, which allows us to log messages during the build process of our assets.  This is important, as we can&rsquo;t use breakpoints in a content project.  So instead, we often use <code>context.Logger.LogMessage()</code>, <code>context.Logger.LogImportantMessage()</code>, and <code>context.Logger.LogWarning()</code> to let us expose the inner workings of our context pipeline.</p>
<p>We also used the ContentProcessorContext to build an external reference - the texture. In addition to this important functionality, it also exposes a dictionary of parameters supplied to the content processor. Essentially, <em>any public property</em> will be exposed as a processor parameter.  For example, if we add this to our processor class:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// Applies a scaling factor to tiles while processing the tilemap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Scale { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#ae81ff">1.0f</span>;</span></span></code></pre></div>
<p>The Scale property will now appear in the MGCB Editor:</p>
<p><a href="#R-image-3181e671281423a32018bf016bb259a1" class="lightbox-link"><img alt="The Scale BasicTilemapProcessor Property" class="border lazy lightbox figure-image" loading="lazy" src="/cis580/images/11.7.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3181e671281423a32018bf016bb259a1"><img alt="The Scale BasicTilemapProcessor Property" class="border lazy lightbox lightbox-image" loading="lazy" src="/cis580/images/11.7.1.png"></a></p>
<p>And, if we were to set it in the editor, the new value would be accessible in the processor, so we can use it in our <code>Process()</code> method.  Here&rsquo;s the revised processor:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> SimpleTilemapPipeline
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Processes a BasicTilemapContent object, building and linking the associated texture </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// and setting up the tile information.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [ContentProcessor(DisplayName = &#34;BasicTilemapProcessor&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicTilemapProcessor</span> : ContentProcessor&lt;BasicTilemapContent, BasicTilemapContent&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// A scaling parameter to make the tilemap bigger</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> Scale { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#ae81ff">1.0f</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> BasicTilemapContent Process(BasicTilemapContent map, ContentProcessorContext context)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to build the tileset texture associated with this tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// This will create the binary texture file and link it to this tilemap so </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// they get loaded together by the ContentProcessor.  </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//map.TilesetTexture = context.BuildAsset&lt;Texture2DContent, Texture2DContent&gt;(map.TilesetTexture, &#34;Texture2DProcessor&#34;);</span>
</span></span><span style="display:flex;"><span>            map.TilesetTexture = context.BuildAndLoadAsset&lt;TextureContent, Texture2DContent&gt;(<span style="color:#66d9ef">new</span> ExternalReference&lt;TextureContent&gt;(map.TilesetImageFilename), <span style="color:#e6db74">&#34;TextureProcessor&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Determine the number of rows and columns of tiles in the tileset texture</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetColumns = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Width / map.TileWidth;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> tilesetRows = map.TilesetTexture.Mipmaps[<span style="color:#ae81ff">0</span>].Height / map.TileWidth;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We need to create the bounds for each tile in the tileset image</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// These will be stored in the tiles array</span>
</span></span><span style="display:flex;"><span>            map.Tiles = <span style="color:#66d9ef">new</span> Rectangle[tilesetColumns * tilesetRows];
</span></span><span style="display:flex;"><span>            context.Logger.LogMessage(<span style="color:#e6db74">$&#34;{map.Tiles.Length} Total tiles&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> y = <span style="color:#ae81ff">0</span>; y &lt; tilesetRows; y++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> x = <span style="color:#ae81ff">0</span>; x &lt; tilesetColumns; x++)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// The Tiles array provides the source rectangle for a tile</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// within the tileset texture</span>
</span></span><span style="display:flex;"><span>                    map.Tiles[y * tilesetColumns + x] = <span style="color:#66d9ef">new</span> Rectangle(
</span></span><span style="display:flex;"><span>                        x * map.TileWidth,
</span></span><span style="display:flex;"><span>                        y * map.TileHeight,
</span></span><span style="display:flex;"><span>                        map.TileWidth,
</span></span><span style="display:flex;"><span>                        map.TileHeight
</span></span><span style="display:flex;"><span>                        );
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Now that we&#39;ve created our source rectangles, we can </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// apply the scaling factor to the tile dimensions - this </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// will have us draw tiles at a different size than their source</span>
</span></span><span style="display:flex;"><span>            map.TileWidth = (<span style="color:#66d9ef">int</span>)(map.TileWidth * Scale);
</span></span><span style="display:flex;"><span>            map.TileHeight = (<span style="color:#66d9ef">int</span>)(map.TileHeight * Scale);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Return the fully processed tilemap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="summary">Summary</h1>

<p>In this chapter we explored the XNA Content Pipeline in more detail, and saw how to extend the pipeline with new custom importers and processors. We saw how these can offload preparing assets for inclusion in our game to the build step, rather than performing that work while running the game. We also saw how to add custom parameters to our content processors, allowing us to tweak how assets are prepared. Taken together, this is a powerful tool for getting assets into our game in and efficient and robust manner.</p>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
<div class="git-footer">
  <p class="theme-version-footer">8.0.0</p>
<p>Last modified by:
              <i class='fa-fw fas fa-user'></i> Nathan Bean
              <i class='fas fa-calendar'></i> <a href="https://github.com/ksu-cs-textbooks/cis580/commit/87e04cf93598b5c8c3a54f4edd2bc789e2c7d397">Oct 10, 2023</a>
</p>

</div>
    </div>
    <script src="/cis580/js/clipboard/clipboard.min.js?1755628803" defer></script>
    <script src="/cis580/js/perfect-scrollbar/perfect-scrollbar.min.js?1755628803" defer></script>
    <script src="/cis580/js/theme.min.js?1755628803" defer></script>
  </body>
</html>
