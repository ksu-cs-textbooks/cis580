




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="You probably remember from our discussions of matrix math that we can create matrices to represent arbitrary transformations. Moreover, we can transform a vector by multiplying it by one of these transformation matrices. This is the mathematical foundations of hardware-accelerated 3D rendering. In fact, the GPU is nothing more than a processor optimized for performing matrix and vector operations.
We model our three-dimensional worlds with triangles. Lots and lots of triangles.">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="It Starts with Triangles :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="You probably remember from our discussions of matrix math that we can create matrices to represent arbitrary transformations. Moreover, we can transform a vector by multiplying it by one of these transformation matrices. This is the mathematical foundations of hardware-accelerated 3D rendering. In fact, the GPU is nothing more than a processor optimized for performing matrix and vector operations.
We model our three-dimensional worlds with triangles. Lots and lots of triangles.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/embed.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="It Starts with Triangles :: K-State CIS 580 Textbook">
    <meta property="og:description" content="You probably remember from our discussions of matrix math that we can create matrices to represent arbitrary transformations. Moreover, we can transform a vector by multiplying it by one of these transformation matrices. This is the mathematical foundations of hardware-accelerated 3D rendering. In fact, the GPU is nothing more than a processor optimized for performing matrix and vector operations.
We model our three-dimensional worlds with triangles. Lots and lots of triangles.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Basic 3D Rendering">
    <meta property="article:published_time" content="2020-03-24T10:00:00-05:00">
    <meta property="article:modified_time" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="name" content="It Starts with Triangles :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="You probably remember from our discussions of matrix math that we can create matrices to represent arbitrary transformations. Moreover, we can transform a vector by multiplying it by one of these transformation matrices. This is the mathematical foundations of hardware-accelerated 3D rendering. In fact, the GPU is nothing more than a processor optimized for performing matrix and vector operations.
We model our three-dimensional worlds with triangles. Lots and lots of triangles.">
    <meta itemprop="datePublished" content="2020-03-24T10:00:00-05:00">
    <meta itemprop="dateModified" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="wordCount" content="2464">
    <title>It Starts with Triangles :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/" rel="canonical" type="text/html" title="It Starts with Triangles :: K-State CIS 580 Textbook">
    <link href="/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/index.xml" rel="alternate" type="application/rss+xml" title="It Starts with Triangles :: K-State CIS 580 Textbook">
    <link href="/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/index.print.html" rel="alternate" type="text/html" title="It Starts with Triangles :: K-State CIS 580 Textbook">
    <link href="/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/tele.html" rel="alternate" type="text/html" title="It Starts with Triangles :: K-State CIS 580 Textbook">
    
  <link href="/cis580/css/fontawesome-all.min.css?1723670677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1723670677" rel="stylesheet"></noscript>
  <link href="/cis580/css/nucleus.css?1723670677" rel="stylesheet">
  <link href="/cis580/css/auto-complete.css?1723670677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1723670677" rel="stylesheet"></noscript>
  <link href="/cis580/css/perfect-scrollbar.min.css?1723670677" rel="stylesheet">
  <link href="/cis580/css/fonts.css?1723670677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1723670677" rel="stylesheet"></noscript>
  <link href="/cis580/css/theme.css?1723670677" rel="stylesheet">
  
  
  
  <link href="/cis580/css/theme-light-theme.css?1723670677" rel="stylesheet" id="R-variant-style">
  <link href="/cis580/css/chroma-relearn-light.css?1723670677" rel="stylesheet" id="R-variant-chroma-style">
  <link href="/cis580/css/variant.css?1723670677" rel="stylesheet">
  <link href="/cis580/css/print.css?1723670677" rel="stylesheet" media="print">
  
  
  
  <script>
    window.relearn = window.relearn || {};
    window.relearn.relBasePath='..\/..';
    window.relearn.relBaseUri='..\/..\/..';
    window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
    window.index_js_url="/cis580/index.search.js";
    // variant stuff
    window.variants && variants.init( [ 'light-theme' ] );
    // translations
    window.T_Copy_to_clipboard = `Copy to clipboard`;
    window.T_Copied_to_clipboard = `Copied to clipboard!`;
    window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
    window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
    window.T_Reset_view = `Reset view`;
    window.T_View_reset = `View reset!`;
    window.T_No_results_found = `No results found for "{0}"`;
    window.T_N_results_found = `{1} results found for "{0}"`;
  </script>
  
  <link href="/cis580/css/custom.css?1723670677" rel="stylesheet">
    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/embed.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    

<p>You probably remember from our discussions of matrix math that we can create matrices to represent arbitrary transformations.  Moreover, we can transform a vector by multiplying it by one of these transformation matrices.  This is the mathematical foundations of hardware-accelerated 3D rendering.  In fact, the GPU is nothing more than a processor optimized for performing matrix and vector operations.</p>
<p>We model our three-dimensional worlds with triangles.  Lots and lots of triangles.  Why triangles?  Remember that three points define a plane.  Three points also can define a triangle.  So we know that the three endpoints of a triangle will <em>always</em> be coplanar.  If we used more than three points, there is a possibility that we might screw up and have one out-of-plane, which would break the process.  So 3D rendering is almost entirely based on rendering triangles (you can also render lines and points with OpenGL and DirectX, but XNA only supports triangles and lines).</p>
<p>Complex objects are therefore composed of multiple triangles, which typically share sides and create a closed shape with a distinct inside and outside.  We call these <em>triangle meshes</em>, and they effectively create a hollow shell in the shape of the object to be rendered:</p>
<p><a href="#R-image-a9c0777c58bfe4c40283d5431e7521c8" class="lightbox-link"><img alt="Triangle Mesh" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/triangle-mesh.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a9c0777c58bfe4c40283d5431e7521c8"><img alt="Triangle Mesh" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/triangle-mesh.png"></a></p>
<h2 id="vertices">Vertices</h2>
<p>Rather than creating structures for storing triangles, we store the endpoints of the triangles as <em>vertices</em>.  These vertices are a data structure that (at a minimum) defines the coordinate of the triangle endpoint in three dimensions (A Vector3 in XNA).  Vertices can contain additional data needed to render the mesh, including color, texture coordinates, and additional vectors like the surface normal (a Vector3 pointing <em>out</em> from the surface).</p>
<p>Let&rsquo;s create a class to represent our cube, and give it an array of vertices that have both a position and a color:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A class for rendering a single triangle</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Triangle</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The vertices of the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">VertexPositionColor</span><span class="p">[]</span> <span class="n">vertices</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Note the <a href="https://www.monogame.net/documentation/?page=T_Microsoft_Xna_Framework_Graphics_VertexPositionColor" rel="external" target="_blank">VertexPositionColor</a> is defined in the <code>Microsoft.Xna.Framework.Graphics</code> namespace.</p>
<h2 id="triangles">Triangles</h2>
<p>Triangles are then defined by the order the vertices are presented to the graphics card, defined by a <em>graphics primitive type</em>.  There are four supported by XNA, and appear in the <a href="https://www.monogame.net/documentation/?page=T_Microsoft_Xna_Framework_Graphics_PrimitiveType" rel="external" target="_blank">PrimitiveType enumeration</a>.  These are <em>LineList</em>, <em>LineStrip</em>, <em>TriangleList</em>, and <em>TriangleStrip</em>.  The first two vertices in a <code>LineList</code> define the two endpoints of a line, the second two, a second line.  In contrast, with a <code>LineStrip</code> each successive line connects to the previous one, sharing a vertex.  Thus vertices 0 and 1 define the first line, vertices 1 and 2 define the second, vertices 2 and 3 the third, and so on&hellip;</p>
<p>The <code>TriangleList</code> and <code>TriangleStrip</code> work the same way.  In a <code>TriangleList</code> each three vertices define a single triangle.  Hence vertices 0, 1, and 2 define the first triangle, and vertices 3, 4, and 5, the second, and so on.  With the <code>TriangleStrip</code>, vertices 0, 1, and 2 define the first triangle; vertices 1, 2, and 3 define the second, vertices 2, 3, and 4 the third, and so on&hellip;</p>
<p>Our <code>Triangle</code> will only be using vertices 0, 1, and 2, so either approach will be identical.  Let&rsquo;s go ahead and define those vertices in a helper method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the vertices of the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">void</span> <span class="n">InitializeVertices</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">VertexPositionColor</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// vertex 0</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// vertex 1</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Green</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// vertex 2 </span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">Position</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">vertices</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h2 id="the-effect">The Effect</h2>
<p>One of the major innovations of hardware graphics has been the introduction of <em>programmable shaders</em>.  A shader is simply a program that runs on a GPU, and performs some steps of the graphics pipeline.  At the time XNA was created, there were three points in the graphics pipeline where programmable shaders could be inserted: the <em>vertex shader</em>, the <em>geometry shader</em>, and the <em>pixel shader</em> (additional shader points have been added to graphics cards since).  These shaders are written in a language specific to the GPU and graphics library (DirectX or OpenGL).  In XNA, this language is <a href="https://en.wikipedia.org/wiki/High-Level_Shading_Language" rel="external" target="_blank">HLSL</a>.</p>
<p>XNA seeks to simplify the details of setting up shaders by abstracting the heavy lifting into the <a href="https://www.monogame.net/documentation/?page=T_Microsoft_Xna_Framework_Graphics_Effect" rel="external" target="_blank">Effect Class</a>.  An <code>Effect</code> handles configuring the graphics device to produce a specific effect through a combination of shaders and hardware settings.  We can create custom classes derived from the <code>Effect</code> class, or use one of those already defined in XNA:</p>
<ul>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_BasicEffect.html" rel="external" target="_blank">BasicEffect</a></li>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_AlphaTestEffect.html" rel="external" target="_blank">AlphaTestEffect</a></li>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_DualTextureEffect.html" rel="external" target="_blank">DualTextureEffect</a></li>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_EnvironmentMapEffect.html" rel="external" target="_blank">EnvironmentMapEffect</a></li>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_SkinnedEffect.html" rel="external" target="_blank">SkinnedEffect</a></li>
<li><a href="https://www.monogame.net/docs/html/T_Microsoft_Xna_Framework_Graphics_SpriteEffect.html" rel="external" target="_blank">SpriteEffect</a></li>
</ul>
<p>With our triangle, we&rsquo;ll use the <code>BasicEffect</code>, which provides a basic rendering pipeline.  Let&rsquo;s add a field for one to our <code>Triangle</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The effect to use rendering the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">BasicEffect</span> <span class="n">effect</span><span class="p">;</span></span></span></code></pre></div><p>The effect also needs  a reference to the <code>GraphicsDevice</code> held by our <code>Game</code> instance; so let&rsquo;s also add a <code>Game</code> field:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The game this triangle belongs to </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Game</span> <span class="n">game</span><span class="p">;</span></span></span></code></pre></div><p>You&rsquo;ll also need to add the <code>Microsoft.Xna.Framework</code> namespace to make <code>Game</code> available.</p>
<p>Now let&rsquo;s initialize our effects settings in a second helper method, <code>InitializeEffect()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the BasicEffect to render our triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">void</span> <span class="n">InitializeEffect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BasicEffect</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">View</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> <span class="c1">// The camera position</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="c1">// The camera target,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span>            <span class="c1">// The camera up vector</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span>                         <span class="c1">// The field-of-view </span>
</span></span><span class="line"><span class="cl">            <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Viewport</span><span class="p">.</span><span class="n">AspectRatio</span><span class="p">,</span>   <span class="c1">// The aspect ratio</span>
</span></span><span class="line"><span class="cl">            <span class="m">0.1f</span><span class="p">,</span> <span class="c1">// The near plane distance </span>
</span></span><span class="line"><span class="cl">            <span class="m">100.0f</span> <span class="c1">// The far plane distance</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">VertexColorEnabled</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>There&rsquo;s a lot going on here, so lets&rsquo; break it down.</p>
<h3 id="the-world-matrix">The World Matrix</h3>
<p>The line <code>effect.World = Matrix.Identity</code> creates the <em>world matrix</em>.  This matrix embodies a transformation that transforms our vertices from <em>model space</em> to <em>game space</em>.  Consider our triangle - it has three endpoints (0, 1, 0), (1, 1, 0), and (1, 0, 0).  As it is defined, it has one endpoint above the origin, one to the right, and the third is above and to the right - in line with the others.  This is its <em>model space</em>.  We might want it to appear somewhere else in our game world - say at (100, 100, 0).  We call our game world <em>world space</em>, and a matrix that would embody the transformation needed to move our triangle from its model space coordinates to its world space coordinates is the <em>world matrix</em>.  We&rsquo;re using <code>Matrix.Identity</code> here, which won&rsquo;t change those coordinates at all.</p>
<p>Instead of thinking of triangles, think of crates.  We probably would use the same crate multiple times throughout our game.  The crate would have been drawn in a modeling program, and probably had its origin at a corner or bottom corner (model space).  When we put it into the level, we would translate and rotate it to get it in just the right spot (world space).  We might put a second copy in a different location, with its own translation.  Hence, the two instances would have the same model coordinates, but different transformations to place them in the world, embodied in different world matrices.</p>
<h3 id="the-view-matrix">The View Matrix</h3>
<p>The line <code>effect.View = Matrix.CreateLookAt(..)</code> creates the <em>view matrix</em>.  This is the transform that shifts us from <em>world space</em> into <em>view space</em>.  View space is relative to the position of the observer - the eye (or camera) is at the origin (0, 0, 0), and they are looking along the z-axis.  Since the observer exists somewhere in the game world, the view transformation shifts the coordinate system so that that position becomes the origin, and everything in the world moves along with it.</p>
<p><a href="https://www.monogame.net/documentation/?page=M_Microsoft_Xna_Framework_Matrix_CreateLookAt" rel="external" target="_blank">Matrix.CreateLookAt()</a> is a method for creating a matrix to embody this transformation, and allows us to specify where the observer is looking from, and to.  The first argument is the position of the observer - where the observer&rsquo;s eye would be in the world.  The second argument is a vector in the direction the observer is looking.  The third helps orient the observer by defining which direction is up.  Normally this would be the up vector (0, 1, 0), but if the observer was a plane that was executing a barrel roll, it would be the down vector (0, -1, 0) halfway through the roll, and every value between as the plane rolled.</p>
<h3 id="the-projection-matrix">The Projection Matrix</h3>
<p>The line <code>effect.Projection = Matrix.CreatePerspectiveFieldOfView(...)</code> creates the <em>projection matrix</em>.  This is the matrix that transforms our 3D scene into a 2D one.  It does this by setting z-values to 0 while (possibly) tweaking x- and y-values to create the illusion of perspective.  There are two commonly used projections in video games: <em>orthographic</em>, which simply removes the z-values, flattening the scene; and <em>perspective</em>, which stretches distant objects an squishes near ones, creating the illusion of depth.</p>
<p><a href="https://www.monogame.net/documentation/?page=M_Microsoft_Xna_Framework_Matrix_CreatePerspectiveFieldOfView" rel="external" target="_blank">Matrix.CreatePerspectiveFieldOfView()</a> creates a perspective matrix that accounts for the field of view of the observer.  The first argument is an angle measuring how wide the field of view should be, measured in radians.  Humans have approximately a 120 degree field-of-view, but most of this is peripheral vision, so we typically use smaller numbers.  This can also be tweaked to provide the illusion of using a telescope or wide lens.  The second argument is the aspect ratio - this should match the aspect ratio of the screen, or the result will seem distorted.  For this reason we draw its value directly from the <code>GraphicsDevice</code>.  The last two values are floats indicating the far and near planes.  The near plane is how close objects can be to the observer before they won&rsquo;t be rendered, and the far plan is how far away they can be.</p>
<p><a href="https://www.monogame.net/documentation/?page=M_Microsoft_Xna_Framework_Matrix_CreateOrthographic" rel="external" target="_blank">Matrix.CreateOrthographic()</a> creates an orthographic matrix.  As there is no distortion, its arguments simply describe a cube, with the near plane and far plane composing the nearest and farthest sides.  The near face is centered on the observer, and only the vertices within the cube are rendered.</p>
<h3 id="vertex-color">Vertex Color</h3>
<p>Finally, the line <code>effect.VertexColorEnabled</code> indicates we want to use the colors in the vertex data to set the color of the triangle.  Since each corner has a different color, the pixels on the face of the triangle will be linearly interpolated by the distance to each corner, creating a gradient.</p>
<h2 id="constructing-the-triangle">Constructing the Triangle</h2>
<p>We&rsquo;ll need to write a constructor that will call both the initialization methods, as well as accept the <code>Game</code> instance:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a triangle instance</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game that is creating the triangle&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">game</span> <span class="p">=</span> <span class="n">game</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeVertices</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">InitializeEffect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h2 id="drawing-the-triangle">Drawing the Triangle</h2>
<p>And we&rsquo;ll need to draw our triangle using our <code>BasicEffect</code> and <code>GraphicDevice</code>.  Let&rsquo;s put this code into a <code>Draw()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Draws the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">CurrentTechnique</span><span class="p">.</span><span class="n">Passes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Apply</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">DrawUserPrimitives</span><span class="p">&lt;</span><span class="n">VertexPositionColor</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">            <span class="n">PrimitiveType</span><span class="p">.</span><span class="n">TriangleList</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">vertices</span><span class="p">,</span>       <span class="c1">// The vertex data </span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>              <span class="c1">// The first vertex to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">1</span>               <span class="c1">// The number of triangles to draw</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>An <code>Effect</code> can require multiple passes through the rendering pipeline, and can even contain multiple techniques.  The line <code>effect.CurrentTechnique.Passes[0].Apply()</code> therefore sets up the graphics device for the first pass with the current technique (with our <code>BasicEffect</code>, it only has one pass).  Then we trigger the rendering with <code>game.GraphicsDevice.DrawUserPrimitives&lt;VertexPositionColor&gt;(...)</code>.  We need to specify what kind of vertex data the graphics card should expect, hence the template <code>&lt;VertexPositionColor&gt;</code>.  The first argument is the type of primitive to render.  In our case, either <code>PrimitiveType.TriangleList</code> or <code>PrimitiveType.TriangleStrip</code> will work, as both use the first three vertices to define the first triangle, and we only have one.  The second argument is an offset in our vertex data - we&rsquo;re starting with the first, so its value is <code>0</code>.  The last argument is the number of primitives (in this case, triangles) to draw.  We only have one defined, so its value is <code>1</code>.</p>
<h2 id="adding-the-triangle-to-game1">Adding the Triangle to Game1</h2>
<p>Now let&rsquo;s use our <code>Triangle</code> in <code>Game1</code>.  Add a field for the triangle to the <code>Game1</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The triangle to draw</span>
</span></span><span class="line"><span class="cl">    <span class="n">Triangle</span> <span class="n">triangle</span><span class="p">;</span></span></span></code></pre></div><p>And construct it in our <code>Game1.LoadContent()</code>.  We want to be sure the graphics device is set up before we construct our <code>Triangle</code>, so this is a good spot:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Create the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="n">triangle</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Triangle</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></span></span></code></pre></div><p>And finally, let&rsquo;s render it in our <code>Game1.Draw()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Draw the triangle </span>
</span></span><span class="line"><span class="cl">    <span class="n">triangle</span><span class="p">.</span><span class="n">Draw</span><span class="p">();</span></span></span></code></pre></div><p>If you run your code, you should now see the triangle rendered:</p>
<p><a href="#R-image-e3ef2492c0a3c5dd6c20f114018ce5d6" class="lightbox-link"><img alt="The rendered triangle" class="border lazy lightbox noshadow figure-image" loading="lazy" src="/cis580/images/basic-3d-2.1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e3ef2492c0a3c5dd6c20f114018ce5d6"><img alt="The rendered triangle" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="/cis580/images/basic-3d-2.1.png"></a></p>
<h2 id="rotating-the-triangle">Rotating the Triangle</h2>
<p>Let&rsquo;s go one step farther, and make our triangle rotate around the center of the world.  To do this, we&rsquo;ll add an <code>Update()</code> method to our <code>Triangle</code> class, and modify the <code>effect.World</code> matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Rotates the triangle around the y-axis</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;The GameTime object&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">angle</span> <span class="p">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">gameTime</span><span class="p">.</span><span class="n">TotalGameTime</span><span class="p">.</span><span class="n">TotalSeconds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateRotationY</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>The <code>gameTime.TotalGameTime.TotalSeconds</code> represents the total time that has elapsed since the game started running.  We pass this to the <code>Matrix.CreateRotationY()</code> to provide the angle (measured in radians) that the triangle should rotate.</p>
<p>Finally, we&rsquo;ll need to add the <code>Triangle.Update()</code> call to our <code>Game1.Update()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Update the triangle </span>
</span></span><span class="line"><span class="cl">    <span class="n">triangle</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span></span></span></code></pre></div><p>Now when you run the program, your triangle rotates around the y-axis.  But for 180 degrees of the rotation, it disappears!  What is happening?</p>
<h2 id="backface-culling">Backface Culling</h2>
<p>If we think back to the idea that the triangles in a 3D mesh are the <em>surface</em> of the object, it makes sense that we would only want to draw the <em>outside</em> faces (as the inside faces will always be obscured).  This is exactly what the graphics device is doing - using a technique called <a href="https://en.wikipedia.org/wiki/Back-face_culling" rel="external" target="_blank">backface culling</a> to only draw triangles that are facing the camera (which eliminates around half the triangles in the scene).</p>
<p>But how do we know which face is the front-facing one?  The graphics device uses <em>winding order</em> to determine this.  Winding order refers to the order the vertices are presented to the hardware.  We can change this value by changing the <a href="/cis580/13-basic-3d-rendering/02-it-starts-with-triangles/">CullMode</a>.  By default, XNA uses <code>CullCounterClockwiseFace</code>; let&rsquo;s try swapping that.  Add these lines to your <code>Triangle.Draw()</code> method, before you invoke  <code>DrawUserPrimitives()</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// Change the backface culling mode</span>
</span></span><span class="line"><span class="cl">    <span class="n">RasterizerState</span> <span class="n">rasterizerState</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RasterizerState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">rasterizerState</span><span class="p">.</span><span class="n">CullMode</span> <span class="p">=</span> <span class="n">CullMode</span><span class="p">.</span><span class="n">CullClockwiseFace</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">RasterizerState</span> <span class="p">=</span> <span class="n">rasterizerState</span><span class="p">;</span></span></span></code></pre></div><p>Now its the <em>other</em> face of the triangle that does not appear!  Try changing the <code>CullMode.CullClockwiseFace</code> to <code>CullMode.None</code>.  Now <em>both</em> faces appear!</p>
<p>It is a good idea to cache the prior state <em>before</em> you make changes, and restore them when we&rsquo;re done.  I.e., we should refactor our <code>Draw()</code> method to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Draws the triangle</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Draw</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Cache old rasterizer state</span>
</span></span><span class="line"><span class="cl">        <span class="n">RasterizerState</span> <span class="n">oldState</span> <span class="p">=</span> <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">RasterizerState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Disable backface culling </span>
</span></span><span class="line"><span class="cl">        <span class="n">RasterizerState</span> <span class="n">rasterizerState</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RasterizerState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">rasterizerState</span><span class="p">.</span><span class="n">CullMode</span> <span class="p">=</span> <span class="n">CullMode</span><span class="p">.</span><span class="n">None</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">RasterizerState</span> <span class="p">=</span> <span class="n">rasterizerState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Apply our effect</span>
</span></span><span class="line"><span class="cl">        <span class="n">effect</span><span class="p">.</span><span class="n">CurrentTechnique</span><span class="p">.</span><span class="n">Passes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Apply</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// Draw the triangle</span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">DrawUserPrimitives</span><span class="p">&lt;</span><span class="n">VertexPositionColor</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">            <span class="n">PrimitiveType</span><span class="p">.</span><span class="n">TriangleList</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">vertices</span><span class="p">,</span>       <span class="c1">// The vertex data </span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span>              <span class="c1">// The first vertex to use</span>
</span></span><span class="line"><span class="cl">            <span class="m">1</span>               <span class="c1">// The number of triangles to draw</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Restore the prior rasterizer state </span>
</span></span><span class="line"><span class="cl">        <span class="n">game</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">RasterizerState</span> <span class="p">=</span> <span class="n">oldState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Otherwise, our change to the rasterizer state could affect other things we are drawing.</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>
</div>
</main>
</div>



<script src="/cis580/js/clipboard.min.js?1723670677" defer></script>
<script src="/cis580/js/perfect-scrollbar.min.js?1723670677" defer></script>
<script src="/cis580/js/theme.js?1723670677" defer></script>

<script src="/cis580/js/embed-iframe.js?1723670677" defer></script>
</body>
</html>
