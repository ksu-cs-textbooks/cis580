




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 580 Textbook">
    <meta name="author" content="Nathan H. Bean">
    <title>Example Particle Systems :: K-State CIS 580 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis580/09-particle-systems/04-example-particle-systems/index.html" rel="canonical" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/09-particle-systems/04-example-particle-systems/index.xml" rel="alternate" type="application/rss+xml" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/09-particle-systems/04-example-particle-systems/index.print.html" rel="alternate" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis580/09-particle-systems/04-example-particle-systems/embed.html" rel="alternate" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fontawesome-all.min.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/nucleus.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/auto-complete.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/perfect-scrollbar.min.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis580/css/fonts.css?1692031300" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/theme-auto.css?1692031300" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/variant.css?1692031300" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/print.css?1692031300" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/ie.css?1692031300" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/url.js?1692031300"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/variant.js?1692031300"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis580/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis580/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis580/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis580/css/custom.css?1692031300" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis580/09-particle-systems/04-example-particle-systems/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="example-particle-systems">Example Particle Systems</h1>

<p>To create a particle system, we&rsquo;ll derive a class from the <code>ParticleSystem</code> class and override its <code>InitializeConstants()</code>, and possibly its <code>InitializeParticle()</code> and <code>UpdateParticle()</code> methods.  Let&rsquo;s look at some examples:</p>
<h3 id="rain-particle-system">Rain Particle System</h3>
<p>This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen.  The texture we&rsquo;ll use is <a href="https://ksu-cs-textbooks.github.io/cis580/images/drop.png">this drop</a>
</p>
<p>We start by defining a class extending the <code>ParticleSystem</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class embodying a particle system emulating rain</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RainParticleSystem</span> : ParticleSystem
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Add Implementation</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Inside this class, we&rsquo;ll define a private <code>Rectangle</code> field to represent where the rain begins:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The source of the rain</span>
</span></span><span style="display:flex;"><span>    Rectangle _source;</span></span></code></pre></div><p>And a boolean property to start and stop the rain:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Determines if it is currently raining or not</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> IsRaining { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; } = <span style="color:#66d9ef">true</span>;</span></span></code></pre></div><p>We&rsquo;ll add a constructor that must also invoke the <code>ParticleSystem</code> constructor.  We&rsquo;ll supply the <code>Rectangle</code> to use for the source, and hard-code a maximum amount of particles (this may need to be tweaked for larger/smaller rain effects - if there aren&rsquo;t enough particles there will be gaps in the rain):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs the rain particle system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;game&#34;&gt;The game this particle system belongs to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;source&#34;&gt;A rectangle defining where the raindrops start&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RainParticleSystem(Game game, Rectangle source) : <span style="color:#66d9ef">base</span>(game, <span style="color:#ae81ff">5000</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _source = source;    
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>We override the <code>InitializeConstants()</code> to set the number of particles that should be spawned with an <code>AddParticles()</code> method call, and the name of the texture to use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Initialize the particle system constants</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeConstants()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll use a raindrop texture</span>
</span></span><span style="display:flex;"><span>        textureFilename = <span style="color:#e6db74">&#34;opaque-drop&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll spawn a large number of particles each frame </span>
</span></span><span style="display:flex;"><span>        minNumParticles = <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        maxNumParticles = <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Then we override the <code>InitializeParticle()</code> method of the base <code>ParticleSystem</code> to provide custom behavior for our rain particles.  Basically, they just fall straight down.  However, you could expand on this to add wind, etc.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Initializes individual particles</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;where&#34;&gt;Where the particle appears&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeParticle(Particle p, Vector2 <span style="color:#66d9ef">where</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.InitializeParticle(p, <span style="color:#66d9ef">where</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// rain particles fall downward at the same speed</span>
</span></span><span style="display:flex;"><span>        p.Velocity = Vector2.UnitY * <span style="color:#ae81ff">260</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// rain particles have already hit terminal velocity,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// and do not spin, so we don&#39;t need to set the other</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// physics values (they default to 0)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// we&#39;ll use blue for the rain </span>
</span></span><span style="display:flex;"><span>        p.Color = Color.Blue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// rain particles are small</span>
</span></span><span style="display:flex;"><span>        p.Scale = <span style="color:#ae81ff">0.1f</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// rain particles need to reach the bottom of the screen</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// it takes about 3 seconds at current velocity/screen size</span>
</span></span><span style="display:flex;"><span>        p.Lifetime = <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll override the <code>Update()</code> method from <code>DrawableGameComponent</code> to add spawning new droplets every frame within our source rectangle:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Override the default DrawableGameComponent.Update method to add </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// new particles every frame.  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;An object representing the game time&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Update(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.Update(gameTime);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Spawn new rain particles every frame</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(IsRaining) AddParticles(_source);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><h3 id="explosion-particle-system">Explosion Particle System</h3>
<p>Another particle effect we see often in games is explosions.  Let&rsquo;s create an effect that will let us create explosions at specific points on-screen as our game is running.  We&rsquo;ll use <a href="https://ksu-cs-textbooks.github.io/cis580/images/explosion.png">this explosion texture</a>
.</p>
<p>We again start by defining a new class derived from <code>ParticleSystem</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A GameComponent providing a particle system to render explosions in a game</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExplosionParticleSystem</span> : ParticleSystem
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Add implementation</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Our constructor will invoke the base <code>ParticleSystem</code> constructor, but we&rsquo;ll also ask for the maximum number of anticipated explosions the system needs to handle.  As each explosion needs 20-25 particles, we&rsquo;ll multiply that value by 25 to determine how many particles the system needs to have:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new explosion particle system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;game&#34;&gt;The game to render explosions in&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;maxExplosions&#34;&gt;The anticipated maximum number of explosions on-screen at one time&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ExplosionParticleSystem(Game game, <span style="color:#66d9ef">int</span> maxExplosions)
</span></span><span style="display:flex;"><span>        : <span style="color:#66d9ef">base</span>(game, maxExplosions * <span style="color:#ae81ff">25</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The explosion will use an explosion texture, 20-25 particles per explosion, and <em>additive blending</em>.  This blend mode means if two particles overlap, their colors are added together.  As more particle combine, the combined color gets closer to white, meaning the center of the explosion will be bright white, but as the particles spread out they will get redder (as the texture is red and yellow).  We&rsquo;ll set these up by overriding the <code>ParticleSystem.InitializeConstants()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Set up the constants that will give this particle system its behavior and</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// properties.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeConstants()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        textureFilename = <span style="color:#e6db74">&#34;explosion&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll use a handful of particles for each explosion</span>
</span></span><span style="display:flex;"><span>        minNumParticles = <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>        maxNumParticles = <span style="color:#ae81ff">25</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Additive blending is very good at creating fiery effects.</span>
</span></span><span style="display:flex;"><span>        blendState = BlendState.Additive;
</span></span><span style="display:flex;"><span>        DrawOrder = AdditiveBlendDrawOrder;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>We&rsquo;ll also override <code>ParticleSystem.InitializeParticle()</code> to provide the default starting state for all particles:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Initializes the particle &lt;paramref name=&#34;p&#34;/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;where&#34;&gt;Where the particle begins its life&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeParticle(Particle p, Vector2 <span style="color:#66d9ef">where</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.InitializeParticle(p, <span style="color:#66d9ef">where</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Explosion particles move outward from the point of origin in all directions,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// at varying speeds</span>
</span></span><span style="display:flex;"><span>        p.Velocity = RandomHelper.RandomDirection() * RandomHelper.NextFloat(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Explosions should be relatively short lived</span>
</span></span><span style="display:flex;"><span>        p.Lifetime = RandomHelper.NextFloat(<span style="color:#ae81ff">0.5f</span>, <span style="color:#ae81ff">1.0f</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Explosion particles spin at different speeds</span>
</span></span><span style="display:flex;"><span>        p.AngularVelocity = RandomHelper.NextFloat(-MathHelper.PiOver4, MathHelper.PiOver4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Explosions move outwards, then slow down and stop because of air resistance.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Let&#39;s set acceleration so that when the particle is at max lifetime, the velocity</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// will be zero.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll use the equation vt = v0 + (a0 * t). (If you&#39;re not familiar with</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// this, it&#39;s one of the basic kinematics equations for constant</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// acceleration, and basically says:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// velocity at time t = initial velocity + acceleration * t)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll solve the equation for a0, using t = p.Lifetime and vt = 0.</span>
</span></span><span style="display:flex;"><span>        p.Acceleration = -p.Velocity / p.Lifetime;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And we&rsquo;ll also override the <code>ParticleSystem.Update()</code> method, so we can use custom logic to change the color and scale of the particle over its lifetime:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// We override the UpdateParticle() method to scale and colorize </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// explosion particles over time</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;particle&#34;&gt;the particle to update&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;dt&#34;&gt;the time elapsed between frames&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> UpdateParticle(Particle particle, <span style="color:#66d9ef">float</span> dt)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.UpdateParticle(particle, dt);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// normalized lifetime is a value from 0 to 1 and represents how far</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// a particle is through its life. 0 means it just started, .5 is half</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// way through, and 1.0 means it&#39;s just about to be finished.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// this value will be used to calculate alpha and scale, to avoid </span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// having particles suddenly appear or disappear.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> normalizedLifetime = particle.TimeSinceStart / particle.Lifetime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// we want particles to fade in and fade out, so we&#39;ll calculate alpha</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// to be (normalizedLifetime) * (1-normalizedLifetime). this way, when</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// normalizedLifetime is 0 or 1, alpha is 0. the maximum value is at</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// normalizedLifetime = .5, and is</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (normalizedLifetime) * (1-normalizedLifetime)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (.5)                 * (1-.5)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// .25</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// since we want the maximum alpha to be 1, not .25, we&#39;ll scale the </span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// entire equation by 4.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> alpha = <span style="color:#ae81ff">4</span> * normalizedLifetime * (<span style="color:#ae81ff">1</span> - normalizedLifetime);
</span></span><span style="display:flex;"><span>        particle.Color = Color.White * alpha;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// make particles grow as they age. they&#39;ll start at 75% of their size,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// and increase to 100% once they&#39;re finished.</span>
</span></span><span style="display:flex;"><span>        particle.Scale = particle.Scale * (.<span style="color:#ae81ff">75f</span> + .<span style="color:#ae81ff">25f</span> * normalizedLifetime);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And finally, we need to allow the game to place explosion effects, so we&rsquo;ll add a public method to do so:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Places an explosion at location &lt;paramref name=&#34;where&#34;/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;where&#34;&gt;The location of the explosion&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> PlaceExplosion(Vector2 <span style="color:#66d9ef">where</span>) =&gt; AddParticles(<span style="color:#66d9ef">where</span>);</span></span></code></pre></div><h3 id="pixieparticlesystem">PixieParticleSystem</h3>
<p>Another common use for particle systems is to have them <em>emitted</em> from an object in the game - i.e. the player, an enemy, or something the player can interact with.  Let&rsquo;s explore this idea by making a particle system that emits colored sparks that fall to the ground, like pixie dust.  For this particle system, we&rsquo;ll use <a href="https://ksu-cs-textbooks.github.io/cis580/images/particle.png">this particle texture with a circular gradient</a>
.</p>
<p>Let&rsquo;s start by defining an interface that can serve as our emitter representation.  With an emitter, the particle starts in the same place as the emitter, so need to know its location in the game world, so a <code>Vector2</code> we&rsquo;ll name <code>Position</code>.  Also, if the emitter is moving, we need to know the velocity it is moving at, as the particle will also start with that as its initial velocity, so we&rsquo;ll add a second <code>Vector2</code> named <code>Velocity</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// An interface for the emitter of a particle system</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IParticleEmitter</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The position of the emitter in the world</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Vector2 Position { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The velocity of the emitter in the world</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Vector2 Velocity { <span style="color:#66d9ef">get</span>; }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Then we start the particle system the same way as before, by defining a class that inherits from <code>ParticleSystem</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A particle system that drops &#34;pixie dust&#34; from an emitter</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PixieParticleSystem</span> : ParticleSystem
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Add implementation</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We&rsquo;ll want a list of emitters of our <code>IParticleEmitter</code> class so we know where to spawn those particles (this way we can have multiple pixies!):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The emitter for this particle system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List&lt;IParticleEmitter&gt; Emitters { <span style="color:#66d9ef">get</span>; } = <span style="color:#66d9ef">new</span> List&lt;IParticleEmitter&gt;();</span></span></code></pre></div><p>And we&rsquo;ll construct our particle system with an expected number of pixies to support (with each using around 200 particles):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new PixieParticleSystem to support up to &lt;paramref name=&#34;maxPixies&#34;/&gt; pixies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;game&#34;&gt;The game this system belongs to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;maxPixies&#34;&gt;The maximum number of pixies to support&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> PixieParticleSystem(Game game, <span style="color:#66d9ef">int</span> maxPixies): <span style="color:#66d9ef">base</span>(game, <span style="color:#ae81ff">200</span> * maxPixies) { }</span></span></code></pre></div><p>We override <code>ParticleSystem.InitializeConstants()</code> to set up the particle system values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Set up the constants that will give this particle system its behavior and</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// properties.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeConstants()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        textureFilename = <span style="color:#e6db74">&#34;particle&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        minNumParticles = <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>        maxNumParticles = <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        blendState = BlendState.Additive;
</span></span><span style="display:flex;"><span>        DrawOrder = AdditiveBlendDrawOrder;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And <code>ParticleSystem.InitializeParticle()</code> to initialize individual particles:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Initialize the particles</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;where&#34;&gt;Where the particle initially appears&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> InitializeParticle(Particle p, Vector2 <span style="color:#66d9ef">where</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.InitializeParticle(p, <span style="color:#66d9ef">where</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// The particle&#39;s initial velocity is the same as the emitter&#39;s</span>
</span></span><span style="display:flex;"><span>        p.Velocity = _emitter.Velocity;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// The particle is affected by gravity</span>
</span></span><span style="display:flex;"><span>        p.Acceleration.Y = <span style="color:#ae81ff">400</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Randomize the particle size</span>
</span></span><span style="display:flex;"><span>        p.Scale = RandomHelper.NextFloat(<span style="color:#ae81ff">0.1f</span>, <span style="color:#ae81ff">0.5f</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Randomize the lifetime of the particles</span>
</span></span><span style="display:flex;"><span>        p.Lifetime = RandomHelper.NextFloat(<span style="color:#ae81ff">0.1f</span>, <span style="color:#ae81ff">1.0f</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// The particle also is affected by air resistance;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// lets&#39; scale its X acceleration so it stops moving horizontally by the time it dies</span>
</span></span><span style="display:flex;"><span>        p.Acceleration.X = -p.Velocity.X / p.Lifetime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Since we&rsquo;ll just use the build-in physics, we don&rsquo;t need to override <code>ParticleSystem.UpdateParticle()</code>.  But we will need to add new particles every frame, so we&rsquo;ll override <code>GameComponent.Update()</code> to do so:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Override Update() to add some particles each frame</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;gameTime&#34;&gt;An object representing game time&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Update(GameTime gameTime)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">base</span>.Update(gameTime);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add particles at the emitter position</span>
</span></span><span style="display:flex;"><span>        AddParticles(_emitter.Position);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>This particle system can now be attached to any object implementing the <code>IParticleEmitter</code> interface, and the particles will be spawned wherever that emitter is in the game world!</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/clipboard.min.js?1692031300" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/perfect-scrollbar.min.js?1692031300" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/theme.js?1692031300" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis580/js/tele-scroll.js?1692031300 defer"></script>
    
  </body>
</html>
