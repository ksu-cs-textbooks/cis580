




  
	
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
	  

  
	
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
	  

  
	
		
		
<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="To create a particle system, we’ll derive a class from the ParticleSystem class and override its InitializeConstants(), and possibly its InitializeParticle() and UpdateParticle() methods. Let’s look at some examples:
Rain Particle System This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen. The texture we’ll use is this drop
We start by defining a class extending the ParticleSystem:">
    <meta name="author" content="Nathan Bean">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Example Particle Systems :: K-State CIS 580 Textbook">
    <meta name="twitter:description" content="To create a particle system, we’ll derive a class from the ParticleSystem class and override its InitializeConstants(), and possibly its InitializeParticle() and UpdateParticle() methods. Let’s look at some examples:
Rain Particle System This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen. The texture we’ll use is this drop
We start by defining a class extending the ParticleSystem:">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cis580/09-particle-systems/04-example-particle-systems/embed.html">
    <meta property="og:site_name" content="K-State CIS 580 Textbook">
    <meta property="og:title" content="Example Particle Systems :: K-State CIS 580 Textbook">
    <meta property="og:description" content="To create a particle system, we’ll derive a class from the ParticleSystem class and override its InitializeConstants(), and possibly its InitializeParticle() and UpdateParticle() methods. Let’s look at some examples:
Rain Particle System This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen. The texture we’ll use is this drop
We start by defining a class extending the ParticleSystem:">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Particle Systems">
    <meta property="article:published_time" content="2020-03-20T10:53:05-05:00">
    <meta property="article:modified_time" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="name" content="Example Particle Systems :: K-State CIS 580 Textbook">
    <meta itemprop="description" content="To create a particle system, we’ll derive a class from the ParticleSystem class and override its InitializeConstants(), and possibly its InitializeParticle() and UpdateParticle() methods. Let’s look at some examples:
Rain Particle System This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen. The texture we’ll use is this drop
We start by defining a class extending the ParticleSystem:">
    <meta itemprop="datePublished" content="2020-03-20T10:53:05-05:00">
    <meta itemprop="dateModified" content="2023-08-11T11:18:05-05:00">
    <meta itemprop="wordCount" content="1899">
    <title>Example Particle Systems :: K-State CIS 580 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cis580/09-particle-systems/04-example-particle-systems/" rel="canonical" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="/cis580/09-particle-systems/04-example-particle-systems/index.xml" rel="alternate" type="application/rss+xml" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="/cis580/09-particle-systems/04-example-particle-systems/index.print.html" rel="alternate" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    <link href="/cis580/09-particle-systems/04-example-particle-systems/tele.html" rel="alternate" type="text/html" title="Example Particle Systems :: K-State CIS 580 Textbook">
    
  <link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fontawesome-all.min.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/nucleus.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/auto-complete.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/perfect-scrollbar.min.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/fonts.css?1737133119" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cis580/css/fonts.css?1737133119" rel="stylesheet"></noscript>
  <link href="/cis580/css/theme.css?1737133119" rel="stylesheet">
  
  
  
  <link href="/cis580/css/theme-light-theme.css?1737133119" rel="stylesheet" id="R-variant-style">
  <link href="/cis580/css/chroma-relearn-light.css?1737133119" rel="stylesheet" id="R-variant-chroma-style">
  <link href="/cis580/css/variant.css?1737133119" rel="stylesheet">
  <link href="/cis580/css/print.css?1737133119" rel="stylesheet" media="print">
  
  
  
  <script>
    window.relearn = window.relearn || {};
    window.relearn.relBasePath='..\/..';
    window.relearn.relBaseUri='..\/..\/..';
    window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cis580';
    window.index_js_url="/cis580/index.search.js";
    // variant stuff
    window.variants && variants.init( [ 'light-theme' ] );
    // translations
    window.T_Copy_to_clipboard = `Copy to clipboard`;
    window.T_Copied_to_clipboard = `Copied to clipboard!`;
    window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
    window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
    window.T_Reset_view = `Reset view`;
    window.T_View_reset = `View reset!`;
    window.T_No_results_found = `No results found for "{0}"`;
    window.T_N_results_found = `{1} results found for "{0}"`;
  </script>
  
  <link href="/cis580/css/custom.css?1737133119" rel="stylesheet">
    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="/cis580/09-particle-systems/04-example-particle-systems/embed.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    

<p>To create a particle system, we&rsquo;ll derive a class from the <code>ParticleSystem</code> class and override its <code>InitializeConstants()</code>, and possibly its <code>InitializeParticle()</code> and <code>UpdateParticle()</code> methods.  Let&rsquo;s look at some examples:</p>
<h3 id="rain-particle-system">Rain Particle System</h3>
<p>This is a simplistic implementation of rain that is spawned in a predefined rectangle and falls to the bottom of the screen.  The texture we&rsquo;ll use is <a href="/cis580/images/drop.png">this drop</a></p>
<p>We start by defining a class extending the <code>ParticleSystem</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A class embodying a particle system emulating rain</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">RainParticleSystem</span> <span class="p">:</span> <span class="n">ParticleSystem</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// TODO: Add Implementation</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Inside this class, we&rsquo;ll define a private <code>Rectangle</code> field to represent where the rain begins:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="c1">// The source of the rain</span>
</span></span><span class="line"><span class="cl">    <span class="n">Rectangle</span> <span class="n">_source</span><span class="p">;</span></span></span></code></pre></div><p>And a boolean property to start and stop the rain:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Determines if it is currently raining or not</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">bool</span> <span class="n">IsRaining</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span></span></span></code></pre></div><p>We&rsquo;ll add a constructor that must also invoke the <code>ParticleSystem</code> constructor.  We&rsquo;ll supply the <code>Rectangle</code> to use for the source, and hard-code a maximum amount of particles (this may need to be tweaked for larger/smaller rain effects - if there aren&rsquo;t enough particles there will be gaps in the rain):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs the rain particle system</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this particle system belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;source&#34;&gt;A rectangle defining where the raindrops start&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">RainParticleSystem</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="n">Rectangle</span> <span class="n">source</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="m">5000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_source</span> <span class="p">=</span> <span class="n">source</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>We override the <code>InitializeConstants()</code> to set the number of particles that should be spawned with an <code>AddParticles()</code> method call, and the name of the texture to use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initialize the particle system constants</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeConstants</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// We&#39;ll use a raindrop texture</span>
</span></span><span class="line"><span class="cl">        <span class="n">textureFilename</span> <span class="p">=</span> <span class="s">&#34;opaque-drop&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// We&#39;ll spawn a large number of particles each frame </span>
</span></span><span class="line"><span class="cl">        <span class="n">minNumParticles</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">maxNumParticles</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Then we override the <code>InitializeParticle()</code> method of the base <code>ParticleSystem</code> to provide custom behavior for our rain particles.  Basically, they just fall straight down.  However, you could expand on this to add wind, etc.:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes individual particles</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;where&#34;&gt;Where the particle appears&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeParticle</span><span class="p">(</span><span class="n">Particle</span> <span class="n">p</span><span class="p">,</span> <span class="n">Vector2</span> <span class="k">where</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">InitializeParticle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">where</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// rain particles fall downward at the same speed</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">UnitY</span> <span class="p">*</span> <span class="m">260</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// rain particles have already hit terminal velocity,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// and do not spin, so we don&#39;t need to set the other</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// physics values (they default to 0)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// we&#39;ll use blue for the rain </span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// rain particles are small</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Scale</span> <span class="p">=</span> <span class="m">0.1f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// rain particles need to reach the bottom of the screen</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// it takes about 3 seconds at current velocity/screen size</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Lifetime</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll override the <code>Update()</code> method from <code>DrawableGameComponent</code> to add spawning new droplets every frame within our source rectangle:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Override the default DrawableGameComponent.Update method to add </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// new particles every frame.  </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;An object representing the game time&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Spawn new rain particles every frame</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">IsRaining</span><span class="p">)</span> <span class="n">AddParticles</span><span class="p">(</span><span class="n">_source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><h3 id="explosion-particle-system">Explosion Particle System</h3>
<p>Another particle effect we see often in games is explosions.  Let&rsquo;s create an effect that will let us create explosions at specific points on-screen as our game is running.  We&rsquo;ll use <a href="/cis580/images/explosion.png">this explosion texture</a>.</p>
<p>We again start by defining a new class derived from <code>ParticleSystem</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A GameComponent providing a particle system to render explosions in a game</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">ExplosionParticleSystem</span> <span class="p">:</span> <span class="n">ParticleSystem</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// TODO: Add implementation</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Our constructor will invoke the base <code>ParticleSystem</code> constructor, but we&rsquo;ll also ask for the maximum number of anticipated explosions the system needs to handle.  As each explosion needs 20-25 particles, we&rsquo;ll multiply that value by 25 to determine how many particles the system needs to have:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a new explosion particle system</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game to render explosions in&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;maxExplosions&#34;&gt;The anticipated maximum number of explosions on-screen at one time&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ExplosionParticleSystem</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxExplosions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">maxExplosions</span> <span class="p">*</span> <span class="m">25</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>The explosion will use an explosion texture, 20-25 particles per explosion, and <em>additive blending</em>.  This blend mode means if two particles overlap, their colors are added together.  As more particle combine, the combined color gets closer to white, meaning the center of the explosion will be bright white, but as the particles spread out they will get redder (as the texture is red and yellow).  We&rsquo;ll set these up by overriding the <code>ParticleSystem.InitializeConstants()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Set up the constants that will give this particle system its behavior and</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// properties.</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeConstants</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">textureFilename</span> <span class="p">=</span> <span class="s">&#34;explosion&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// We&#39;ll use a handful of particles for each explosion</span>
</span></span><span class="line"><span class="cl">        <span class="n">minNumParticles</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">maxNumParticles</span> <span class="p">=</span> <span class="m">25</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Additive blending is very good at creating fiery effects.</span>
</span></span><span class="line"><span class="cl">        <span class="n">blendState</span> <span class="p">=</span> <span class="n">BlendState</span><span class="p">.</span><span class="n">Additive</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">DrawOrder</span> <span class="p">=</span> <span class="n">AdditiveBlendDrawOrder</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll also override <code>ParticleSystem.InitializeParticle()</code> to provide the default starting state for all particles:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initializes the particle &lt;paramref name=&#34;p&#34;/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;where&#34;&gt;Where the particle begins its life&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeParticle</span><span class="p">(</span><span class="n">Particle</span> <span class="n">p</span><span class="p">,</span> <span class="n">Vector2</span> <span class="k">where</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">InitializeParticle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">where</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Explosion particles move outward from the point of origin in all directions,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// at varying speeds</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">RandomDirection</span><span class="p">()</span> <span class="p">*</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">NextFloat</span><span class="p">(</span><span class="m">40</span><span class="p">,</span> <span class="m">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Explosions should be relatively short lived</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Lifetime</span> <span class="p">=</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">NextFloat</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Explosion particles spin at different speeds</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">AngularVelocity</span> <span class="p">=</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">NextFloat</span><span class="p">(-</span><span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span> <span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Explosions move outwards, then slow down and stop because of air resistance.</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Let&#39;s set acceleration so that when the particle is at max lifetime, the velocity</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// will be zero.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// We&#39;ll use the equation vt = v0 + (a0 * t). (If you&#39;re not familiar with</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// this, it&#39;s one of the basic kinematics equations for constant</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// acceleration, and basically says:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// velocity at time t = initial velocity + acceleration * t)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// We&#39;ll solve the equation for a0, using t = p.Lifetime and vt = 0.</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Acceleration</span> <span class="p">=</span> <span class="p">-</span><span class="n">p</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">/</span> <span class="n">p</span><span class="p">.</span><span class="n">Lifetime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>And we&rsquo;ll also override the <code>ParticleSystem.Update()</code> method, so we can use custom logic to change the color and scale of the particle over its lifetime:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// We override the UpdateParticle() method to scale and colorize </span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// explosion particles over time</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;particle&#34;&gt;the particle to update&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;dt&#34;&gt;the time elapsed between frames&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">UpdateParticle</span><span class="p">(</span><span class="n">Particle</span> <span class="n">particle</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">UpdateParticle</span><span class="p">(</span><span class="n">particle</span><span class="p">,</span> <span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// normalized lifetime is a value from 0 to 1 and represents how far</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// a particle is through its life. 0 means it just started, .5 is half</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// way through, and 1.0 means it&#39;s just about to be finished.</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// this value will be used to calculate alpha and scale, to avoid </span>
</span></span><span class="line"><span class="cl">        <span class="c1">// having particles suddenly appear or disappear.</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">normalizedLifetime</span> <span class="p">=</span> <span class="n">particle</span><span class="p">.</span><span class="n">TimeSinceStart</span> <span class="p">/</span> <span class="n">particle</span><span class="p">.</span><span class="n">Lifetime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// we want particles to fade in and fade out, so we&#39;ll calculate alpha</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// to be (normalizedLifetime) * (1-normalizedLifetime). this way, when</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// normalizedLifetime is 0 or 1, alpha is 0. the maximum value is at</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// normalizedLifetime = .5, and is</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// (normalizedLifetime) * (1-normalizedLifetime)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// (.5)                 * (1-.5)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// .25</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// since we want the maximum alpha to be 1, not .25, we&#39;ll scale the </span>
</span></span><span class="line"><span class="cl">        <span class="c1">// entire equation by 4.</span>
</span></span><span class="line"><span class="cl">        <span class="kt">float</span> <span class="n">alpha</span> <span class="p">=</span> <span class="m">4</span> <span class="p">*</span> <span class="n">normalizedLifetime</span> <span class="p">*</span> <span class="p">(</span><span class="m">1</span> <span class="p">-</span> <span class="n">normalizedLifetime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span> <span class="p">*</span> <span class="n">alpha</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// make particles grow as they age. they&#39;ll start at 75% of their size,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// and increase to 100% once they&#39;re finished.</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">Scale</span> <span class="p">=</span> <span class="n">particle</span><span class="p">.</span><span class="n">Scale</span> <span class="p">*</span> <span class="p">(.</span><span class="m">75f</span> <span class="p">+</span> <span class="p">.</span><span class="m">25f</span> <span class="p">*</span> <span class="n">normalizedLifetime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>And finally, we need to allow the game to place explosion effects, so we&rsquo;ll add a public method to do so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Places an explosion at location &lt;paramref name=&#34;where&#34;/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;where&#34;&gt;The location of the explosion&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">PlaceExplosion</span><span class="p">(</span><span class="n">Vector2</span> <span class="k">where</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">AddParticles</span><span class="p">(</span><span class="k">where</span><span class="p">);</span></span></span></code></pre></div><h3 id="pixieparticlesystem">PixieParticleSystem</h3>
<p>Another common use for particle systems is to have them <em>emitted</em> from an object in the game - i.e. the player, an enemy, or something the player can interact with.  Let&rsquo;s explore this idea by making a particle system that emits colored sparks that fall to the ground, like pixie dust.  For this particle system, we&rsquo;ll use <a href="/cis580/images/particle.png">this particle texture with a circular gradient</a>.</p>
<p>Let&rsquo;s start by defining an interface that can serve as our emitter representation.  With an emitter, the particle starts in the same place as the emitter, so need to know its location in the game world, so a <code>Vector2</code> we&rsquo;ll name <code>Position</code>.  Also, if the emitter is moving, we need to know the velocity it is moving at, as the particle will also start with that as its initial velocity, so we&rsquo;ll add a second <code>Vector2</code> named <code>Velocity</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// An interface for the emitter of a particle system</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">interface</span> <span class="nc">IParticleEmitter</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The position of the emitter in the world</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Vector2</span> <span class="n">Position</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The velocity of the emitter in the world</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Vector2</span> <span class="n">Velocity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then we start the particle system the same way as before, by defining a class that inherits from <code>ParticleSystem</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// A particle system that drops &#34;pixie dust&#34; from an emitter</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">PixieParticleSystem</span> <span class="p">:</span> <span class="n">ParticleSystem</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// TODO: Add implementation</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll want a list of emitters of our <code>IParticleEmitter</code> class so we know where to spawn those particles (this way we can have multiple pixies!):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// The emitter for this particle system</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IParticleEmitter</span><span class="p">&gt;</span> <span class="n">Emitters</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IParticleEmitter</span><span class="p">&gt;();</span></span></span></code></pre></div><p>And we&rsquo;ll construct our particle system with an expected number of pixies to support (with each using around 200 particles):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Constructs a new PixieParticleSystem to support up to &lt;paramref name=&#34;maxPixies&#34;/&gt; pixies</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;game&#34;&gt;The game this system belongs to&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;maxPixies&#34;&gt;The maximum number of pixies to support&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">PixieParticleSystem</span><span class="p">(</span><span class="n">Game</span> <span class="n">game</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxPixies</span><span class="p">):</span> <span class="k">base</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="m">200</span> <span class="p">*</span> <span class="n">maxPixies</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span></span></span></code></pre></div><p>We override <code>ParticleSystem.InitializeConstants()</code> to set up the particle system values:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Set up the constants that will give this particle system its behavior and</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// properties.</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeConstants</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">textureFilename</span> <span class="p">=</span> <span class="s">&#34;particle&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">minNumParticles</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">maxNumParticles</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">blendState</span> <span class="p">=</span> <span class="n">BlendState</span><span class="p">.</span><span class="n">Additive</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">DrawOrder</span> <span class="p">=</span> <span class="n">AdditiveBlendDrawOrder</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>And <code>ParticleSystem.InitializeParticle()</code> to initialize individual particles:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Initialize the particles</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;p&#34;&gt;The particle to initialize&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;where&#34;&gt;Where the particle initially appears&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">InitializeParticle</span><span class="p">(</span><span class="n">Particle</span> <span class="n">p</span><span class="p">,</span> <span class="n">Vector2</span> <span class="k">where</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">InitializeParticle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">where</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// The particle&#39;s initial velocity is the same as the emitter&#39;s</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">_emitter</span><span class="p">.</span><span class="n">Velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// The particle is affected by gravity</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Acceleration</span><span class="p">.</span><span class="n">Y</span> <span class="p">=</span> <span class="m">400</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Randomize the particle size</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Scale</span> <span class="p">=</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">NextFloat</span><span class="p">(</span><span class="m">0.1f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Randomize the lifetime of the particles</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Lifetime</span> <span class="p">=</span> <span class="n">RandomHelper</span><span class="p">.</span><span class="n">NextFloat</span><span class="p">(</span><span class="m">0.1f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// The particle also is affected by air resistance;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// lets&#39; scale its X acceleration so it stops moving horizontally by the time it dies</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Acceleration</span><span class="p">.</span><span class="n">X</span> <span class="p">=</span> <span class="p">-</span><span class="n">p</span><span class="p">.</span><span class="n">Velocity</span><span class="p">.</span><span class="n">X</span> <span class="p">/</span> <span class="n">p</span><span class="p">.</span><span class="n">Lifetime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>Since we&rsquo;ll just use the build-in physics, we don&rsquo;t need to override <code>ParticleSystem.UpdateParticle()</code>.  But we will need to add new particles every frame, so we&rsquo;ll override <code>GameComponent.Update()</code> to do so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// Override Update() to add some particles each frame</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cs">/// &lt;param name=&#34;gameTime&#34;&gt;An object representing game time&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">override</span> <span class="k">void</span> <span class="n">Update</span><span class="p">(</span><span class="n">GameTime</span> <span class="n">gameTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">base</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">gameTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Add particles at the emitter position</span>
</span></span><span class="line"><span class="cl">        <span class="n">AddParticles</span><span class="p">(</span><span class="n">_emitter</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></div><p>This particle system can now be attached to any object implementing the <code>IParticleEmitter</code> interface, and the particles will be spawned wherever that emitter is in the game world!</p>

            <footer class="footline">
              
              
              
              
            </footer>
          </article>
</div>
</main>
</div>



<script src="/cis580/js/clipboard.min.js?1737133119" defer></script>
<script src="/cis580/js/perfect-scrollbar.min.js?1737133119" defer></script>
<script src="/cis580/js/theme.js?1737133119" defer></script>

<script src="/cis580/js/embed-iframe.js?1737133119" defer></script>
</body>
</html>
